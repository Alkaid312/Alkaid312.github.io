<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="format-detection" content="telephone=no"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><link rel="icon" href="/images/icons/favicon-16x16.png?v=2.8.0" type="image/png" sizes="16x16"><link rel="icon" href="/images/icons/favicon-32x32.png?v=2.8.0" type="image/png" sizes="32x32"><meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="https://alkaid312.github.io/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="yolo">
<meta name="twitter:card" content="summary"><title>Hexo</title><link ref="canonical" href="https://alkaid312.github.io/index.html"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.12.1/css/all.min.css" type="text/css"><link rel="stylesheet" href="/css/index.css?v=2.8.0"><link rel="stylesheet" href="css/custom.css"><script>var Stun = window.Stun || {};
var CONFIG = {
  root: '/',
  algolia: undefined,
  assistSearch: undefined,
  fontIcon: {"prompt":{"success":"fas fa-check-circle","info":"fas fa-arrow-circle-right","warning":"fas fa-exclamation-circle","error":"fas fa-times-circle"},"copyBtn":"fas fa-copy"},
  sidebar: {"offsetTop":"20px","tocMaxDepth":6},
  header: {"enable":true,"showOnPost":true,"scrollDownIcon":false},
  postWidget: {"endText":true},
  nightMode: {"enable":true},
  back2top: {"enable":true},
  codeblock: {"style":"default","highlight":"light","wordWrap":true},
  reward: false,
  fancybox: false,
  zoomImage: {"gapAside":"20px"},
  galleryWaterfall: undefined,
  lazyload: false,
  pjax: undefined,
  externalLink: {"icon":{"enable":true,"name":"fas fa-external-link-alt"}},
  shortcuts: undefined,
  prompt: {"copyButton":"复制","copySuccess":"复制成功啦！🎉","copyError":"哎呀，复制失败啦！再试一次吧～😅"},
  sourcePath: {"js":"js","css":"css","images":"images"},
};

window.CONFIG = CONFIG;</script><meta name="generator" content="Hexo 8.0.0"></head><body><div class="container" id="container"><header class="header" id="header"><div class="header-inner"><nav class="header-nav header-nav--fixed"><div class="header-nav-inner"><div class="header-nav-menubtn"><i class="fas fa-bars"></i></div><div class="header-nav-menu"><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/"><span class="header-nav-menu-item__icon"><i class="fas fa-home"></i></span><span class="header-nav-menu-item__text">首页</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/archives/"><span class="header-nav-menu-item__icon"><i class="fas fa-folder-open"></i></span><span class="header-nav-menu-item__text">归档</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/categories/"><span class="header-nav-menu-item__icon"><i class="fas fa-layer-group"></i></span><span class="header-nav-menu-item__text">分类</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/tags/"><span class="header-nav-menu-item__icon"><i class="fas fa-tags"></i></span><span class="header-nav-menu-item__text">标签</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/about/"><span class="header-nav-menu-item__icon"><i class="fas fa-user"></i></span><span class="header-nav-menu-item__text">博主</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/read/"><span class="header-nav-menu-item__icon"><i class="fas fa-bookh"></i></span><span class="header-nav-menu-item__text">阅读</span></a></div></div><div class="header-nav-mode"><div class="mode"><div class="mode-track"><span class="mode-track-moon"></span><span class="mode-track-sun"></span></div><div class="mode-thumb"></div></div></div></div></nav><div class="header-banner"><div class="header-banner-info"><div class="header-banner-info__title">观我旧往 同我仰春</div><div class="header-banner-info__subtitle">欢迎光临Yolo的脑洞收容所</div></div></div></div></header><main class="main" id="main"><div class="main-inner"><div class="content-wrap" id="content-wrap"><div class="content content-home" id="content"><section class="postlist"><article class="postlist-item post"><header class="post-header"><h1 class="post-title"><a class="post-title__link" href="/2025/05/12/crypto/%E6%A6%82%E5%BF%B5%E6%96%87%E6%A1%A3/%E5%85%AC%E9%92%A5%E5%AF%86%E7%A0%81/Elgamal/">Elgamal</a></h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">发表于</span><span class="post-meta-item__value">2025-05-12</span></span></div></header><div class="post-body"><div class="post-excerpt">
        <h2 id="一、概述"   >
          <a href="#一、概述" class="heading-link"><i class="fas fa-link"></i></a><a href="#一、概述" class="headerlink" title="一、概述"></a>一、概述</h2>
      <p>ElGamal 加密算法是一种公钥加密算法，由Taher Elgamal 在1985年提出，基于<strong>离散对数</strong>问题的计算困难性（即：在某些群中，计算离散对数非常困难）。它是 非对称加密 的一种典型实现，与 RSA 加密算法类似，具有加密和解密需要不同密钥的特性。ElGamal 加密算法广泛用于数字签名（例如 DSA），也可以作为其他加密方案（如 PGP）的一部分。</p>

        <h2 id="二、算法框架"   >
          <a href="#二、算法框架" class="heading-link"><i class="fas fa-link"></i></a><a href="#二、算法框架" class="headerlink" title="二、算法框架"></a>二、算法框架</h2>
      <p><img src="https://cdn.nlark.com/yuque/0/2025/png/48372651/1744715147707-ada7f4d7-7eb1-44a2-aaa7-2edb8b38c1c4.png"></p>

        <h2 id="三、主要部分分析"   >
          <a href="#三、主要部分分析" class="heading-link"><i class="fas fa-link"></i></a><a href="#三、主要部分分析" class="headerlink" title="三、主要部分分析"></a>三、主要部分分析</h2>
      
        <h4 id="密钥生成"   >
          <a href="#密钥生成" class="heading-link"><i class="fas fa-link"></i></a><a href="#密钥生成" class="headerlink" title="密钥生成"></a>密钥生成</h4>
      <p>ElGamal 使用一对密钥：公钥和私钥。</p>
<p>公钥 (p, g, y)：p：一个大素数（用于构建群体，通常是 128 位或更大）。g：一个原根（生成素数群的生成元）。y：y &#x3D; g^x mod p，其中 x 是私钥，y 是公钥的组成部分。</p>
<p>私钥 x：x 是一个随机生成的秘密数（1 &lt; x &lt; p-1），用于解密。</p>
<p>代码实现：</p>
<figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Miller-Rabin 素性测试</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">is_prime</span>(<span class="params">n, k=<span class="number">5</span></span>):</span><br><span class="line">    <span class="keyword">if</span> n &lt;= <span class="number">1</span> <span class="keyword">or</span> n % <span class="number">2</span> == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">if</span> n == <span class="number">2</span> <span class="keyword">or</span> n == <span class="number">3</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    r, d = <span class="number">0</span>, n - <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> d % <span class="number">2</span> == <span class="number">0</span>:</span><br><span class="line">        r += <span class="number">1</span></span><br><span class="line">        d //= <span class="number">2</span></span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(k):</span><br><span class="line">        a = random.randrange(<span class="number">2</span>, n - <span class="number">1</span>)</span><br><span class="line">        x = <span class="built_in">pow</span>(a, d, n)</span><br><span class="line">        <span class="keyword">if</span> x == <span class="number">1</span> <span class="keyword">or</span> x == n - <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(r - <span class="number">1</span>):</span><br><span class="line">            x = <span class="built_in">pow</span>(x, <span class="number">2</span>, n)</span><br><span class="line">            <span class="keyword">if</span> x == n - <span class="number">1</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"><span class="comment"># 自动生成大素数</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_large_prime</span>(<span class="params">bits=<span class="number">128</span></span>):</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        p = random.getrandbits(bits)</span><br><span class="line">        p |= (<span class="number">1</span> &lt;&lt; bits - <span class="number">1</span>) | <span class="number">1</span>  <span class="comment"># 确保最高位和最低位为1</span></span><br><span class="line">        <span class="keyword">if</span> is_prime(p):</span><br><span class="line">            <span class="keyword">return</span> p</span><br><span class="line"><span class="comment"># 快速幂取模</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">mod_exp</span>(<span class="params">base, exponent, mod</span>):</span><br><span class="line">    result = <span class="number">1</span></span><br><span class="line">    base %= mod</span><br><span class="line">    <span class="keyword">while</span> exponent &gt; <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">if</span> exponent % <span class="number">2</span>:</span><br><span class="line">            result = (result * base) % mod</span><br><span class="line">        exponent //= <span class="number">2</span></span><br><span class="line">        base = (base * base) % mod</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"><span class="comment"># 快速找原根（适合大素数）</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">find_primitive_root</span>(<span class="params">p</span>):</span><br><span class="line">    <span class="keyword">if</span> p == <span class="number">2</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">    phi = p - <span class="number">1</span></span><br><span class="line">    factors = <span class="built_in">set</span>()</span><br><span class="line">    n = phi</span><br><span class="line">    i = <span class="number">2</span></span><br><span class="line">    <span class="keyword">while</span> i * i &lt;= n:</span><br><span class="line">        <span class="keyword">if</span> n % i == <span class="number">0</span>:</span><br><span class="line">            factors.add(i)</span><br><span class="line">            <span class="keyword">while</span> n % i == <span class="number">0</span>:</span><br><span class="line">                n //= i</span><br><span class="line">        i += <span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> n &gt; <span class="number">1</span>:</span><br><span class="line">        factors.add(n)</span><br><span class="line">    <span class="keyword">for</span> g <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>, p):</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">all</span>(<span class="built_in">pow</span>(g, phi // f, p) != <span class="number">1</span> <span class="keyword">for</span> f <span class="keyword">in</span> factors):</span><br><span class="line">            <span class="keyword">return</span> g</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"><span class="comment"># 密钥生成</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_keys</span>(<span class="params">p</span>):</span><br><span class="line">    g = find_primitive_root(p)</span><br><span class="line">    x = random.randint(<span class="number">2</span>, p - <span class="number">2</span>)</span><br><span class="line">    y = mod_exp(g, x, p)</span><br><span class="line">    <span class="keyword">return</span> (p, g, y), x</span><br></pre></td></tr></table></div></figure>


        <h4 id="加密"   >
          <a href="#加密" class="heading-link"><i class="fas fa-link"></i></a><a href="#加密" class="headerlink" title="加密"></a>加密</h4>
      <p><font style="color:rgb(64, 64, 64);">对消息 m（需满足 0≤m&lt;p ，十进制数）的加密步骤如下：</font></p>
<ol>
<li><strong><font style="color:rgb(64, 64, 64);">选择随机数 k</font></strong><em><strong><font style="color:rgb(64, 64, 64);"></font></strong></em><ul>
<li><font style="color:rgb(64, 64, 64);">k</font><em><font style="color:rgb(64, 64, 64);"> </font></em><font style="color:rgb(64, 64, 64);">需满足 1&lt;k&lt;p−1，且 </font><strong><font style="color:rgb(64, 64, 64);">与 p−1 互质</font></strong><font style="color:rgb(64, 64, 64);">。</font></li>
<li><strong><font style="color:rgb(64, 64, 64);">注意</font></strong><font style="color:rgb(64, 64, 64);">：若 g</font><em><font style="color:rgb(64, 64, 64);"> </font></em><font style="color:rgb(64, 64, 64);">的阶为 q（如 p&#x3D;2q+1 且 q 为素数），则 k</font><em><font style="color:rgb(64, 64, 64);"></font></em><font style="color:rgb(64, 64, 64);">应满足 1≤k≤q−1，无需强制互质。</font></li>
</ul>
</li>
<li><strong><font style="color:rgb(64, 64, 64);">计算中间值 a</font></strong><em><strong><font style="color:rgb(64, 64, 64);"> </font></strong></em>**<font style="color:rgb(64, 64, 64);">和密文 b</font>_</li>
</ol>
<p><font style="color:rgb(64, 64, 64);">a&#x3D;g^k mod p,b&#x3D;m⋅y^k mod p</font><br>_ <font style="color:rgb(64, 64, 64);">输出密文</font><font style="color:rgb(64, 64, 64);">：(a,b)。</font></p>

        <h4 id="解密过程"   >
          <a href="#解密过程" class="heading-link"><i class="fas fa-link"></i></a><a href="#解密过程" class="headerlink" title="解密过程"></a>解密过程</h4>
      <p><font style="color:rgb(64, 64, 64);">使用私钥 x 解密密文 (a,b)：</font></p>
<ol>
<li><strong><font style="color:rgb(64, 64, 64);">计算共享密钥 s</font></strong><em><strong><font style="color:rgb(64, 64, 64);"></font></strong></em></li>
</ol>
<p><font style="color:rgb(64, 64, 64);">s&#x3D;a^x mod p&#x3D;(g^k)^x mod p&#x3D;g^(xk) mod p</font></p>
<ol start="2">
<li><strong><font style="color:rgb(64, 64, 64);">计算 s</font></strong><em><strong><font style="color:rgb(64, 64, 64);"> </font></strong></em><strong><font style="color:rgb(64, 64, 64);">的模逆元 s_inv</font></strong></li>
</ol>
<p><font style="color:rgb(64, 64, 64);">s_inv≡s^(−1) mod p</font></p>
<pre><code>- &lt;font style=&quot;color:rgb(64, 64, 64);&quot;&gt;通过扩展欧几里得算法或费马小定理（若 p&lt;/font&gt;_&lt;font style=&quot;color:rgb(64, 64, 64);&quot;&gt;&lt;/font&gt;_&lt;font style=&quot;color:rgb(64, 64, 64);&quot;&gt; 为素数）计算。&lt;/font&gt;
</code></pre>
<ol start="3">
<li><strong><font style="color:rgb(64, 64, 64);">还原消息 m</font></strong><em><strong><font style="color:rgb(64, 64, 64);"></font></strong></em></li>
</ol>
<p><font style="color:rgb(64, 64, 64);"></font><img src="https://cdn.nlark.com/yuque/__latex/68e95d073b0061c8f48d93f2346b47ea.svg" alt="image"></p>

        <h4 id="完整代码"   >
          <a href="#完整代码" class="heading-link"><i class="fas fa-link"></i></a><a href="#完整代码" class="headerlink" title="完整代码"></a>完整代码</h4>
      <figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"><span class="comment"># Miller-Rabin 素性测试</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">is_prime</span>(<span class="params">n, k=<span class="number">5</span></span>):</span><br><span class="line">    <span class="keyword">if</span> n &lt;= <span class="number">1</span> <span class="keyword">or</span> n % <span class="number">2</span> == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">if</span> n == <span class="number">2</span> <span class="keyword">or</span> n == <span class="number">3</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    r, d = <span class="number">0</span>, n - <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> d % <span class="number">2</span> == <span class="number">0</span>:</span><br><span class="line">        r += <span class="number">1</span></span><br><span class="line">        d //= <span class="number">2</span></span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(k):</span><br><span class="line">        a = random.randrange(<span class="number">2</span>, n - <span class="number">1</span>)</span><br><span class="line">        x = <span class="built_in">pow</span>(a, d, n)</span><br><span class="line">        <span class="keyword">if</span> x == <span class="number">1</span> <span class="keyword">or</span> x == n - <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(r - <span class="number">1</span>):</span><br><span class="line">            x = <span class="built_in">pow</span>(x, <span class="number">2</span>, n)</span><br><span class="line">            <span class="keyword">if</span> x == n - <span class="number">1</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    </span><br><span class="line"><span class="comment"># 自动生成大素数</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_large_prime</span>(<span class="params">bits=<span class="number">128</span></span>):</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        p = random.getrandbits(bits)</span><br><span class="line">        p |= (<span class="number">1</span> &lt;&lt; bits - <span class="number">1</span>) | <span class="number">1</span>  <span class="comment"># 确保最高位和最低位为1</span></span><br><span class="line">        <span class="keyword">if</span> is_prime(p):</span><br><span class="line">            <span class="keyword">return</span> p</span><br><span class="line">            </span><br><span class="line"><span class="comment"># 快速幂取模</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">mod_exp</span>(<span class="params">base, exponent, mod</span>):</span><br><span class="line">    result = <span class="number">1</span></span><br><span class="line">    base %= mod</span><br><span class="line">    <span class="keyword">while</span> exponent &gt; <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">if</span> exponent % <span class="number">2</span>:</span><br><span class="line">            result = (result * base) % mod</span><br><span class="line">        exponent //= <span class="number">2</span></span><br><span class="line">        base = (base * base) % mod</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line">    </span><br><span class="line"><span class="comment"># 快速找原根（适合大素数）</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">find_primitive_root</span>(<span class="params">p</span>):</span><br><span class="line">    <span class="keyword">if</span> p == <span class="number">2</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">    phi = p - <span class="number">1</span></span><br><span class="line">    factors = <span class="built_in">set</span>()</span><br><span class="line">    n = phi</span><br><span class="line">    i = <span class="number">2</span></span><br><span class="line">    <span class="keyword">while</span> i * i &lt;= n:</span><br><span class="line">        <span class="keyword">if</span> n % i == <span class="number">0</span>:</span><br><span class="line">            factors.add(i)</span><br><span class="line">            <span class="keyword">while</span> n % i == <span class="number">0</span>:</span><br><span class="line">                n //= i</span><br><span class="line">        i += <span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> n &gt; <span class="number">1</span>:</span><br><span class="line">        factors.add(n)</span><br><span class="line">    <span class="keyword">for</span> g <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>, p):</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">all</span>(<span class="built_in">pow</span>(g, phi // f, p) != <span class="number">1</span> <span class="keyword">for</span> f <span class="keyword">in</span> factors):</span><br><span class="line">            <span class="keyword">return</span> g</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">    </span><br><span class="line"><span class="comment"># 密钥生成</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">generate_keys</span>(<span class="params">p</span>):</span><br><span class="line">    g = find_primitive_root(p)</span><br><span class="line">    x = random.randint(<span class="number">2</span>, p - <span class="number">2</span>)</span><br><span class="line">    y = mod_exp(g, x, p)</span><br><span class="line">    <span class="keyword">return</span> (p, g, y), x</span><br><span class="line">    </span><br><span class="line"><span class="comment"># 加密</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">p, g, y, m</span>):</span><br><span class="line">    k = random.randint(<span class="number">2</span>, p - <span class="number">2</span>)</span><br><span class="line">    a = mod_exp(g, k, p)</span><br><span class="line">    b = (m * mod_exp(y, k, p)) % p</span><br><span class="line">    <span class="keyword">return</span> a, b, k</span><br><span class="line">    </span><br><span class="line"><span class="comment"># 解密</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt</span>(<span class="params">p, x, a, b</span>):</span><br><span class="line">    s = mod_exp(a, x, p)</span><br><span class="line">    s_inv = <span class="built_in">pow</span>(s, -<span class="number">1</span>, p)</span><br><span class="line">    m = (b * s_inv) % p</span><br><span class="line">    <span class="keyword">return</span> m, s, s_inv</span><br><span class="line">    </span><br><span class="line"><span class="comment"># 主程序（只显示核心加解密过程）</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="comment"># 获取用户输入的 p 位数</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        bits = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&quot;请输入要生成素数的位数：&quot;</span>))</span><br><span class="line">        <span class="keyword">if</span> bits &lt; <span class="number">8</span>:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">&quot;位数应当大于等于 8 位&quot;</span>)</span><br><span class="line">    <span class="keyword">except</span> ValueError <span class="keyword">as</span> e:</span><br><span class="line">           <span class="built_in">print</span>(<span class="string">f&quot;输入无效: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">        exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;正在生成 <span class="subst">&#123;bits&#125;</span> 位素数用于 ElGamal 密钥，请稍等...&quot;</span>)</span><br><span class="line">    p = generate_large_prime(bits)</span><br><span class="line">    public_key, private_key = generate_keys(p)</span><br><span class="line">    g, y = public_key[<span class="number">1</span>], public_key[<span class="number">2</span>]</span><br><span class="line">    x = private_key</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n密钥生成完毕：&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;私钥 x: <span class="subst">&#123;x&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;公钥 (g=<span class="subst">&#123;g&#125;</span>, y=<span class="subst">&#123;y&#125;</span>)&quot;</span>)</span><br><span class="line"></span><br><span class="line">    message = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&quot;\n请输入要加密的整数消息（必须小于 p）: &quot;</span>))</span><br><span class="line">    <span class="keyword">if</span> message &gt;= p:</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">&quot;消息必须小于 p&quot;</span>)</span><br><span class="line">        </span><br><span class="line">    a, b, k = encrypt(p, g, y, message)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n 加密过程：&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;随机 k: <span class="subst">&#123;k&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;计算 a = g^k mod p = <span class="subst">&#123;a&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;计算 b = m * y^k mod p = <span class="subst">&#123;b&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">    m_decrypted, s, s_inv = decrypt(p, x, a, b)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n解密过程：&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;计算共享密钥 s = a^x mod p = <span class="subst">&#123;s&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;计算 s 的逆 s^(-1) mod p = <span class="subst">&#123;s_inv&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;解密后消息 m = b * s^(-1) mod p = <span class="subst">&#123;m_decrypted&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n解密是否成功？&quot;</span>, <span class="string">&quot;是&quot;</span> <span class="keyword">if</span> m_decrypted == message <span class="keyword">else</span> <span class="string">&quot;否&quot;</span>)</span><br></pre></td></tr></table></div></figure>

<p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://www.yuque.com/attachments/yuque/0/2025/py/48372651/1746978184179-083d8e73-e358-4f64-857d-234d1412a322.py" >elgamal.py</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
<p><font style="color:#FFFFFF;">     </font></p>
</div></div></article><article class="postlist-item post"><header class="post-header"><h1 class="post-title"><a class="post-title__link" href="/2025/05/12/crypto/%E6%A6%82%E5%BF%B5%E6%96%87%E6%A1%A3/%E5%85%AC%E9%92%A5%E5%AF%86%E7%A0%81/RSA/">RSA</a></h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">发表于</span><span class="post-meta-item__value">2025-05-12</span></span></div></header><div class="post-body"><div class="post-excerpt">
        <h2 id="一、RSA介绍"   >
          <a href="#一、RSA介绍" class="heading-link"><i class="fas fa-link"></i></a><a href="#一、RSA介绍" class="headerlink" title="一、RSA介绍"></a>一、RSA介绍</h2>
      <p>RSA加密算法是一种非对称加密算法，所谓非对称，就是指该算法加密和解密使用不同的密钥，即使用加密密钥进行加密、解密密钥进行解密。 在RSA算法中，加密密钥（即公开密钥）PK是公开信息，而解密密钥（即秘密密钥）KR是需要保密的。 加密算法E和解密算法D也都是公开的。</p>
<p><strong>对极大整数做因数分解的难度决定了RSA算法的可靠性。</strong> 换言之，对一极大整数做因数分解愈困难，RSA算法愈可靠。<strong>假如有人找到一种快速因数分解的算法的话，那么用RSA加密的信息的可靠性就肯定会极度下降。</strong> 但找到这样的算法的可能性是非常小的。今天只有短的RSA钥匙才可能被强力方式解破。到目前为止，世界上还没有任何可靠的攻击RSA算法的方式。只要其钥匙的长度足够长，用RSA加密的信息实际上是不能被解破的。</p>

        <h2 id="二、RSA算法详解"   >
          <a href="#二、RSA算法详解" class="heading-link"><i class="fas fa-link"></i></a><a href="#二、RSA算法详解" class="headerlink" title="二、RSA算法详解"></a>二、RSA算法详解</h2>
      <p><img src="https://cdn.nlark.com/yuque/0/2025/png/48372651/1744715152881-6bbec0f2-f246-4998-9759-e61bf838d4df.png"></p>
<p><strong>RSA的加密过程可以通过一个公式来表示：</strong></p>
<p><strong>加密：</strong></p>
<p><img src="https://cdn.nlark.com/yuque/0/2025/png/48372651/1744715153138-01940e1d-7305-4b54-969a-563a0d2c884b.png"></p>
<p><strong>解密：</strong></p>
<p><img src="https://cdn.nlark.com/yuque/0/2025/png/48372651/1744715153425-260551b8-55b0-419c-8448-da2f955b69ca.png"></p>

        <h4 id="rsa加密的python实现过程"   >
          <a href="#rsa加密的python实现过程" class="heading-link"><i class="fas fa-link"></i></a><a href="#rsa加密的python实现过程" class="headerlink" title="rsa加密的python实现过程"></a>rsa加密的python实现过程</h4>
      <p>首先要生成两个大素数 p, q (保密)</p>
<p>计算 n&#x3D;pq，<img src="https://cdn.nlark.com/yuque/__latex/b8c3b91da9dbc90b2eb2754ebd54b50a.svg" alt="image">&#x3D; (p-1)*(q-1)。【n公开；<img src="https://cdn.nlark.com/yuque/__latex/b8c3b91da9dbc90b2eb2754ebd54b50a.svg" alt="image">即欧拉函数值，需要保密 】</p>
<p>随机选取正整数 <img src="https://cdn.nlark.com/yuque/__latex/227751ddf05d570e55f3be70fc69f1aa.svg" alt="image">，满足。<img src="https://cdn.nlark.com/yuque/__latex/d72e875a8d9bfef5a2b8fdbaa36b18cc.svg" alt="image">【e是公开的加密密钥，即E 】</p>
<p>计算d，满足<img src="https://cdn.nlark.com/yuque/__latex/6e06f4e005dd1ea7192ea0aa0c745c9e.svg" alt="image">。【d是保密的解密密钥】</p>
<p>由此得到公钥(n,e)，私钥 (n,d) 或 (n,p,q)。</p>
<p>加密变换：对于明文 m ，密文为 n。</p>
<p>解密变换：对于密文 c ，明文为 n。</p>

        <h4 id="大素数生成"   >
          <a href="#大素数生成" class="heading-link"><i class="fas fa-link"></i></a><a href="#大素数生成" class="headerlink" title="大素数生成"></a>大素数生成</h4>
      <p>Miller-Rabin 素性检测（Miller-Rabin Primality Test）是一种<strong>基于概率</strong>的素数检测算法，常用于判断一个大整数是否为素数。它比最基本的试除法效率高得多，是目前实际应用中（比如RSA密钥生成）经常使用的一种方法。</p>
<p>假设我们想检测一个奇数 n&gt;2 是否为素数：</p>
<ol>
<li><strong><font style="color:rgb(64, 64, 64);">分解 n−1 的形式</font></strong><font style="color:rgb(64, 64, 64);"><br></font><font style="color:rgb(64, 64, 64);">将 n−1 分解为</font><img src="https://cdn.nlark.com/yuque/__latex/78221b7c30e79a7f268d394ac1f18b51.svg" alt="image"><font style="color:rgb(64, 64, 64);">，其中 </font><strong><font style="color:rgb(64, 64, 64);">d 是奇数</font></strong><font style="color:rgb(64, 64, 64);">（非“奇素数”，只需为奇数）。<br></font><strong><font style="color:rgb(64, 64, 64);">示例</font></strong><font style="color:rgb(64, 64, 64);">：</font><ul>
<li><font style="color:rgb(64, 64, 64);">若 n&#x3D;25 ，则 n−1&#x3D;24&#x3D;</font><img src="https://cdn.nlark.com/yuque/__latex/b68161fd7fea9cd5b8048fb3c4f3db32.svg" alt="image"><font style="color:rgb(64, 64, 64);">，此时 s&#x3D;3 ，d&#x3D;3。</font></li>
<li><font style="color:rgb(64, 64, 64);">若 n&#x3D;9 ，则 n−1&#x3D;8&#x3D;</font><img src="https://cdn.nlark.com/yuque/__latex/b7fdeb06f4a5d54cfa439355c1ddb338.svg" alt="image"><font style="color:rgb(64, 64, 64);">，此时 d&#x3D;1。</font></li>
</ul>
</li>
<li><strong><font style="color:rgb(64, 64, 64);">选择基数 a</font></strong><font style="color:rgb(64, 64, 64);"><br></font><font style="color:rgb(64, 64, 64);">随机选取 a</font><em><font style="color:rgb(64, 64, 64);"> </font></em><font style="color:rgb(64, 64, 64);">满足 1&lt;a&lt;n−1 。通常选择多个不同的 a</font><em><font style="color:rgb(64, 64, 64);"> </font></em><font style="color:rgb(64, 64, 64);"> 以提高准确性。</font></li>
<li><strong><font style="color:rgb(64, 64, 64);">模幂计算与判定</font></strong><ul>
<li><font style="color:rgb(64, 64, 64);">计算</font><img src="https://cdn.nlark.com/yuque/__latex/6d117e5261547b2f7b029c3451877e7d.svg" alt="image"><font style="color:rgb(64, 64, 64);">。</font></li>
<li><font style="color:rgb(64, 64, 64);">若  x≡1 mod n 或 x≡n−1 mod n：通过当前测试，继续下一轮。</font></li>
<li><font style="color:rgb(64, 64, 64);">否则：循环平方 x</font><em><font style="color:rgb(64, 64, 64);"> </font></em><font style="color:rgb(64, 64, 64);">最多 s−1  次，每次计算 x&#x3D;x^2 mod n。</font><ul>
<li><font style="color:rgb(64, 64, 64);">若某次得到 x ≡ n−1 mod n，则通过当前测试。</font></li>
<li><font style="color:rgb(64, 64, 64);">若所有循环后仍未通过，则 n</font><em><font style="color:rgb(64, 64, 64);"> </font></em><font style="color:rgb(64, 64, 64);">为合数。</font></li>
</ul>
</li>
</ul>
</li>
<li><strong><font style="color:rgb(64, 64, 64);">重复测试</font></strong><font style="color:rgb(64, 64, 64);"><br></font><font style="color:rgb(64, 64, 64);">用不同的 a</font><em><font style="color:rgb(64, 64, 64);"> </font></em><font style="color:rgb(64, 64, 64);">重复上述步骤。选择 k 个不同的 a</font><em><font style="color:rgb(64, 64, 64);"> </font></em><font style="color:rgb(64, 64, 64);">，可将误判概率降至</font><img src="https://cdn.nlark.com/yuque/__latex/2703b0734a3b0575bb5d691b1a045638.svg" alt="image"><font style="color:rgb(64, 64, 64);">。</font></li>
</ol>
<p>**下面我给出python的代码实现：（部分做了微调） **</p>
<figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 针对随机取得p，q两个数的素性检测     </span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">miller_rabin_test</span>(<span class="params">n</span>):  <span class="comment"># n为要检验得数</span></span><br><span class="line">    p = n - <span class="number">1</span></span><br><span class="line">    r = <span class="number">0</span></span><br><span class="line">    <span class="comment"># 寻找满足n-1 = 2^s  * m 的s,m两个数</span></span><br><span class="line">    <span class="comment">#  n -1 = 2^r * p</span></span><br><span class="line">    <span class="keyword">while</span> p % <span class="number">2</span> == <span class="number">0</span>:  <span class="comment"># 最后得到为奇数的p(即m)</span></span><br><span class="line">        r += <span class="number">1</span></span><br><span class="line">        p /= <span class="number">2</span></span><br><span class="line">    b = random.randint(<span class="number">2</span>, n - <span class="number">2</span>)  <span class="comment"># 随机取b=（0.n）</span></span><br><span class="line">    <span class="comment"># 如果情况1    b得p次方  与1  同余  mod n</span></span><br><span class="line">     <span class="keyword">if</span> fastExpMod(b, p, n) == <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span>  <span class="comment"># 通过测试,可能为素数</span></span><br><span class="line">    <span class="comment"># 情况2  b得（2^r  *p）次方  与-1 (n-1) 同余  mod n</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">7</span>): <span class="comment"># 检验六次</span></span><br><span class="line">        <span class="keyword">if</span> fastExpMod(b, (<span class="number">2</span> ** i) * p, n) == n - <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span>  <span class="comment"># 如果该数可能为素数，</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">False</span>  <span class="comment"># 不可能是素数</span></span><br></pre></td></tr></table></div></figure>

<p>这里我们看到在测试的时候，使用到了大数的幂次取模，所以这里我们要先实现大数模的算法，如下：</p>
<figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 模N大数的幂乘的快速算法</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">fastExpMod</span>(<span class="params">b, e, m</span>):  <span class="comment"># 底数，幂，大数N</span></span><br><span class="line">    result = <span class="number">1</span></span><br><span class="line">    e = <span class="built_in">int</span>(e)   <span class="comment">#这里不转化的话，在python3下会出现type error</span></span><br><span class="line">    <span class="keyword">while</span> e != <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">if</span> e % <span class="number">2</span> != <span class="number">0</span>:  <span class="comment"># 按位与</span></span><br><span class="line">            e -= <span class="number">1</span></span><br><span class="line">            result = (result * b) % m</span><br><span class="line">         <span class="keyword">else</span>:</span><br><span class="line">            e &gt;&gt;= <span class="number">1</span></span><br><span class="line">            b = (b * b) % m</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;  快速幂结果: <span class="subst">&#123;result&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> result</span><br></pre></td></tr></table></div></figure>

<p> 下面给出大素数生成的代码吧：（上面的重复内容不再写出）</p>
<figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 生成大素数：</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">create_prime_num</span>(<span class="params">bits</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;\n开始生成 <span class="subst">&#123;bits&#125;</span> 位大素数：&quot;</span>)</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            <span class="comment"># 如果经过10次素性检测，那么很大概率上，这个数就是素数</span></span><br><span class="line">           n = random.randint(<span class="number">2</span> ** (<span class="built_in">int</span>(bits) - <span class="number">1</span>), <span class="number">2</span> ** <span class="built_in">int</span>(bits) - <span class="number">1</span>)</span><br><span class="line">            <span class="keyword">if</span> n % <span class="number">2</span> != <span class="number">0</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;  尝试候选数: <span class="subst">&#123;n&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">all</span>(miller_rabin_test(n) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>)):</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;  &gt;&gt;&gt; 确认素数: <span class="subst">&#123;n&#125;</span>\n&quot;</span>)</span><br><span class="line">                <span class="keyword">return</span> n</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;  非素数，重新尝试...\n&quot;</span>)</span><br></pre></td></tr></table></div></figure>

<p>我们得到生成的大素数之后，就比较简单了。</p>

        <h4 id="生成密钥"   >
          <a href="#生成密钥" class="heading-link"><i class="fas fa-link"></i></a><a href="#生成密钥" class="headerlink" title="生成密钥"></a>生成密钥</h4>
      <p>这里直接给出代码实现：</p>
<figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 生成密钥（包括公钥和私钥）</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">create_keys</span>(<span class="params">keylength</span>):</span><br><span class="line">    p = create_prime_num(keylength // <span class="number">2</span>)</span><br><span class="line">    q = create_prime_num(keylength // <span class="number">2</span>)</span><br><span class="line">    n = p * q</span><br><span class="line">    fn = (p - <span class="number">1</span>) * (q - <span class="number">1</span>)</span><br><span class="line">    e = selectE(fn)</span><br><span class="line">    d = match_d(e, fn)</span><br><span class="line">    <span class="keyword">return</span> (n, e, d)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 选择加密指数 e</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">selectE</span>(<span class="params">fn</span>):</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        e = random.randint(<span class="number">2</span>, fn - <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">if</span> math.gcd(e, fn) == <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">return</span> e</span><br><span class="line"></span><br><span class="line"><span class="comment"># 根据选择的e，匹配出唯一的d</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">match_d</span>(<span class="params">e, fn</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">extended_gcd</span>(<span class="params">a, b</span>):</span><br><span class="line">        <span class="keyword">if</span> b == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> (<span class="number">1</span>, <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            x1, y1 = extended_gcd(b, a % b)</span><br><span class="line">            x, y = y1, x1 - (a // b) * y1</span><br><span class="line">            <span class="keyword">return</span> (x, y)</span><br><span class="line">    x, _ = extended_gcd(e, fn)</span><br><span class="line">    <span class="keyword">return</span> x % fn</span><br></pre></td></tr></table></div></figure>

<p>至此我们得到了公钥和私钥。</p>

        <h4 id="加解密实现"   >
          <a href="#加解密实现" class="heading-link"><i class="fas fa-link"></i></a><a href="#加解密实现" class="headerlink" title="加解密实现"></a>加解密实现</h4>
      <figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#加密</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">M, e, n</span>):</span><br><span class="line">    <span class="keyword">return</span> fastExpMod(M, e, n)</span><br><span class="line"><span class="comment">#解密</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt</span>(<span class="params"> C, d, m</span>):</span><br><span class="line">    <span class="keyword">return</span> fastExpMod(C, d, m)</span><br></pre></td></tr></table></div></figure>


        <h4 id="测试结果"   >
          <a href="#测试结果" class="heading-link"><i class="fas fa-link"></i></a><a href="#测试结果" class="headerlink" title="测试结果"></a>测试结果</h4>
      <p>可以完成读取文本的加密，注意标点符号如果是中文的标点，会出现乱码，但不会影响信息的读取。</p>

        <h4 id="完整代码"   >
          <a href="#完整代码" class="heading-link"><i class="fas fa-link"></i></a><a href="#完整代码" class="headerlink" title="完整代码"></a>完整代码</h4>
      <figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"></span><br><span class="line"><span class="comment"># 快速模幂运算</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">fastExpMod</span>(<span class="params">b, e, m</span>):</span><br><span class="line">    result = <span class="number">1</span></span><br><span class="line">    e = <span class="built_in">int</span>(e)</span><br><span class="line">    <span class="keyword">while</span> e != <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">if</span> e % <span class="number">2</span> != <span class="number">0</span>:</span><br><span class="line">            e -= <span class="number">1</span></span><br><span class="line">            result = (result * b) % m</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        e &gt;&gt;= <span class="number">1</span></span><br><span class="line">        b = (b * b) % m</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"><span class="comment"># Miller-Rabin 素性检测</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">miller_rabin_test</span>(<span class="params">n</span>):</span><br><span class="line">    p = n - <span class="number">1</span></span><br><span class="line">    r = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> p % <span class="number">2</span> == <span class="number">0</span>:</span><br><span class="line">        r += <span class="number">1</span></span><br><span class="line">        p //= <span class="number">2</span>  <span class="comment"># 确保是整数</span></span><br><span class="line">    b = random.randint(<span class="number">2</span>, n - <span class="number">2</span>)</span><br><span class="line">    <span class="keyword">if</span> fastExpMod(b, p, n) == <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">7</span>):</span><br><span class="line">        <span class="keyword">if</span> fastExpMod(b, (<span class="number">2</span> ** i) * p, n) == n - <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 生成大素数</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">create_prime_num</span>(<span class="params">bits</span>):</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        n = random.randint(<span class="number">2</span> ** (<span class="built_in">int</span>(bits) - <span class="number">1</span>), <span class="number">2</span> ** <span class="built_in">int</span>(bits) - <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">if</span> n % <span class="number">2</span> != <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">all</span>(miller_rabin_test(n) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>)):</span><br><span class="line">                <span class="keyword">return</span> n</span><br><span class="line"></span><br><span class="line"><span class="comment"># 生成密钥对</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">create_keys</span>(<span class="params">keylength</span>):</span><br><span class="line">    p = create_prime_num(keylength // <span class="number">2</span>)</span><br><span class="line">    q = create_prime_num(keylength // <span class="number">2</span>)</span><br><span class="line">    n = p * q</span><br><span class="line">    fn = (p - <span class="number">1</span>) * (q - <span class="number">1</span>)</span><br><span class="line">    e = selectE(fn)</span><br><span class="line">    d = match_d(e, fn)</span><br><span class="line">    <span class="keyword">return</span> (n, e, d)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 选择加密指数 e</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">selectE</span>(<span class="params">fn</span>):</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        e = random.randint(<span class="number">2</span>, fn - <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">if</span> math.gcd(e, fn) == <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">return</span> e</span><br><span class="line"></span><br><span class="line"><span class="comment"># 计算解密指数 d</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">match_d</span>(<span class="params">e, fn</span>):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">extended_gcd</span>(<span class="params">a, b</span>):</span><br><span class="line">        <span class="keyword">if</span> b == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> (<span class="number">1</span>, <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            x1, y1 = extended_gcd(b, a % b)</span><br><span class="line">            x, y = y1, x1 - (a // b) * y1</span><br><span class="line">            <span class="keyword">return</span> (x, y)</span><br><span class="line">    x, _ = extended_gcd(e, fn)</span><br><span class="line">    <span class="keyword">return</span> x % fn</span><br><span class="line"></span><br><span class="line"><span class="comment"># 加解密函数</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">encrypt</span>(<span class="params">M, e, n</span>):</span><br><span class="line">    <span class="keyword">return</span> fastExpMod(M, e, n)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">decrypt</span>(<span class="params">C, d, n</span>):</span><br><span class="line">    <span class="keyword">return</span> fastExpMod(C, d, n)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 交互菜单</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">display</span>():</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;_________________RSA_________________&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;1. 加密 Encrypt&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;2. 解密 Decrypt&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;q. 退出 Quit&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;_____________________________________&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 主函数</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        display()</span><br><span class="line">        choice = <span class="built_in">input</span>(<span class="string">&quot;请选择操作: &quot;</span>).strip().lower()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> choice == <span class="string">&#x27;1&#x27;</span>:</span><br><span class="line">            plaintext = <span class="built_in">input</span>(<span class="string">&quot;请输入要加密的明文（支持中文）: &quot;</span>)</span><br><span class="line">            n, e, d = create_keys(<span class="number">16</span>)  <span class="comment"># 密钥长度可改为更大</span></span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;\n生成的公钥: (n=<span class="subst">&#123;n&#125;</span>, e=<span class="subst">&#123;e&#125;</span>)&quot;</span>)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;请妥善保存私钥以解密: (n=<span class="subst">&#123;n&#125;</span>, d=<span class="subst">&#123;d&#125;</span>)&quot;</span>)</span><br><span class="line"></span><br><span class="line">            encrypted_list = [encrypt(<span class="built_in">ord</span>(ch), e, n) <span class="keyword">for</span> ch <span class="keyword">in</span> plaintext]</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;\n加密结果（密文整数列表）: <span class="subst">&#123;encrypted_list&#125;</span>\n&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">elif</span> choice == <span class="string">&#x27;2&#x27;</span>:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                n, d = <span class="built_in">map</span>(<span class="built_in">int</span>, <span class="built_in">input</span>(<span class="string">&quot;请输入私钥（格式: n d）: &quot;</span>).split())</span><br><span class="line">                encrypted_input = <span class="built_in">input</span>(<span class="string">&quot;请输入密文（整数列表，例如：[123, 456]）: &quot;</span>)</span><br><span class="line">                encrypted_list = <span class="built_in">eval</span>(encrypted_input)</span><br><span class="line"></span><br><span class="line">                decrypted = <span class="string">&#x27;&#x27;</span>.join([<span class="built_in">chr</span>(decrypt(c, d, n)) <span class="keyword">for</span> c <span class="keyword">in</span> encrypted_list])</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;\n解密结果: <span class="subst">&#123;decrypted&#125;</span>\n&quot;</span>)</span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;解密出错: <span class="subst">&#123;e&#125;</span>\n&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">elif</span> choice == <span class="string">&#x27;q&#x27;</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;退出程序&quot;</span>)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;无效选项，请重新输入。\n&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    main()</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>

<p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://www.yuque.com/attachments/yuque/0/2025/py/48372651/1746975965750-d5af4a7d-74b0-45b2-85e7-600ccaeb3441.py" >RSA.py</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
<p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://www.yuque.com/attachments/yuque/0/2025/py/48372651/1746975965766-913bdc1f-8aec-44de-a866-2c0f340ecf8b.py" >RSA_1.py</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
</div></div></article><article class="postlist-item post"><header class="post-header"><h1 class="post-title"><a class="post-title__link" href="/2025/04/07/crypto/%E6%A6%82%E5%BF%B5%E6%96%87%E6%A1%A3/%E5%93%88%E5%B8%8C%E5%AF%86%E7%A0%81/MD5%EF%BC%88Rivest%E8%AE%BE%E8%AE%A1%EF%BC%89/">MD5（Rivest设计）</a></h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">发表于</span><span class="post-meta-item__value">2025-04-07</span></span></div></header><div class="post-body"><div class="post-excerpt">
        <h2 id="一、概述"   >
          <a href="#一、概述" class="heading-link"><i class="fas fa-link"></i></a><a href="#一、概述" class="headerlink" title="一、概述"></a>一、概述</h2>
      <p>MD5（Message Digest Algorithm 5）是一种广泛使用的散列函数，用于提供消息的完整性保护。它可以将长度小于<img src="https://cdn.nlark.com/yuque/__latex/716ae4ac9b8718291cfcfcaf3b993026.svg" alt="image">比特的信息输入，输出固定长度的<strong>128比特</strong>（16字节）散列值。</p>
<p>输入消息以512比特的分组为单位处理。</p>

        <h2 id="二、算法框架"   >
          <a href="#二、算法框架" class="heading-link"><i class="fas fa-link"></i></a><a href="#二、算法框架" class="headerlink" title="二、算法框架"></a>二、算法框架</h2>
      <p><img src="https://cdn.nlark.com/yuque/0/2025/png/48372651/1743341449165-3fe565e8-4385-4a4a-87b6-faa817f41a44.png"></p>
<p>L：消息的长度</p>
<p>N：消息扩充后分组个数</p>
<p><img src="https://cdn.nlark.com/yuque/__latex/8c19065ae3b60102f0a2bc7e501c1352.svg" alt="image">：代表一个分组</p>

        <h2 id="三、主要步骤"   >
          <a href="#三、主要步骤" class="heading-link"><i class="fas fa-link"></i></a><a href="#三、主要步骤" class="headerlink" title="三、主要步骤"></a>三、主要步骤</h2>
      
        <h4 id="填充消息（Padding）"   >
          <a href="#填充消息（Padding）" class="heading-link"><i class="fas fa-link"></i></a><a href="#填充消息（Padding）" class="headerlink" title="填充消息（Padding）"></a>填充消息（Padding）</h4>
      <p>在MD5算法中，首先需要对输入信息进行填充，使其位长对512求余的结果等于448，并且填充必须进行，即使其位长对512求余的结果等于448。因此，信息的位长（Bits Length）将被扩展至N*512+448，N为一个非负整数，N可以是零。填充的方法如下：</p>
<ol>
<li><p>在信息的后面填充一个1和无数个0，直到满足上面的条件时才停止用0对信息的填充。</p>
</li>
<li><p>在这个结果后面附加一个以<strong>64位</strong>二进制表示的填充前信息长度，如果二进制表示的填充前信息长度超过64位，则取低64位。经过这两步的处理，信息的位长&#x3D;N*512+448+64&#x3D;(N+1）*512，即长度恰好是512的整数倍。这样做的原因是为满足后面处理中对信息长度的要求。</p>
</li>
</ol>

        <h4 id="初始化-MD5-缓冲区"   >
          <a href="#初始化-MD5-缓冲区" class="heading-link"><i class="fas fa-link"></i></a><a href="#初始化-MD5-缓冲区" class="headerlink" title="初始化 MD5 缓冲区"></a>初始化 MD5 缓冲区</h4>
      <p>MD5 使用 四个 32-bit 寄存器作为中间结果和最终结果的缓冲区，初始化值为：</p>
<p>A&#x3D;0x01234567, B&#x3D;0x89ABCDEF, C&#x3D;0xFEDCBA98, D&#x3D;0x76543210。</p>
<p><strong><font style="color:#DF2A3F;">在运算过程中涉及大端和小端的转换问题。</font></strong></p>
<p>A, B, C, D &#x3D; 0x67452301, 0xEFCDAB89, 0x98BADCFE, 0x10325476。（小端）</p>

        <h4 id="处理-512bit-分组"   >
          <a href="#处理-512bit-分组" class="heading-link"><i class="fas fa-link"></i></a><a href="#处理-512bit-分组" class="headerlink" title="处理 512bit 分组"></a>处理 512bit 分组</h4>
      <p><img src="https://cdn.nlark.com/yuque/0/2025/png/48372651/1743341449387-4cccbbe6-ea8a-48bb-94fd-c58793da99e3.png"></p>
<p><font style="color:rgb(64, 64, 64);">将填充后的消息分成512位(64字节)的块，对每个块进行以下处理：</font></p>

        <h5 id="将块分成16个32位字"   >
          <a href="#将块分成16个32位字" class="heading-link"><i class="fas fa-link"></i></a><a href="#将块分成16个32位字" class="headerlink" title="将块分成16个32位字"></a><font style="color:rgb(64, 64, 64);">将块分成16个32位字</font></h5>
      <p><font style="color:rgb(64, 64, 64);">将512位的块分成16个32位的小端序字，记为M[0]到M[15]。</font></p>

        <h5 id="初始化哈希值"   >
          <a href="#初始化哈希值" class="heading-link"><i class="fas fa-link"></i></a><a href="#初始化哈希值" class="headerlink" title="初始化哈希值"></a><font style="color:rgb(64, 64, 64);">初始化哈希值</font></h5>
      <p><font style="color:rgb(64, 64, 64);">将当前哈希值(A,B,C,D)保存到临时变量(a,b,c,d)中。</font></p>

        <h5 id="主循环"   >
          <a href="#主循环" class="heading-link"><i class="fas fa-link"></i></a><a href="#主循环" class="headerlink" title="主循环"></a><font style="color:rgb(64, 64, 64);">主循环</font></h5>
      <p><font style="color:rgb(64, 64, 64);">MD5有4轮，每轮16次操作，共64次操作。每轮使用不同的非线性函数：</font></p>
<ul>
<li><font style="color:rgb(64, 64, 64);">第一轮(F函数): F(X,Y,Z) &#x3D; (X ∧ Y) ∨ (¬X ∧ Z)</font></li>
<li><font style="color:rgb(64, 64, 64);">第二轮(G函数): G(X,Y,Z) &#x3D; (X ∧ Z) ∨ (Y ∧ ¬Z)</font></li>
<li><font style="color:rgb(64, 64, 64);">第三轮(H函数): H(X,Y,Z) &#x3D; X ⊕ Y ⊕ Z</font></li>
<li><font style="color:rgb(64, 64, 64);">第四轮(I函数): I(X,Y,Z) &#x3D; Y ⊕ (X ∨ ¬Z)</font></li>
</ul>
<p><font style="color:#464646;">每轮操作形式为：</font><code>&lt;font style=&quot;color:#464646;&quot;&gt;a = b + ((a + F(b,c,d) + M[k] + T[i]) &lt;&lt;&lt; s)&lt;/font&gt;</code></p>
<ul>
<li><font style="color:rgb(64, 64, 64);">&lt;&lt;&lt; 表示循环左移</font></li>
<li><font style="color:rgb(64, 64, 64);">T[i]是预先定义的常数表中的一个值。</font><img src="https://cdn.nlark.com/yuque/__latex/aa594bdbc3305a135d376b32b7f40326.svg" alt="image"></li>
</ul>
<p><img src="https://cdn.nlark.com/yuque/0/2025/png/48372651/1743404227546-adfd927b-b6c1-4d69-a122-c866824d9984.png"></p>
<ul>
<li><font style="color:rgb(64, 64, 64);">s是循环左移的位数</font></li>
<li><font style="color:rgb(64, 64, 64);">k是消息字索引</font></li>
</ul>
<p>4轮操作之前，先将前一分组的链接变量复制到另外四个备用记录单元AA、BB、CC、DD。</p>
<p><img src="https://cdn.nlark.com/yuque/0/2025/png/48372651/1743403890914-8a5fb93e-194d-42f9-8b8a-4cbd56f22ed4.png"><font style="color:#464646;"><br></font><font style="color:#464646;">所有这些完成之后，将a、b、c、d分别在原来基础上再加上AA、BB、CC、DD。<br></font><font style="color:#464646;">即</font><img src="https://cdn.nlark.com/yuque/__latex/bf1973ad1b73e8e7c0013d418236ced8.svg" alt="image"></p>
<p><img src="https://cdn.nlark.com/yuque/__latex/e949d62cd99e137850b750432147d7a5.svg" alt="image"><font style="color:#464646;"><br></font><font style="color:#464646;">然后用数据继续运行以上算法。</font></p>

        <h5 id="最终输出-MD5-哈希值"   >
          <a href="#最终输出-MD5-哈希值" class="heading-link"><i class="fas fa-link"></i></a><a href="#最终输出-MD5-哈希值" class="headerlink" title="最终输出 MD5 哈希值"></a>最终输出 MD5 哈希值</h5>
      <p>所有分组处理完成后，将最终的 A, B, C, D 连接成 MD5 哈希值。</p>

        <h2 id="四、完整代码"   >
          <a href="#四、完整代码" class="heading-link"><i class="fas fa-link"></i></a><a href="#四、完整代码" class="headerlink" title="四、完整代码"></a>四、完整代码</h2>
      <figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#得到十六进制、128比特的散列值</span></span><br><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"></span><br><span class="line"><span class="comment"># 循环左移</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">left_rotate</span>(<span class="params">x, n</span>):</span><br><span class="line">    <span class="keyword">return</span> ((x &lt;&lt; n) | (x &gt;&gt; (<span class="number">32</span> - n))) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 计算 T 常数表（64 个值）</span></span><br><span class="line">T = [<span class="built_in">int</span>(<span class="number">2</span>**<span class="number">32</span> * <span class="built_in">abs</span>(math.sin(i + <span class="number">1</span>))) &amp; <span class="number">0xFFFFFFFF</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">64</span>)]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4 轮使用的函数</span></span><br><span class="line">F = <span class="keyword">lambda</span> x, y, z: (x &amp; y) | (~x &amp; z)</span><br><span class="line">G = <span class="keyword">lambda</span> x, y, z: (x &amp; z) | (y &amp; ~z)</span><br><span class="line">H = <span class="keyword">lambda</span> x, y, z: x ^ y ^ z</span><br><span class="line">I = <span class="keyword">lambda</span> x, y, z: y ^ (x | ~z)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 每轮的左移位数</span></span><br><span class="line">S = [</span><br><span class="line">    (<span class="number">7</span>, <span class="number">12</span>, <span class="number">17</span>, <span class="number">22</span>) * <span class="number">4</span>,  <span class="comment"># 1st round</span></span><br><span class="line">    (<span class="number">5</span>, <span class="number">9</span>, <span class="number">14</span>, <span class="number">20</span>) * <span class="number">4</span>,   <span class="comment"># 2nd round</span></span><br><span class="line">    (<span class="number">4</span>, <span class="number">11</span>, <span class="number">16</span>, <span class="number">23</span>) * <span class="number">4</span>,  <span class="comment"># 3rd round</span></span><br><span class="line">    (<span class="number">6</span>, <span class="number">10</span>, <span class="number">15</span>, <span class="number">21</span>) * <span class="number">4</span>   <span class="comment"># 4th round</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 处理的 M[i] 顺序</span></span><br><span class="line">M_index = [</span><br><span class="line">    <span class="built_in">list</span>(<span class="built_in">range</span>(<span class="number">16</span>)),                 <span class="comment"># 1st round</span></span><br><span class="line">    [<span class="number">1</span>, <span class="number">6</span>, <span class="number">11</span>, <span class="number">0</span>, <span class="number">5</span>, <span class="number">10</span>, <span class="number">15</span>, <span class="number">4</span>, <span class="number">9</span>, <span class="number">14</span>, <span class="number">3</span>, <span class="number">8</span>, <span class="number">13</span>, <span class="number">2</span>, <span class="number">7</span>, <span class="number">12</span>],  <span class="comment"># 2nd round</span></span><br><span class="line">    [<span class="number">5</span>, <span class="number">8</span>, <span class="number">11</span>, <span class="number">14</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">7</span>, <span class="number">10</span>, <span class="number">13</span>, <span class="number">0</span>, <span class="number">3</span>, <span class="number">6</span>, <span class="number">9</span>, <span class="number">12</span>, <span class="number">15</span>, <span class="number">2</span>],  <span class="comment"># 3rd round</span></span><br><span class="line">    [<span class="number">0</span>, <span class="number">7</span>, <span class="number">14</span>, <span class="number">5</span>, <span class="number">12</span>, <span class="number">3</span>, <span class="number">10</span>, <span class="number">1</span>, <span class="number">8</span>, <span class="number">15</span>, <span class="number">6</span>, <span class="number">13</span>, <span class="number">4</span>, <span class="number">11</span>, <span class="number">2</span>, <span class="number">9</span>]   <span class="comment"># 4th round</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 消息填充</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">md5_padding</span>(<span class="params">message</span>):</span><br><span class="line">    <span class="comment"># 计算消息长度（比特）</span></span><br><span class="line">    original_length = <span class="built_in">len</span>(message) * <span class="number">8</span></span><br><span class="line">    <span class="comment"># 追加 10000000</span></span><br><span class="line">    message += <span class="string">b&#x27;\x80&#x27;</span></span><br><span class="line">    <span class="comment"># 填充 0 直到消息长度模 512 余 448</span></span><br><span class="line">    <span class="keyword">while</span> (<span class="built_in">len</span>(message) * <span class="number">8</span>) % <span class="number">512</span> != <span class="number">448</span>:</span><br><span class="line">        message += <span class="string">b&#x27;\x00&#x27;</span></span><br><span class="line">    <span class="comment"># 追加长度（小端存储）</span></span><br><span class="line">    message += struct.pack(<span class="string">&#x27;&lt;Q&#x27;</span>, original_length)</span><br><span class="line">    <span class="keyword">return</span> message</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将 32 位整数从当前字节序转换为大端字节序</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">to_big_endian_32</span>(<span class="params">x</span>):</span><br><span class="line">    <span class="keyword">return</span> struct.unpack(<span class="string">&#x27;&gt;I&#x27;</span>, struct.pack(<span class="string">&#x27;&lt;I&#x27;</span>, x))[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># MD5 计算</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">md5</span>(<span class="params">message</span>):</span><br><span class="line">    <span class="comment"># 初始化 MD5 缓冲区，按照小端字节序的初始值</span></span><br><span class="line">    A, B, C, D = <span class="number">0x67452301</span>, <span class="number">0xefcdab89</span>, <span class="number">0x98badcfe</span>, <span class="number">0x10325476</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 进行消息填充</span></span><br><span class="line">    message = md5_padding(message)</span><br><span class="line">    <span class="comment"># 将消息分割成 512-bit 分块</span></span><br><span class="line">    chunks = [message[i: i + <span class="number">64</span>] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(message), <span class="number">64</span>)]</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 处理每个 512-bit 分块</span></span><br><span class="line">    <span class="keyword">for</span> chunk <span class="keyword">in</span> chunks:</span><br><span class="line">        <span class="comment"># 小端解析 16 个 32-bit 字</span></span><br><span class="line">        M = <span class="built_in">list</span>(struct.unpack(<span class="string">&#x27;&lt;16I&#x27;</span>, chunk))</span><br><span class="line">        <span class="comment"># 复制原始值</span></span><br><span class="line">        AA, BB, CC, DD = A, B, C, D</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 64 轮循环</span></span><br><span class="line">        <span class="keyword">for</span> round_num <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">            <span class="comment"># 选择 F/G/H/I 函数</span></span><br><span class="line">            func = [F, G, H, I][round_num]</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>):</span><br><span class="line">                <span class="comment"># 选择 M[k] 的索引</span></span><br><span class="line">                k = M_index[round_num][i]</span><br><span class="line">                <span class="comment"># 选择循环左移位数</span></span><br><span class="line">                shift = S[round_num][i]</span><br><span class="line"></span><br><span class="line">                temp = (AA + func(BB, CC, DD) + M[k] + T[i + round_num * <span class="number">16</span>]) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">                <span class="comment"># 循环左移</span></span><br><span class="line">                temp = left_rotate(temp, shift)</span><br><span class="line">                <span class="comment"># 加上 B 值</span></span><br><span class="line">                temp = (BB + temp) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line"></span><br><span class="line">                <span class="comment"># 轮换 A, B, C, D</span></span><br><span class="line">                AA, BB, CC, DD = DD, temp, BB, CC</span><br><span class="line"></span><br><span class="line">                <span class="comment"># 打印当前轮次结果</span></span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;Round <span class="subst">&#123;round_num * <span class="number">16</span> + i + <span class="number">1</span>:02&#125;</span>: A=<span class="subst">&#123;AA:08x&#125;</span>, B=<span class="subst">&#123;BB:08x&#125;</span>, C=<span class="subst">&#123;CC:08x&#125;</span>, D=<span class="subst">&#123;DD:08x&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 累加结果</span></span><br><span class="line">        A = (A + AA) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">        B = (B + BB) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">        C = (C + CC) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">        D = (D + DD) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 将每个 32 位整数转换为大端字节序</span></span><br><span class="line">    A = to_big_endian_32(A)</span><br><span class="line">    B = to_big_endian_32(B)</span><br><span class="line">    C = to_big_endian_32(C)</span><br><span class="line">    D = to_big_endian_32(D)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 组合最终哈希值</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">f&#x27;<span class="subst">&#123;A:08x&#125;</span><span class="subst">&#123;B:08x&#125;</span><span class="subst">&#123;C:08x&#125;</span><span class="subst">&#123;D:08x&#125;</span>&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 运行示例</span></span><br><span class="line">message = <span class="built_in">input</span>(<span class="string">&quot;请输入要加密的字符串: &quot;</span>).encode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">md5_hash = md5(message)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;\nMD5哈希值: <span class="subst">&#123;md5_hash&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br></pre></td></tr></table></div></figure>

<p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://www.yuque.com/attachments/yuque/0/2025/py/48372651/1743406476089-6d84e59e-1253-41a6-af19-8b6540410bcd.py" >MD5.py</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
<p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://www.yuque.com/attachments/yuque/0/2025/py/48372651/1744002683961-b20ef8d9-e0a5-4819-9353-adebdca3aeb4.py" >MD5_1.py</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h2 id="五、实例"   >
          <a href="#五、实例" class="heading-link"><i class="fas fa-link"></i></a><a href="#五、实例" class="headerlink" title="五、实例"></a>五、实例</h2>
      <p>MD5(“iscbupt”)&#x3D;”16838a414adaec12d8d86f735fd183b7”</p>
</div></div></article><article class="postlist-item post"><header class="post-header"><h1 class="post-title"><a class="post-title__link" href="/2025/04/06/crypto/%E6%A6%82%E5%BF%B5%E6%96%87%E6%A1%A3/%E5%93%88%E5%B8%8C%E5%AF%86%E7%A0%81/SHA-1/">SHA-1</a></h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">发表于</span><span class="post-meta-item__value">2025-04-06</span></span></div></header><div class="post-body"><div class="post-excerpt">
        <h2 id="一、概述"   >
          <a href="#一、概述" class="heading-link"><i class="fas fa-link"></i></a><a href="#一、概述" class="headerlink" title="一、概述"></a>一、概述</h2>
      <p><font style="color:rgb(25, 27, 31);">SHA-1（Secure Hash Algorithm 1）是一种广泛应用的</font><font style="color:rgb(9, 64, 142);">哈希算法</font><font style="color:rgb(25, 27, 31);">，由美国国家安全局（NSA）设计，首次发布于 1993 年。作为 SHA 系列算法的一员，SHA-1 在</font><font style="color:rgb(9, 64, 142);">数字签名</font><font style="color:rgb(25, 27, 31);">、</font><font style="color:rgb(9, 64, 142);">数据完整性验证</font><font style="color:rgb(25, 27, 31);">和</font><font style="color:rgb(9, 64, 142);">密码学应用</font><font style="color:rgb(25, 27, 31);">中有重要意义。然而，随着计算能力的提升，SHA-1 的安全性逐渐受到威胁，已不再推荐用于强安全需求的应用。</font></p>
<p><font style="color:rgb(0, 0, 0);">SHA-1 是第一代 SHA 算法标准，后来的 SHA-224、SHA-256、SHA-384 和 SHA-512 被统称为 SHA-2。</font><font style="color:#000000;"></font></p>
<p><font style="color:#000000;">它可以将长度小于</font><img src="https://cdn.nlark.com/yuque/__latex/716ae4ac9b8718291cfcfcaf3b993026.svg" alt="image"><font style="color:#000000;">比特的信息输入，输入消息以512比特的分组为单位处理，输出固定长度的</font><strong>160比特</strong><font style="color:#000000;">（16字节）散列值。主循环4轮，每轮20次操作。</font></p>

        <h2 id="二、主要步骤"   >
          <a href="#二、主要步骤" class="heading-link"><i class="fas fa-link"></i></a><a href="#二、主要步骤" class="headerlink" title="二、主要步骤"></a>二、主要步骤</h2>
      
        <h4 id="数据预处理"   >
          <a href="#数据预处理" class="heading-link"><i class="fas fa-link"></i></a><a href="#数据预处理" class="headerlink" title="数据预处理"></a><font style="color:rgb(0, 0, 0);background-color:#FFFFFF;">数据预处理</font></h4>
      <ul>
<li><font style="background-color:#FFFFFF;">填充消息</font><font style="background-color:#FFFFFF;">：首先，在原始消息的末尾添加一个 1 比特，然后填充 0 比特，直到消息长度模 512 等于 448。</font></li>
<li><font style="background-color:#FFFFFF;">附加长度</font><font style="background-color:#FFFFFF;">：在填充后的消息末尾附加一个 64 比特的无符号整数，表示原始消息的长度（以比特为单位）。</font></li>
</ul>

        <h4 id="消息分组"   >
          <a href="#消息分组" class="heading-link"><i class="fas fa-link"></i></a><a href="#消息分组" class="headerlink" title="消息分组"></a><font style="color:rgb(0, 0, 0);background-color:#FFFFFF;">消息分组</font></h4>
      <p><font style="background-color:#FFFFFF;">将预处理后的消息分割成多个 512 比特的分组。</font></p>

        <h4 id="初始化常量"   >
          <a href="#初始化常量" class="heading-link"><i class="fas fa-link"></i></a><a href="#初始化常量" class="headerlink" title="初始化常量"></a><font style="color:rgb(0, 0, 0);background-color:#FFFFFF;">初始化常量</font></h4>
      <p><font style="background-color:#FFFFFF;">初始化 5 个 32 位的常量，这些常量将作为初始的哈希值：</font></p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">h0 = 0x67452301</span><br><span class="line">h1 = 0xEFCDAB89</span><br><span class="line">h2 = 0x98BADCFE</span><br><span class="line">h3 = 0x10325476</span><br><span class="line">h4 = 0xC3D2E1F0</span><br></pre></td></tr></table></div></figure>


        <h4 id="压缩函数处理"   >
          <a href="#压缩函数处理" class="heading-link"><i class="fas fa-link"></i></a><a href="#压缩函数处理" class="headerlink" title="压缩函数处理"></a><font style="color:rgb(0, 0, 0);background-color:#FFFFFF;">压缩函数处理</font></h4>
      
        <h5 id="总体"   >
          <a href="#总体" class="heading-link"><i class="fas fa-link"></i></a><a href="#总体" class="headerlink" title="总体"></a>总体</h5>
      <p><font style="background-color:#FFFFFF;">对于每个 512 比特的分组，执行以下操作：</font></p>
<ul>
<li><font style="background-color:#FFFFFF;">扩展消息</font><font style="background-color:#FFFFFF;">：将 512 比特的分组扩展为 80 个 32 位的字。</font></li>
<li><font style="background-color:#FFFFFF;">初始化工作变量</font><font style="background-color:#FFFFFF;">：将当前的哈希值赋值给 5 个工作变量（a、b、c、d、e）。</font></li>
<li><font style="background-color:#FFFFFF;">80 轮迭代</font><font style="background-color:#FFFFFF;">：在每一轮中，根据当前轮数选择不同的逻辑函数和常量，更新工作变量。</font></li>
<li><font style="background-color:#FFFFFF;">更新哈希值</font><font style="background-color:#FFFFFF;">：将工作变量的值累加到当前的哈希值上。</font></li>
</ul>
<p><img src="https://cdn.nlark.com/yuque/0/2025/png/48372651/1743918316006-15727ff8-b631-4dd1-af21-4790ccb32d85.png"></p>

        <h5 id="步函数"   >
          <a href="#步函数" class="heading-link"><i class="fas fa-link"></i></a><a href="#步函数" class="headerlink" title="步函数"></a>步函数</h5>
      <p><img src="https://cdn.nlark.com/yuque/0/2025/png/48372651/1743918392462-e766fad9-eb99-4c88-8d6c-aaab3434e188.png"></p>
<p>对于消息按照如下的方式进行处理:</p>
<ul>
<li>前16个字节(<code>[0, 15]</code>)，转换成32位无符号整数。</li>
<li>对于后面的字节(<code>[16, 79]</code>)按照下面的公式进行处理</li>
</ul>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">W(t) = ROTL^1 (W(t-3) XOR W(t-8) XOR W(t-14) XOR W(t-16)) //ROTL^n (x):表示对32比特的变量x循环左移n比特。</span><br></pre></td></tr></table></div></figure>

<ul>
<li>令<code>A = H0, B = H1, C = H2, D = H3, E = H4</code></li>
<li>做如下80轮的散列操作</li>
</ul>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">TEMP = ROTL^5 (A) + f(t;B,C,D) + E + W(t) + K(t);</span><br><span class="line">E = D;</span><br><span class="line">D = C;</span><br><span class="line">C = ROTL^30 (B);</span><br><span class="line">B = A;</span><br><span class="line">A = TEMP;</span><br></pre></td></tr></table></div></figure>

<ul>
<li>令<code>H0 = H0 + A, H1 = H1 + B, H2 = H2 + C, H3 = H3 + D, H4 = H4 + E</code></li>
</ul>
<p>解释一下，其中<code>f</code>函数如下:</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">f(t;B,C,D) = (B AND C) OR ((NOT B) AND D)         ( 0 &lt;= t &lt;= 19)</span><br><span class="line">f(t;B,C,D) = B XOR C XOR D                        (20 &lt;= t &lt;= 39)</span><br><span class="line">f(t;B,C,D) = (B AND C) OR (B AND D) OR (C AND D)  (40 &lt;= t &lt;= 59)</span><br><span class="line">f(t;B,C,D) = B XOR C XOR D                        (60 &lt;= t &lt;= 79)</span><br></pre></td></tr></table></div></figure>

<p><code>k</code>函数如下:</p>
<figure class="highlight plaintext"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">K(t) = 0x5A827999         ( 0 &lt;= t &lt;= 19)</span><br><span class="line">K(t) = 0x6ED9EBA1         (20 &lt;= t &lt;= 39)</span><br><span class="line">K(t) = 0x8F1BBCDC         (40 &lt;= t &lt;= 59)</span><br><span class="line">K(t) = 0xCA62C1D6         (60 &lt;= t &lt;= 79)</span><br></pre></td></tr></table></div></figure>


        <h4 id="输出结果"   >
          <a href="#输出结果" class="heading-link"><i class="fas fa-link"></i></a><a href="#输出结果" class="headerlink" title="输出结果"></a><font style="color:rgb(0, 0, 0);background-color:#FFFFFF;">输出结果</font></h4>
      <p><font style="background-color:#FFFFFF;">将最终的 5 个 32 位哈希值（h0、h1、h2、h3、h4）拼接成一个 160 位的哈希结果。</font></p>

        <h2 id="三、完整代码"   >
          <a href="#三、完整代码" class="heading-link"><i class="fas fa-link"></i></a><a href="#三、完整代码" class="headerlink" title="三、完整代码"></a>三、完整代码</h2>
      <p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://www.yuque.com/attachments/yuque/0/2025/py/48372651/1743919510676-a0dfcfd4-11fd-4ecc-b656-41ccd06a2116.py" >SHA-1.py</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
<p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://www.yuque.com/attachments/yuque/0/2025/py/48372651/1743919518163-973a26b1-51b4-4590-b159-9e13de597d55.py" >SHA-1_1.py</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
<figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> math</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 异或算法</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">xor_func</span>(<span class="params">a, b</span>):</span><br><span class="line">    a = <span class="built_in">bin</span>(a)[<span class="number">2</span>:]  <span class="comment">#将整数作为参数传递给bin函数，它就会返回一个字符串形式的二进制表示。</span></span><br><span class="line">    b = <span class="built_in">bin</span>(b)[<span class="number">2</span>:]  <span class="comment">#[2:]去掉二进制表示的&#x27;0b&#x27;前缀</span></span><br><span class="line">    <span class="keyword">while</span> <span class="built_in">len</span>(a) &lt; <span class="number">32</span>:</span><br><span class="line">        a = <span class="string">&#x27;0&#x27;</span> + a</span><br><span class="line">    <span class="keyword">while</span> <span class="built_in">len</span>(b) &lt; <span class="number">32</span>:</span><br><span class="line">        b = <span class="string">&#x27;0&#x27;</span> + b</span><br><span class="line">    c = <span class="string">&#x27;&#x27;</span>  <span class="comment">#令c初始为空，异或后的值作为字符串拼接</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">32</span>):</span><br><span class="line">        <span class="keyword">if</span> a[i] == b[i]:  <span class="comment">#对应位数上的值相等异或结果为0</span></span><br><span class="line">            c = c + <span class="string">&#x27;0&#x27;</span></span><br><span class="line">        <span class="keyword">else</span>:            <span class="comment">#反之位数为1</span></span><br><span class="line">            c = c + <span class="string">&#x27;1&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> c</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 与运算</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">and_func</span>(<span class="params">a, b</span>):</span><br><span class="line">    a = <span class="built_in">bin</span>(a)[<span class="number">2</span>:]</span><br><span class="line">    b = <span class="built_in">bin</span>(b)[<span class="number">2</span>:]</span><br><span class="line">    <span class="keyword">while</span> <span class="built_in">len</span>(a) &lt; <span class="number">32</span>:</span><br><span class="line">        a = <span class="string">&#x27;0&#x27;</span> + a</span><br><span class="line">    <span class="keyword">while</span> <span class="built_in">len</span>(b) &lt; <span class="number">32</span>:</span><br><span class="line">        b = <span class="string">&#x27;0&#x27;</span> + b</span><br><span class="line">    c = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">32</span>):</span><br><span class="line">        <span class="comment">#两位同时为&quot;1&quot;，结果才为&quot;1&quot;，否则为0</span></span><br><span class="line">        <span class="keyword">if</span> a[i] == <span class="string">&#x27;1&#x27;</span> <span class="keyword">and</span> b[i] == <span class="string">&#x27;1&#x27;</span>:</span><br><span class="line">            c = c + <span class="string">&#x27;1&#x27;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            c = c + <span class="string">&#x27;0&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> c</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ROTL运算 即轮函数运算，压缩函数由 轮函数运算组成</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">ROTL_func</span>(<span class="params">a, n</span>):</span><br><span class="line">    a = a * <span class="number">2</span> ** n  <span class="comment">#幂运算符 ** 来表示次方，也可以用内置函数pow()</span></span><br><span class="line">    <span class="comment">#a=a*pow(2,n)</span></span><br><span class="line">    t = <span class="built_in">int</span>(a / <span class="number">2</span> ** <span class="number">32</span>)</span><br><span class="line">    a = a % (<span class="number">2</span> ** <span class="number">32</span>) + t</span><br><span class="line">    <span class="keyword">return</span> a</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 非门：输入端和输出端的电平状态总是反相的，所以非门运算就是1取0，0则取1</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">NOT_func</span>(<span class="params">a</span>):</span><br><span class="line">    a = <span class="built_in">bin</span>(a)[<span class="number">2</span>:]</span><br><span class="line">    <span class="keyword">while</span> <span class="built_in">len</span>(a) &lt; <span class="number">32</span>:</span><br><span class="line">        a = <span class="string">&#x27;0&#x27;</span> + a</span><br><span class="line">    c = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> ch <span class="keyword">in</span> a:</span><br><span class="line">        <span class="keyword">if</span> ch == <span class="string">&#x27;0&#x27;</span>:</span><br><span class="line">            c = c + <span class="string">&#x27;1&#x27;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            c = c + <span class="string">&#x27;0&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> c</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 步函数算法编写</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">step_func</span>(<span class="params">W, <span class="built_in">list</span></span>):</span><br><span class="line">    A = <span class="built_in">list</span>[<span class="number">0</span>]</span><br><span class="line">    B = <span class="built_in">list</span>[<span class="number">1</span>]</span><br><span class="line">    C = <span class="built_in">list</span>[<span class="number">2</span>]</span><br><span class="line">    D = <span class="built_in">list</span>[<span class="number">3</span>]</span><br><span class="line">    E = <span class="built_in">list</span>[<span class="number">4</span>]</span><br><span class="line">    t = <span class="number">0</span></span><br><span class="line">    <span class="comment"># t=0-19的计算</span></span><br><span class="line">    <span class="keyword">while</span> t &lt;= <span class="number">19</span>:</span><br><span class="line">        k = <span class="number">0x5A827999</span>  <span class="comment"># K1</span></span><br><span class="line">        <span class="keyword">if</span> t &lt;= <span class="number">15</span>:</span><br><span class="line">            w = W[t]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment">#int(x,base) 可选参数 base，用于指定输入字符串的进制</span></span><br><span class="line">            <span class="comment">#下面即是将x转化为对应进制再进行异或运算</span></span><br><span class="line">            w = xor_func(<span class="built_in">int</span>(W[t - <span class="number">3</span>], <span class="number">16</span>), <span class="built_in">int</span>(W[t - <span class="number">8</span>], <span class="number">16</span>))  <span class="comment"># t&gt;15后进行新的赋值</span></span><br><span class="line">            w = xor_func(<span class="built_in">int</span>(w, <span class="number">2</span>), <span class="built_in">int</span>(W[t - <span class="number">14</span>], <span class="number">16</span>))</span><br><span class="line">            w = xor_func(<span class="built_in">int</span>(w, <span class="number">2</span>), <span class="built_in">int</span>(W[t - <span class="number">16</span>], <span class="number">16</span>))</span><br><span class="line">            temp = w[<span class="number">0</span>]</span><br><span class="line">            w = w[<span class="number">1</span>:] + temp</span><br><span class="line">            w = <span class="built_in">hex</span>(<span class="built_in">int</span>(w, <span class="number">2</span>))</span><br><span class="line">            W.append(w)</span><br><span class="line">        t += <span class="number">1</span></span><br><span class="line">        x = and_func(<span class="built_in">int</span>(B), <span class="built_in">int</span>(C))  <span class="comment">#与</span></span><br><span class="line">        y = NOT_func(B)  <span class="comment">#非</span></span><br><span class="line">        z = and_func(<span class="built_in">int</span>(y, <span class="number">2</span>), <span class="built_in">int</span>(D))  <span class="comment">#与</span></span><br><span class="line">        a = <span class="built_in">int</span>(xor_func(<span class="built_in">int</span>(x, <span class="number">2</span>), <span class="built_in">int</span>(z, <span class="number">2</span>)), <span class="number">2</span>)  <span class="comment"># Ch(x,y,z)</span></span><br><span class="line">        e = E</span><br><span class="line">        E = D</span><br><span class="line">        D = C</span><br><span class="line">        C = ROTL_func(<span class="built_in">int</span>(B), <span class="number">30</span>) % (<span class="number">2</span> ** <span class="number">32</span>)</span><br><span class="line">        B = A</span><br><span class="line">        A = <span class="built_in">int</span>(ROTL_func(<span class="built_in">int</span>(A), <span class="number">5</span>) + a + <span class="built_in">int</span>(e) + <span class="built_in">int</span>(w, <span class="number">16</span>) + <span class="built_in">int</span>(k)) % (<span class="number">2</span> ** <span class="number">32</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># t=20-39的计算</span></span><br><span class="line">    <span class="keyword">while</span> t &lt;= <span class="number">39</span> <span class="keyword">and</span> t &gt;= <span class="number">20</span>:</span><br><span class="line">        k = <span class="number">0x6ED9EBA1</span>  <span class="comment"># K2</span></span><br><span class="line">        w = xor_func(<span class="built_in">int</span>(W[t - <span class="number">3</span>], <span class="number">16</span>), <span class="built_in">int</span>(W[t - <span class="number">8</span>], <span class="number">16</span>))</span><br><span class="line">        w = xor_func(<span class="built_in">int</span>(w, <span class="number">2</span>), <span class="built_in">int</span>(W[t - <span class="number">14</span>], <span class="number">16</span>))</span><br><span class="line">        w = xor_func(<span class="built_in">int</span>(w, <span class="number">2</span>), <span class="built_in">int</span>(W[t - <span class="number">16</span>], <span class="number">16</span>))</span><br><span class="line">        temp = w[<span class="number">0</span>]</span><br><span class="line">        w = w[<span class="number">1</span>:] + temp</span><br><span class="line">        w = <span class="built_in">hex</span>(<span class="built_in">int</span>(w, <span class="number">2</span>))</span><br><span class="line">        W.append(w)</span><br><span class="line"></span><br><span class="line">        x = <span class="built_in">int</span>(xor_func(B, C), <span class="number">2</span>)  <span class="comment">#</span></span><br><span class="line">        y = <span class="built_in">int</span>(xor_func(x, D), <span class="number">2</span>)  <span class="comment"># Parity(x,y,z)</span></span><br><span class="line">        e = E</span><br><span class="line">        E = D</span><br><span class="line">        D = C</span><br><span class="line">        C = ROTL_func(<span class="built_in">int</span>(B), <span class="number">30</span>) % (<span class="number">2</span> ** <span class="number">32</span>)</span><br><span class="line">        B = A</span><br><span class="line">        A = <span class="built_in">int</span>(ROTL_func(<span class="built_in">int</span>(A), <span class="number">5</span>) + y + <span class="built_in">int</span>(e) + <span class="built_in">int</span>(w, <span class="number">16</span>) + <span class="built_in">int</span>(k)) % (<span class="number">2</span> ** <span class="number">32</span>)</span><br><span class="line">        t += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># t=40-59的计算</span></span><br><span class="line">    <span class="keyword">while</span> t &lt;= <span class="number">59</span> <span class="keyword">and</span> t &gt;= <span class="number">40</span>:</span><br><span class="line">        k = <span class="number">0x8f1bbcdc</span>  <span class="comment"># K3</span></span><br><span class="line">        w = xor_func(<span class="built_in">int</span>(W[t - <span class="number">3</span>], <span class="number">16</span>), <span class="built_in">int</span>(W[t - <span class="number">8</span>], <span class="number">16</span>))</span><br><span class="line">        w = xor_func(<span class="built_in">int</span>(w, <span class="number">2</span>), <span class="built_in">int</span>(W[t - <span class="number">14</span>], <span class="number">16</span>))</span><br><span class="line">        w = xor_func(<span class="built_in">int</span>(w, <span class="number">2</span>), <span class="built_in">int</span>(W[t - <span class="number">16</span>], <span class="number">16</span>))</span><br><span class="line">        temp = w[<span class="number">0</span>]</span><br><span class="line">        w = w[<span class="number">1</span>:] + temp</span><br><span class="line">        w = <span class="built_in">hex</span>(<span class="built_in">int</span>(w, <span class="number">2</span>))</span><br><span class="line">        W.append(w)</span><br><span class="line"></span><br><span class="line">        x = <span class="built_in">int</span>(and_func(B, C), <span class="number">2</span>)  <span class="comment">#</span></span><br><span class="line">        y = <span class="built_in">int</span>(and_func(B, D), <span class="number">2</span>)  <span class="comment">#</span></span><br><span class="line">        z = <span class="built_in">int</span>(and_func(C, D), <span class="number">2</span>)  <span class="comment">#</span></span><br><span class="line">        xx = <span class="built_in">int</span>(xor_func(x, y), <span class="number">2</span>)  <span class="comment">#</span></span><br><span class="line">        yy = <span class="built_in">int</span>(xor_func(xx, z), <span class="number">2</span>)  <span class="comment"># Maj(x,y,z)</span></span><br><span class="line">        e = E</span><br><span class="line">        E = D</span><br><span class="line">        D = C</span><br><span class="line">        C = ROTL_func(<span class="built_in">int</span>(B), <span class="number">30</span>) % (<span class="number">2</span> ** <span class="number">32</span>)</span><br><span class="line">        B = A</span><br><span class="line">        A = <span class="built_in">int</span>(ROTL_func(<span class="built_in">int</span>(A), <span class="number">5</span>) + yy + <span class="built_in">int</span>(e) + <span class="built_in">int</span>(w, <span class="number">16</span>) + <span class="built_in">int</span>(k)) % (<span class="number">2</span> ** <span class="number">32</span>)</span><br><span class="line">        t += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># t=60-79的计算</span></span><br><span class="line">    <span class="keyword">while</span> t &lt;= <span class="number">79</span> <span class="keyword">and</span> t &gt;= <span class="number">60</span>:</span><br><span class="line">        k = <span class="number">0xca62c1d6</span>  <span class="comment"># K4</span></span><br><span class="line">        w = xor_func(<span class="built_in">int</span>(W[t - <span class="number">3</span>], <span class="number">16</span>), <span class="built_in">int</span>(W[t - <span class="number">8</span>], <span class="number">16</span>))</span><br><span class="line">        w = xor_func(<span class="built_in">int</span>(w, <span class="number">2</span>), <span class="built_in">int</span>(W[t - <span class="number">14</span>], <span class="number">16</span>))</span><br><span class="line">        w = xor_func(<span class="built_in">int</span>(w, <span class="number">2</span>), <span class="built_in">int</span>(W[t - <span class="number">16</span>], <span class="number">16</span>))</span><br><span class="line">        temp = w[<span class="number">0</span>]</span><br><span class="line">        w = w[<span class="number">1</span>:] + temp</span><br><span class="line">        w = <span class="built_in">hex</span>(<span class="built_in">int</span>(w, <span class="number">2</span>))</span><br><span class="line">        W.append(w)</span><br><span class="line"></span><br><span class="line">        x = <span class="built_in">int</span>(xor_func(B, C), <span class="number">2</span>)  <span class="comment">#</span></span><br><span class="line">        y = <span class="built_in">int</span>(xor_func(x, D), <span class="number">2</span>)  <span class="comment"># Parity(x,y,z)</span></span><br><span class="line">        e = E</span><br><span class="line">        E = D</span><br><span class="line">        D = C</span><br><span class="line">        C = ROTL_func(<span class="built_in">int</span>(B), <span class="number">30</span>) % (<span class="number">2</span> ** <span class="number">32</span>)</span><br><span class="line">        B = A</span><br><span class="line">        A = <span class="built_in">int</span>(ROTL_func(<span class="built_in">int</span>(A), <span class="number">5</span>) + y + <span class="built_in">int</span>(e) + <span class="built_in">int</span>(w, <span class="number">16</span>) + <span class="built_in">int</span>(k)) % (<span class="number">2</span> ** <span class="number">32</span>)</span><br><span class="line">        t += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    AA = <span class="number">0x67452301</span></span><br><span class="line">    BB = <span class="number">0xEFCDAB89</span></span><br><span class="line">    CC = <span class="number">0x98BADCFE</span></span><br><span class="line">    DD = <span class="number">0x10325476</span></span><br><span class="line">    EE = <span class="number">0xC3D2E1F0</span></span><br><span class="line"></span><br><span class="line">    A = (AA + A) % (<span class="number">2</span> ** <span class="number">32</span>)</span><br><span class="line">    B = (BB + B) % (<span class="number">2</span> ** <span class="number">32</span>)</span><br><span class="line">    C = (CC + C) % (<span class="number">2</span> ** <span class="number">32</span>)</span><br><span class="line">    D = (DD + D) % (<span class="number">2</span> ** <span class="number">32</span>)</span><br><span class="line">    E = (EE + E) % (<span class="number">2</span> ** <span class="number">32</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 给列表传值</span></span><br><span class="line">    <span class="built_in">list</span>[<span class="number">0</span>] = A</span><br><span class="line">    <span class="built_in">list</span>[<span class="number">1</span>] = B</span><br><span class="line">    <span class="built_in">list</span>[<span class="number">2</span>] = C</span><br><span class="line">    <span class="built_in">list</span>[<span class="number">3</span>] = D</span><br><span class="line">    <span class="built_in">list</span>[<span class="number">4</span>] = E</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 读取需要加密的明文</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    A = <span class="number">0x67452301</span></span><br><span class="line">    B = <span class="number">0xEFCDAB89</span></span><br><span class="line">    C = <span class="number">0x98BADCFE</span></span><br><span class="line">    D = <span class="number">0x10325476</span></span><br><span class="line">    E = <span class="number">0xC3D2E1F0</span></span><br><span class="line">    <span class="built_in">list</span> = [A, B, C, D, E]</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;请输入明文:&#x27;</span>)</span><br><span class="line">    m = <span class="built_in">input</span>()</span><br><span class="line"></span><br><span class="line">    W = []</span><br><span class="line">    l = <span class="built_in">len</span>(m)</span><br><span class="line">    x = <span class="built_in">hex</span>(<span class="built_in">len</span>(m) * <span class="number">8</span>)</span><br><span class="line">    n = <span class="number">0</span>  <span class="comment"># 字符串的读取位置</span></span><br><span class="line">    <span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">        <span class="comment"># 长度大于64，即所占字节大于512，需要分段处理</span></span><br><span class="line">        <span class="keyword">if</span> l &gt; <span class="number">64</span>:</span><br><span class="line">            m = m[n:]</span><br><span class="line">            nn = <span class="number">0</span></span><br><span class="line">            p = <span class="string">&#x27;&#x27;</span></span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">64</span>):</span><br><span class="line">                <span class="keyword">if</span> <span class="built_in">int</span>(nn / <span class="number">4</span>) * <span class="number">4</span> + <span class="number">4</span> &lt;= <span class="built_in">len</span>(m):</span><br><span class="line">                    p = p + <span class="built_in">hex</span>(<span class="built_in">ord</span>(m[nn]))[<span class="number">2</span>:<span class="number">4</span>]</span><br><span class="line">                    <span class="keyword">if</span> (nn + <span class="number">1</span>) % <span class="number">4</span> == <span class="number">0</span>:</span><br><span class="line">                        W.append(p)</span><br><span class="line">                        p = <span class="string">&#x27;&#x27;</span></span><br><span class="line">                    nn = nn + <span class="number">1</span></span><br><span class="line">            step_func(W, <span class="built_in">list</span>)</span><br><span class="line">            n += <span class="number">64</span></span><br><span class="line">            l -= <span class="number">64</span></span><br><span class="line">            W = []</span><br><span class="line">        <span class="comment"># 长度在56与64之间，若要字节在448到512之间，若要其字节满足与512模448同余，还需额外添加使其达到1024字节</span></span><br><span class="line">        <span class="keyword">elif</span> l &gt;= <span class="number">56</span> <span class="keyword">and</span> l &lt;= <span class="number">64</span>:</span><br><span class="line">            mm = m[n:]</span><br><span class="line">            nn = <span class="number">0</span></span><br><span class="line">            p = <span class="string">&#x27;&#x27;</span></span><br><span class="line">            j = <span class="number">0</span></span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">64</span>):</span><br><span class="line">                <span class="keyword">if</span> <span class="built_in">int</span>(nn / <span class="number">4</span>) * <span class="number">4</span> + <span class="number">4</span> &lt;= <span class="built_in">len</span>(mm):</span><br><span class="line">                    p = p + <span class="built_in">hex</span>(<span class="built_in">ord</span>(mm[nn]))[<span class="number">2</span>:<span class="number">4</span>]</span><br><span class="line">                    <span class="keyword">if</span> (nn + <span class="number">1</span>) % <span class="number">4</span> == <span class="number">0</span>:</span><br><span class="line">                        W.append(p)</span><br><span class="line">                        j += <span class="number">1</span></span><br><span class="line">                        p = <span class="string">&#x27;&#x27;</span></span><br><span class="line">                    nn = nn + <span class="number">1</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">            judge = <span class="number">0</span></span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">4</span>):</span><br><span class="line">                <span class="keyword">if</span> nn &lt; <span class="built_in">len</span>(mm):</span><br><span class="line">                    p = p + <span class="built_in">hex</span>(<span class="built_in">ord</span>(mm[nn]))[<span class="number">2</span>:<span class="number">4</span>]</span><br><span class="line">                    nn = nn + <span class="number">1</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="keyword">if</span> judge == <span class="number">0</span>:</span><br><span class="line">                        p = p + <span class="string">&#x27;80&#x27;</span></span><br><span class="line">                        judge = <span class="number">1</span></span><br><span class="line">                    <span class="keyword">elif</span> judge == <span class="number">1</span>:</span><br><span class="line">                        p = p + <span class="string">&#x27;00&#x27;</span></span><br><span class="line">            W.append(p)</span><br><span class="line">            j += <span class="number">1</span></span><br><span class="line">            <span class="keyword">if</span> j == <span class="number">15</span>:</span><br><span class="line">                p = <span class="string">&#x27;00000000&#x27;</span></span><br><span class="line">                W.append(p)</span><br><span class="line">            step_func(W, <span class="built_in">list</span>)</span><br><span class="line">            W = []</span><br><span class="line">            p = <span class="string">&#x27;00000000&#x27;</span></span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">14</span>):</span><br><span class="line">                W.append(p)</span><br><span class="line">            length = <span class="built_in">len</span>(x) - <span class="number">2</span></span><br><span class="line">            p = <span class="string">&#x27;&#x27;</span></span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">16</span> - length):</span><br><span class="line">                p = p + <span class="string">&#x27;0&#x27;</span></span><br><span class="line">            p = p + x[<span class="number">2</span>:]</span><br><span class="line">            W.append(p[<span class="number">0</span>:<span class="number">8</span>])</span><br><span class="line">            W.append(p[<span class="number">8</span>:<span class="number">16</span>])</span><br><span class="line">            step_func(W, <span class="built_in">list</span>)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="comment"># 长度小于56，字节数在0到448之间，需要补全字节使其长度为512</span></span><br><span class="line">        <span class="keyword">elif</span> l &lt; <span class="number">56</span>:</span><br><span class="line">            mm = m[n:]</span><br><span class="line">            nn = <span class="number">0</span></span><br><span class="line">            p = <span class="string">&#x27;&#x27;</span></span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">56</span>):</span><br><span class="line">                <span class="keyword">if</span> <span class="built_in">int</span>(nn / <span class="number">4</span>) * <span class="number">4</span> + <span class="number">4</span> &lt;= <span class="built_in">len</span>(mm):</span><br><span class="line">                    p = p + <span class="built_in">hex</span>(<span class="built_in">ord</span>(mm[nn]))[<span class="number">2</span>:<span class="number">4</span>]</span><br><span class="line">                    <span class="keyword">if</span> (nn + <span class="number">1</span>) % <span class="number">4</span> == <span class="number">0</span>:</span><br><span class="line">                        W.append(p)</span><br><span class="line">                        p = <span class="string">&#x27;&#x27;</span></span><br><span class="line">                    nn = nn + <span class="number">1</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">            judge = <span class="number">0</span></span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">4</span>):</span><br><span class="line">                <span class="keyword">if</span> nn &lt; <span class="built_in">len</span>(mm):</span><br><span class="line">                    p = p + <span class="built_in">hex</span>(<span class="built_in">ord</span>(mm[nn]))[<span class="number">2</span>:<span class="number">4</span>]</span><br><span class="line">                    nn = nn + <span class="number">1</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="keyword">if</span> judge == <span class="number">0</span>:</span><br><span class="line">                        p = p + <span class="string">&#x27;80&#x27;</span></span><br><span class="line">                        judge = <span class="number">1</span></span><br><span class="line">                    <span class="keyword">elif</span> judge == <span class="number">1</span>:</span><br><span class="line">                        p = p + <span class="string">&#x27;00&#x27;</span></span><br><span class="line">            W.append(p)</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">int</span>(<span class="built_in">len</span>(mm) / <span class="number">4</span>) + <span class="number">1</span>, <span class="number">14</span>):</span><br><span class="line">                p = <span class="string">&#x27;00000000&#x27;</span></span><br><span class="line">                W.append(p)</span><br><span class="line">            length = <span class="built_in">len</span>(x) - <span class="number">2</span></span><br><span class="line">            p = <span class="string">&#x27;&#x27;</span></span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">16</span> - length):</span><br><span class="line">                p = p + <span class="string">&#x27;0&#x27;</span></span><br><span class="line">            p = p + x[<span class="number">2</span>:]</span><br><span class="line">            W.append(p[<span class="number">0</span>:<span class="number">8</span>])</span><br><span class="line">            W.append(p[<span class="number">8</span>:<span class="number">16</span>])</span><br><span class="line">            step_func(W, <span class="built_in">list</span>)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">    c = <span class="built_in">hex</span>(<span class="built_in">list</span>[<span class="number">0</span>])[<span class="number">2</span>:] + <span class="built_in">hex</span>(<span class="built_in">list</span>[<span class="number">1</span>])[<span class="number">2</span>:] + <span class="built_in">hex</span>(<span class="built_in">list</span>[<span class="number">2</span>])[<span class="number">2</span>:] + <span class="built_in">hex</span>(<span class="built_in">list</span>[<span class="number">3</span>])[<span class="number">2</span>:] + <span class="built_in">hex</span>(<span class="built_in">list</span>[<span class="number">4</span>])[<span class="number">2</span>:]</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;\n最终密文为:&#x27;</span>, c)</span><br><span class="line"></span><br><span class="line">main()</span><br></pre></td></tr></table></div></figure>


        <h2 id="四、实例"   >
          <a href="#四、实例" class="heading-link"><i class="fas fa-link"></i></a><a href="#四、实例" class="headerlink" title="四、实例"></a>四、实例</h2>
      <p>SHA1(“iscbupt”)&#x3D;”664dc9f017dc1aee4a4366bcfb8511afc89f9430”</p>
</div></div></article><article class="postlist-item post"><header class="post-header"><h1 class="post-title"><a class="post-title__link" href="/2025/04/01/crypto/%E6%A6%82%E5%BF%B5%E6%96%87%E6%A1%A3/%E5%93%88%E5%B8%8C%E5%AF%86%E7%A0%81/SM3/">SM3</a></h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">发表于</span><span class="post-meta-item__value">2025-04-01</span></span></div></header><div class="post-body"><div class="post-excerpt">
        <h2 id="一、概述"   >
          <a href="#一、概述" class="heading-link"><i class="fas fa-link"></i></a><a href="#一、概述" class="headerlink" title="一、概述"></a>一、概述</h2>
      <p><font style="color:rgb(77, 77, 77);">SM3密码杂凑</font><font style="color:#000000;">算法</font><font style="color:rgb(77, 77, 77);">是中国国家密码管理局颁布的一种密码</font><a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=Hash&spm=1001.2101.3001.7020"><font style="color:rgb(252, 85, 49);">Hash</font></a><font style="color:rgb(77, 77, 77);">函数，它与</font><u><font style="color:rgb(77, 77, 77);">SM4分组密码、SM2椭圆曲线公钥密钥</font></u><font style="color:rgb(77, 77, 77);">一起都是中国商用密码的重要组成部分。</font></p>
<p><font style="color:rgb(51, 51, 51);background-color:#FFFFFF;">SM3是中华人民共和国政府采用的一种密码散列函数标准，由国家密码管理局于2010年12月17日发布。相关标准为“GM&#x2F;T 0004-2012 《SM3密码杂凑算法》”。<br></font><font style="color:rgb(51, 51, 51);background-color:#FFFFFF;">	在商用密码体系中，SM3主要用于数字签名及验证、消息认证码生成及验证、随机数生成等，其算法公开。据国家密码管理局表示，其安全性及效率与SHA-256相当。</font></p>
<p>对长度为 l (1 &lt; l &lt; <img src="https://cdn.nlark.com/yuque/__latex/716ae4ac9b8718291cfcfcaf3b993026.svg" alt="image">) 比特的消息m，SM3杂凑算法经过填充和迭代压缩，生成杂凑值，杂凑值长度为<strong>256</strong>比特。</p>
<p><img src="https://cdn.nlark.com/yuque/0/2025/png/48372651/1742891908752-85a2611f-e480-4732-97d2-a2c960d87003.png"></p>
<p><font style="color:#585A5A;">注：字：长度为32的比特串。</font></p>
<figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">IV = [<span class="number">0x7380166f</span>, <span class="number">0x4914b2b9</span>, <span class="number">0x172442d7</span>, <span class="number">0xda8a0600</span>, <span class="number">0xa96f30bc</span>, <span class="number">0x163138aa</span>, <span class="number">0xe38dee4d</span>, <span class="number">0xb0fb0e4e</span>]</span><br><span class="line"></span><br><span class="line">T = [<span class="number">0x79cc4519</span>] * <span class="number">16</span> + [<span class="number">0x7a879d8a</span>] * <span class="number">48</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rotate_left</span>(<span class="params">x, n</span>):</span><br><span class="line">    <span class="keyword">return</span> ((x &lt;&lt; n) | (x &gt;&gt; (<span class="number">32</span> - n))) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">FF</span>(<span class="params">j, X, Y, Z</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="number">0</span> &lt;= j &lt;= <span class="number">15</span>:</span><br><span class="line">        <span class="keyword">return</span> X ^ Y ^ Z</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> (X &amp; Y) | (X &amp; Z) | (Y &amp; Z)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">GG</span>(<span class="params">j, X, Y, Z</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="number">0</span> &lt;= j &lt;= <span class="number">15</span>:</span><br><span class="line">        <span class="keyword">return</span> X ^ Y ^ Z</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> (X &amp; Y) | (~X &amp; Z)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">P0</span>(<span class="params">X</span>):</span><br><span class="line">    <span class="keyword">return</span> X ^ rotate_left(X, <span class="number">9</span>) ^ rotate_left(X, <span class="number">17</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">P1</span>(<span class="params">X</span>):</span><br><span class="line">    <span class="keyword">return</span> X ^ rotate_left(X, <span class="number">15</span>) ^ rotate_left(X, <span class="number">23</span>)</span><br></pre></td></tr></table></div></figure>


        <h2 id="二、填充"   >
          <a href="#二、填充" class="heading-link"><i class="fas fa-link"></i></a><a href="#二、填充" class="headerlink" title="二、填充"></a>二、填充</h2>
      
        <h5 id="解释："   >
          <a href="#解释：" class="heading-link"><i class="fas fa-link"></i></a><a href="#解释：" class="headerlink" title="解释："></a>解释：</h5>
      <p>假设消息m 的长度为 l 比特。首先将比特“1”添加到消息的末尾，再添加k 个“0”，k是满足<code>l + 1 + k ≡ 448 mod 512</code>的最小的非负整数。然后再添加一个64位比特串，该比特串是长度 l 的二进制表示。填充后的消息m′ 的比特长度为512的倍数。 </p>
<p>例如：对消息01100001 01100010 01100011，其长度 l &#x3D;24，经填充得到比特串：</p>
<p><img src="https://cdn.nlark.com/yuque/0/2025/png/48372651/1742892171085-4afd798d-3fcf-4fc8-b33c-bd243d42b4a2.png"></p>

        <h5 id="代码："   >
          <a href="#代码：" class="heading-link"><i class="fas fa-link"></i></a><a href="#代码：" class="headerlink" title="代码："></a>代码：</h5>
      <figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">sm3_padding</span>(<span class="params">message</span>):</span><br><span class="line">    message_length = <span class="built_in">len</span>(message) * <span class="number">8</span></span><br><span class="line">    message = <span class="built_in">bytearray</span>(message)</span><br><span class="line">    message.append(<span class="number">0x80</span>)</span><br><span class="line">    <span class="keyword">while</span> (<span class="built_in">len</span>(message) * <span class="number">8</span>) % <span class="number">512</span> != <span class="number">448</span>:</span><br><span class="line">        message.append(<span class="number">0x00</span>)</span><br><span class="line">    message.extend(message_length.to_bytes(<span class="number">8</span>, byteorder=<span class="string">&#x27;big&#x27;</span>))</span><br><span class="line">    <span class="keyword">return</span> message</span><br></pre></td></tr></table></div></figure>


        <h2 id="三、迭代压缩"   >
          <a href="#三、迭代压缩" class="heading-link"><i class="fas fa-link"></i></a><a href="#三、迭代压缩" class="headerlink" title="三、迭代压缩"></a>三、迭代压缩</h2>
      
        <h4 id="迭代过程"   >
          <a href="#迭代过程" class="heading-link"><i class="fas fa-link"></i></a><a href="#迭代过程" class="headerlink" title="迭代过程"></a>迭代过程</h4>
      
        <h5 id="解释：-1"   >
          <a href="#解释：-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#解释：-1" class="headerlink" title="解释："></a>解释：</h5>
      <p>将填充后的消息m′按512比特进行分组：<img src="https://cdn.nlark.com/yuque/__latex/c3f00ef493738e8d9702e344b45ac1bc.svg" alt="image"></p>
<p>其中<code>n=(l+k+65)/512</code>。</p>
<p>对m′按下列方式迭代：</p>
<p><img src="https://cdn.nlark.com/yuque/0/2025/png/48372651/1742892909350-f950461b-921c-4b0a-a33f-3affea9f6d83.png"></p>
<p><img src="https://cdn.nlark.com/yuque/__latex/1f892e6c62486dd3fd3bda7a4f319c5e.svg" alt="image"></p>

        <h4 id="消息扩散"   >
          <a href="#消息扩散" class="heading-link"><i class="fas fa-link"></i></a><a href="#消息扩散" class="headerlink" title="消息扩散"></a>消息扩散</h4>
      
        <h5 id="解释：-2"   >
          <a href="#解释：-2" class="heading-link"><i class="fas fa-link"></i></a><a href="#解释：-2" class="headerlink" title="解释："></a>解释：</h5>
      <p> 将消息分组<img src="https://cdn.nlark.com/yuque/__latex/1bd33f9bde0f8815a0b04e4abb8c96e2.svg" alt="image">按以下方法扩展生成132个字<img src="https://cdn.nlark.com/yuque/__latex/25000b6749c748bf14a0459a3038f2cb.svg" alt="image">, 用于压缩函数CF：  </p>
<p><img src="https://cdn.nlark.com/yuque/0/2025/png/48372651/1742893358764-7df759cc-aa1e-4964-9c21-78ba0340c716.png"></p>

        <h4 id="压缩函数"   >
          <a href="#压缩函数" class="heading-link"><i class="fas fa-link"></i></a><a href="#压缩函数" class="headerlink" title="压缩函数"></a>压缩函数</h4>
      
        <h5 id="解释：-3"   >
          <a href="#解释：-3" class="heading-link"><i class="fas fa-link"></i></a><a href="#解释：-3" class="headerlink" title="解释："></a>解释：</h5>
      <p><img src="https://cdn.nlark.com/yuque/0/2025/png/48372651/1742893458104-1e24b150-9c99-4f47-a196-3323b885e9ed.png"></p>
<p><img src="https://cdn.nlark.com/yuque/0/2025/png/48372651/1742894949084-9d075784-a80f-48b5-a4de-99755adfb198.png"></p>
<p>由SM3的压缩函数的算法可以看出，压缩函数进行了64次循环迭代。SM3的压缩函数CF把每一个512位的消息分组 <img src="https://cdn.nlark.com/yuque/__latex/1bd33f9bde0f8815a0b04e4abb8c96e2.svg" alt="image"> 压缩成256位。经过个数据分组之间的迭代处理后把 l 位的信息压缩成256位的hash值。其中布尔函数<img src="https://cdn.nlark.com/yuque/__latex/e9812c889fc2ff7317f6e71cb82b4694.svg" alt="image">(X，Y，Z)和<img src="https://cdn.nlark.com/yuque/__latex/0cfb813761c20ac51038a33827404da7.svg" alt="image">(X，Y，Z)是非线性函数，经过循环迭代后提供混淆作用。置换函数<img src="https://cdn.nlark.com/yuque/__latex/0658b2a33e6ef850323c89c732c80ee7.svg" alt="image">和<img src="https://cdn.nlark.com/yuque/__latex/44ea9c33092e1a68f13809c6584c2e27.svg" alt="image">是线性函数，经过循环迭代后提供扩散作用，确保算法的安全性。</p>

        <h4 id="单块处理函数代码实现"   >
          <a href="#单块处理函数代码实现" class="heading-link"><i class="fas fa-link"></i></a><a href="#单块处理函数代码实现" class="headerlink" title="单块处理函数代码实现"></a>单块处理函数代码实现</h4>
      <ul>
<li><strong>功能</strong>：对单个 512 位（64 字节）的数据块进行压缩处理。具体步骤如下：<ol>
<li><strong>消息扩展</strong>：将输入的 64 字节数据块转换为 68 个 32 位整数 <code>W</code>，并进一步生成 64 个 32 位整数 <code>W1</code>。</li>
<li><strong>初始化中间变量</strong>：将输入的中间哈希值 <code>V</code> 拆分为 8 个 32 位整数 <code>A</code>, <code>B</code>, <code>C</code>, <code>D</code>, <code>E</code>, <code>F</code>, <code>G</code>, <code>H</code>。</li>
<li><strong>64 轮迭代</strong>：根据常量 <code>T[j]</code>、<code>W[j]</code> 和 <code>W1[j]</code>，以及 <code>FF</code>、<code>GG</code>、<code>P0</code> 等函数，更新中间变量的值。</li>
<li><strong>输出结果</strong>：将迭代后的中间变量与输入的中间哈希值进行异或操作，得到新的中间哈希值。</li>
</ol>
</li>
</ul>
<figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">sm3_process_block</span>(<span class="params">block, V</span>):</span><br><span class="line">    W = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>):</span><br><span class="line">        W.append(<span class="built_in">int</span>.from_bytes(block[i * <span class="number">4</span>:(i + <span class="number">1</span>) * <span class="number">4</span>], byteorder=<span class="string">&#x27;big&#x27;</span>))</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>, <span class="number">68</span>):</span><br><span class="line">        W.append(P1(W[i - <span class="number">16</span>] ^ W[i - <span class="number">9</span>] ^ rotate_left(W[i - <span class="number">3</span>], <span class="number">15</span>)) ^ rotate_left(W[i - <span class="number">13</span>], <span class="number">7</span>) ^ W[i - <span class="number">6</span>])</span><br><span class="line">    W1 = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">64</span>):</span><br><span class="line">        W1.append(W[i] ^ W[i + <span class="number">4</span>])</span><br><span class="line">    A, B, C, D, E, F, G, H = V</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">64</span>):</span><br><span class="line">        SS1 = rotate_left((rotate_left(A, <span class="number">12</span>) + E + rotate_left(T[j], j % <span class="number">32</span>)) &amp; <span class="number">0xFFFFFFFF</span>, <span class="number">7</span>)</span><br><span class="line">        SS2 = SS1 ^ rotate_left(A, <span class="number">12</span>)</span><br><span class="line">        TT1 = (FF(j, A, B, C) + D + SS2 + W1[j]) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">        TT2 = (GG(j, E, F, G) + H + SS1 + W[j]) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">        D = C</span><br><span class="line">        C = rotate_left(B, <span class="number">9</span>)</span><br><span class="line">        B = A</span><br><span class="line">        A = TT1</span><br><span class="line">        H = G</span><br><span class="line">        G = rotate_left(F, <span class="number">19</span>)</span><br><span class="line">        F = E</span><br><span class="line">        E = P0(TT2)</span><br><span class="line">    <span class="keyword">return</span> [(x ^ y) &amp; <span class="number">0xFFFFFFFF</span> <span class="keyword">for</span> x, y <span class="keyword">in</span> <span class="built_in">zip</span>([A, B, C, D, E, F, G, H], V)]</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>


        <h2 id="四、杂凑值"   >
          <a href="#四、杂凑值" class="heading-link"><i class="fas fa-link"></i></a><a href="#四、杂凑值" class="headerlink" title="四、杂凑值"></a>四、杂凑值</h2>
      <p><img src="https://cdn.nlark.com/yuque/__latex/ac9ea6841ad50690b325061c7885b120.svg" alt="image"></p>
<p>输出256比特的杂凑值y &#x3D; ABCDEFGH。处理过程如下：</p>
<p><img src="https://cdn.nlark.com/yuque/0/2025/png/48372651/1742899743877-284bdbda-dedf-41e4-9ef2-08234b7f33cb.png"></p>

        <h2 id="五、完整代码"   >
          <a href="#五、完整代码" class="heading-link"><i class="fas fa-link"></i></a><a href="#五、完整代码" class="headerlink" title="五、完整代码"></a>五、完整代码</h2>
      <figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line">IV = [<span class="number">0x7380166f</span>, <span class="number">0x4914b2b9</span>, <span class="number">0x172442d7</span>, <span class="number">0xda8a0600</span>, <span class="number">0xa96f30bc</span>, <span class="number">0x163138aa</span>, <span class="number">0xe38dee4d</span>, <span class="number">0xb0fb0e4e</span>]</span><br><span class="line">T = [<span class="number">0x79cc4519</span>] * <span class="number">16</span> + [<span class="number">0x7a879d8a</span>] * <span class="number">48</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">rotate_left</span>(<span class="params">x, n</span>):</span><br><span class="line">    <span class="keyword">return</span> ((x &lt;&lt; n) | (x &gt;&gt; (<span class="number">32</span> - n))) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">FF</span>(<span class="params">j, X, Y, Z</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="number">0</span> &lt;= j &lt;= <span class="number">15</span>:</span><br><span class="line">        <span class="keyword">return</span> X ^ Y ^ Z</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> (X &amp; Y) | (X &amp; Z) | (Y &amp; Z)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">GG</span>(<span class="params">j, X, Y, Z</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="number">0</span> &lt;= j &lt;= <span class="number">15</span>:</span><br><span class="line">        <span class="keyword">return</span> X ^ Y ^ Z</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> (X &amp; Y) | (~X &amp; Z)</span><br><span class="line"></span><br><span class="line"><span class="comment">#置换函数</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">P0</span>(<span class="params">X</span>):</span><br><span class="line">    <span class="keyword">return</span> X ^ rotate_left(X, <span class="number">9</span>) ^ rotate_left(X, <span class="number">17</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">P1</span>(<span class="params">X</span>):</span><br><span class="line">    <span class="keyword">return</span> X ^ rotate_left(X, <span class="number">15</span>) ^ rotate_left(X, <span class="number">23</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#消息填充函数</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sm3_padding</span>(<span class="params">message</span>):</span><br><span class="line">    message_length = <span class="built_in">len</span>(message) * <span class="number">8</span></span><br><span class="line">    message = <span class="built_in">bytearray</span>(message)</span><br><span class="line">    message.append(<span class="number">0x80</span>)</span><br><span class="line">    <span class="keyword">while</span> (<span class="built_in">len</span>(message) * <span class="number">8</span>) % <span class="number">512</span> != <span class="number">448</span>:</span><br><span class="line">        message.append(<span class="number">0x00</span>)</span><br><span class="line">    message.extend(message_length.to_bytes(<span class="number">8</span>, byteorder=<span class="string">&#x27;big&#x27;</span>))</span><br><span class="line">    <span class="keyword">return</span> message</span><br><span class="line"></span><br><span class="line"><span class="comment">#单块处理函数</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sm3_process_block</span>(<span class="params">block, V</span>):</span><br><span class="line">    W = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>):</span><br><span class="line">        W.append(<span class="built_in">int</span>.from_bytes(block[i * <span class="number">4</span>:(i + <span class="number">1</span>) * <span class="number">4</span>], byteorder=<span class="string">&#x27;big&#x27;</span>))</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>, <span class="number">68</span>):</span><br><span class="line">        W.append(P1(W[i - <span class="number">16</span>] ^ W[i - <span class="number">9</span>] ^ rotate_left(W[i - <span class="number">3</span>], <span class="number">15</span>)) ^ rotate_left(W[i - <span class="number">13</span>], <span class="number">7</span>) ^ W[i - <span class="number">6</span>])</span><br><span class="line">    W1 = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">64</span>):</span><br><span class="line">        W1.append(W[i] ^ W[i + <span class="number">4</span>])</span><br><span class="line">    A, B, C, D, E, F, G, H = V</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">64</span>):</span><br><span class="line">        SS1 = rotate_left((rotate_left(A, <span class="number">12</span>) + E + rotate_left(T[j], j % <span class="number">32</span>)) &amp; <span class="number">0xFFFFFFFF</span>, <span class="number">7</span>)</span><br><span class="line">        SS2 = SS1 ^ rotate_left(A, <span class="number">12</span>)</span><br><span class="line">        TT1 = (FF(j, A, B, C) + D + SS2 + W1[j]) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">        TT2 = (GG(j, E, F, G) + H + SS1 + W[j]) &amp; <span class="number">0xFFFFFFFF</span></span><br><span class="line">        D = C</span><br><span class="line">        C = rotate_left(B, <span class="number">9</span>)</span><br><span class="line">        B = A</span><br><span class="line">        A = TT1</span><br><span class="line">        H = G</span><br><span class="line">        G = rotate_left(F, <span class="number">19</span>)</span><br><span class="line">        F = E</span><br><span class="line">        E = P0(TT2)</span><br><span class="line">    <span class="keyword">return</span> [(x ^ y) &amp; <span class="number">0xFFFFFFFF</span> <span class="keyword">for</span> x, y <span class="keyword">in</span> <span class="built_in">zip</span>([A, B, C, D, E, F, G, H], V)]</span><br><span class="line"></span><br><span class="line"><span class="comment">#哈希计算函数</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sm3_hash</span>(<span class="params">message</span>):</span><br><span class="line">    message = sm3_padding(message)</span><br><span class="line">    V = IV</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(message), <span class="number">64</span>):</span><br><span class="line">        block = message[i:i + <span class="number">64</span>]</span><br><span class="line">        V = sm3_process_block(block, V)</span><br><span class="line">    result = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> v <span class="keyword">in</span> V:</span><br><span class="line">        result += v.to_bytes(<span class="number">4</span>, byteorder=<span class="string">&#x27;big&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> result.<span class="built_in">hex</span>()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    message = <span class="built_in">input</span>(<span class="string">&quot;请输入要计算 SM3 哈希值的消息: &quot;</span>).encode()</span><br><span class="line">    hash_value = sm3_hash(message)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;SM3 Hash:&quot;</span>, hash_value)</span><br></pre></td></tr></table></div></figure>


        <h2 id="六、示例"   >
          <a href="#六、示例" class="heading-link"><i class="fas fa-link"></i></a><a href="#六、示例" class="headerlink" title="六、示例"></a>六、示例</h2>
      <ol>
<li>输入消息为“abc”</li>
</ol>
<p>杂凑值：66c7f0f4 62eeedd9 d1f2d46b dc10e4e2 4167c487 5cf2f7a2 297da02b 8f4ba8e0    </p>
<p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://www.yuque.com/attachments/yuque/0/2025/py/48372651/1743487737104-5a24c48e-a09c-4773-a530-c028ce50b0fa.py" >sm3.py</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
<p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://www.yuque.com/attachments/yuque/0/2025/py/48372651/1743488158262-c62a428a-785d-42e7-9ca2-4adec04a398b.py" >sm3_1.py</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
<p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://www.lzltool.com/SM3" >SM3在线加密工具</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
</div></div></article><article class="postlist-item post"><header class="post-header"><h1 class="post-title"><a class="post-title__link" href="/2025/03/26/crypto/%E6%A6%82%E5%BF%B5%E6%96%87%E6%A1%A3/%E5%88%86%E7%BB%84%E5%AF%86%E7%A0%81/AES%EF%BC%88Advanced%20Encryption%20Standard%EF%BC%89/">AES（Advanced Encryption Standard）</a></h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">发表于</span><span class="post-meta-item__value">2025-03-26</span></span></div></header><div class="post-body"><div class="post-excerpt">
        <h2 id="一、AES概述"   >
          <a href="#一、AES概述" class="heading-link"><i class="fas fa-link"></i></a><a href="#一、AES概述" class="headerlink" title="一、AES概述"></a>一、AES概述</h2>
      <p><font style="color:#000000;">AES加密算法，即</font><strong><font style="color:#000000;">Rijndael</font></strong><font style="color:#000000;">算法，是一种对称分组密码，它可以使用长度为128、192和256位的密钥处理128位的数据块。这些不同的“风格”可以称为“AES-128”、“AES-192” 和 “AES-256”。</font></p>
<p><font style="color:#000000;">本文使用python实现</font><strong><font style="color:#000000;">AES-128</font></strong><font style="color:#000000;">，使用</font><strong><font style="color:#000000;">CBC</font></strong><font style="color:#000000;">模式。</font></p>
<p><font style="color:#000000;"></font></p>

        <h2 id="二、AES算法框架"   >
          <a href="#二、AES算法框架" class="heading-link"><i class="fas fa-link"></i></a><a href="#二、AES算法框架" class="headerlink" title="二、AES算法框架"></a>二、AES算法框架</h2>
      <p><img src="https://cdn.nlark.com/yuque/0/2025/png/48372651/1742354210182-c95ef0ce-8949-4782-bac4-dbf059b42736.png"></p>
<ul>
<li><font style="color:rgba(0, 0, 0, 0.75);">字节代替（SubBytes）：用一个S盒完成分组的字节到字节的代替。</font></li>
<li><font style="color:rgba(0, 0, 0, 0.75);">行移位（ShiftRows）：一个简单的置换。</font></li>
<li><font style="color:rgba(0, 0, 0, 0.75);">列混淆（MixColumns）：利用域GF(2^8)上的算术特性的一个代替。</font></li>
<li><font style="color:rgba(0, 0, 0, 0.75);">轮密钥加（AddRoundKey）：当前分组和扩展密钥的一部分进行按位异或XOR。</font></li>
</ul>

        <h2 id="三、密钥扩展"   >
          <a href="#三、密钥扩展" class="heading-link"><i class="fas fa-link"></i></a><a href="#三、密钥扩展" class="headerlink" title="三、密钥扩展"></a>三、密钥扩展</h2>
      
        <h4 id="解释"   >
          <a href="#解释" class="heading-link"><i class="fas fa-link"></i></a><a href="#解释" class="headerlink" title="解释"></a>解释</h4>
      <p><font style="color:rgb(77, 77, 77);">AES首先将初始密钥输入到一个4*4的状态矩阵中，如下图所示：</font></p>
<p><img src="https://cdn.nlark.com/yuque/0/2025/png/48372651/1742353357598-7192b3b2-4fce-4be7-9e43-1572c55ea3cb.png"></p>
<p>这个4*4矩阵的每一列的4个字节组成一个字，矩阵4列的4个字依次命名为W[0]、W[1]、W[2]和W[3]，它们构成一个以字为单位的数组W。例如，设密钥K为”abcdefghijklmnop”,则K0 &#x3D; ‘a’,K1 &#x3D; ‘b’, K2 &#x3D; ‘c’,K3 &#x3D; ‘d’,W[0] &#x3D; “abcd”。</p>
<p>接着，对W数组扩充40个新列，构成总共44列的扩展密钥数组。新列以如下的递归方式产生：</p>
<p>1.如果i不是4的倍数，那么第i列由如下等式确定：</p>
<p><code>W[i]=W[i-4]⨁W[i-1]</code></p>
<p>2.如果i是4的倍数，那么第i列由如下等式确定：</p>
<p><code>W[i]=W[i-4]⨁T(W[i-1])</code></p>
<p>其中，T是一个有点复杂的函数。</p>
<p>函数T由3部分组成：字循环、字节代换和轮常量异或，这3部分的作用分别如下。</p>
<p>a.<strong>字循环</strong>：将1个字中的4个字节循环<strong>左移</strong>1个字节。即将输入字[b0, b1, b2, b3]变换成[b1,b2,b3,b0]。</p>
<p>b.<strong>字节代换</strong>：对字循环的结果使用S盒进行字节代换。</p>
<p>c.<strong>轮常量异或</strong>：将前两步的结果同轮常量Rcon[j]进行异或，其中j表示轮数。</p>
<p>轮常量Rcon[j]是一个字，其值见下表。</p>
<div class="table-container"><table>
<thead>
<tr>
<th>j</th>
<th>1</th>
<th>2</th>
<th>3</th>
<th>4</th>
<th>5</th>
</tr>
</thead>
<tbody><tr>
<td>Rcon[j]</td>
<td>01 00 00 00</td>
<td>02 00 00 00</td>
<td>04 00 00 00</td>
<td>08 00 00 00</td>
<td>10 00 00 00</td>
</tr>
<tr>
<td>j</td>
<td>6</td>
<td>7</td>
<td>8</td>
<td>9</td>
<td>10</td>
</tr>
<tr>
<td>Rcon[j]</td>
<td>20 00 00 00</td>
<td>40 00 00 00</td>
<td>80 00 00 00</td>
<td>1B 00 00 00</td>
<td>36 00 00 00</td>
</tr>
</tbody></table></div>
<p>下面举个例子：</p>
<blockquote>
<p>设初始的128位密钥为：</p>
<p>3C A1 0B 21 57 F0 19 16 90 2E 13 80 AC C1 07 BD</p>
<p>那么4个初始值为：</p>
<p>W[0] &#x3D; 3C A1 0B 21</p>
<p>W[1] &#x3D; 57 F0 19 16</p>
<p>W[2] &#x3D; 90 2E 13 80</p>
<p>W[3] &#x3D; AC C1 07 BD</p>
<p>下面求扩展的第1轮的子密钥(W[4],W[5],W[6],W[7])。</p>
<p>由于4是4的倍数，所以：</p>
<p>W[4] &#x3D; W[0] ⨁ T(W[3])</p>
<p>T(W[3])的计算步骤如下：</p>
<p>循环地将W[3]的元素移位：AC C1 07 BD变成C1 07 BD AC;</p>
<p>将 C1 07 BD AC 作为S盒的输入，输出为78 C5 7A 91;</p>
<p>将78 C5 7A 91与第一轮轮常量Rcon[1]进行异或运算，将得到79 C5 7A 91，因此，T(W[3])&#x3D;79 C5 7A 91，故</p>
<p>W[4] &#x3D; 3C A1 0B 21 ⨁ 79 C5 7A 91 &#x3D; 45 64 71 B0</p>
<p>其余的3个子密钥段的计算如下：</p>
<p>W[5] &#x3D; W[1] ⨁ W[4] &#x3D; 57 F0 19 16 ⨁ 45 64 71 B0 &#x3D; 12 94 68 A6</p>
<p>W[6] &#x3D; W[2] ⨁ W[5] &#x3D;90 2E 13 80 ⨁ 12 94 68 A6 &#x3D; 82 BA 7B 26</p>
<p>W[7] &#x3D; W[3] ⨁ W[6] &#x3D; AC C1 07 BD ⨁ 82 BA 7B 26 &#x3D; 2E 7B 7C 9B</p>
<p>所以，第一轮的密钥为 45 64 71 B0 12 94 68 A6 82 BA 7B 26 2E 7B 7C 9B。</p>
</blockquote>

        <h4 id="代码"   >
          <a href="#代码" class="heading-link"><i class="fas fa-link"></i></a><a href="#代码" class="headerlink" title="代码"></a>代码</h4>
      <figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">gen_key</span>(<span class="params">key</span>):</span><br><span class="line">    key_bytes = key.encode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(key_bytes) != <span class="number">16</span>:</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">&quot;Key must be 16 bytes after UTF-8 encoding.&quot;</span>)</span><br><span class="line">    key_hex = [<span class="built_in">hex</span>(b) <span class="keyword">for</span> b <span class="keyword">in</span> key_bytes]</span><br><span class="line">    key_rotate = [] </span><br><span class="line">    w = [[] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">44</span>)]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">16</span>):</span><br><span class="line">        w[i // <span class="number">4</span>].append(key_hex[i])</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>, <span class="number">44</span>):</span><br><span class="line">        gw = copy.deepcopy(w[i - <span class="number">1</span>])</span><br><span class="line">        <span class="keyword">if</span> i % <span class="number">4</span> == <span class="number">0</span>:</span><br><span class="line">            gw[<span class="number">0</span>], gw[<span class="number">1</span>], gw[<span class="number">2</span>], gw[<span class="number">3</span>] = gw[<span class="number">1</span>], gw[<span class="number">2</span>], gw[<span class="number">3</span>], gw[<span class="number">0</span>]</span><br><span class="line">            gw = substitute(gw) <span class="comment">#g(w(i-1))</span></span><br><span class="line">            gw[<span class="number">0</span>] = <span class="built_in">hex</span>(<span class="built_in">int</span>(gw[<span class="number">0</span>], <span class="number">16</span>) ^ rcon[i // <span class="number">4</span> - <span class="number">1</span>]) </span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">4</span>):</span><br><span class="line">            w[i].append(<span class="built_in">hex</span>(<span class="built_in">int</span>(gw[j], <span class="number">16</span>) ^ <span class="built_in">int</span>(w[i-<span class="number">4</span>][j], <span class="number">16</span>)))</span><br><span class="line">    key_rotate = [w[i * <span class="number">4</span>] + w[i * <span class="number">4</span> + <span class="number">1</span>] + w[i * <span class="number">4</span> + <span class="number">2</span>] + w[ i* <span class="number">4</span> + <span class="number">3</span>] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">11</span>)] <span class="comment"># 轮密钥列表,每个元素都是有16个字节的列表</span></span><br><span class="line">    <span class="keyword">return</span> key_rotate</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>




        <h2 id="四、加解密过程"   >
          <a href="#四、加解密过程" class="heading-link"><i class="fas fa-link"></i></a><a href="#四、加解密过程" class="headerlink" title="四、加解密过程"></a>四、加解密过程</h2>
      
        <h4 id="字节代换（SubBytes）"   >
          <a href="#字节代换（SubBytes）" class="heading-link"><i class="fas fa-link"></i></a><a href="#字节代换（SubBytes）" class="headerlink" title="字节代换（SubBytes）"></a>字节代换（SubBytes）</h4>
      
        <h5 id="解释-1"   >
          <a href="#解释-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#解释-1" class="headerlink" title="解释"></a>解释</h5>
      <p><font style="color:rgb(77, 77, 77);">AES的字节代换其实就是一个简单的查表操作。AES定义了一个S盒和一个逆S盒。</font><br><font style="color:rgb(77, 77, 77);">AES的S盒和逆S盒：</font></p>
<p><img src="https://cdn.nlark.com/yuque/0/2025/png/48372651/1742354226932-5abfae01-8465-44cf-bc45-60c1798e0ad1.png"></p>
<p><img src="https://cdn.nlark.com/yuque/0/2025/jpeg/48372651/1742354639926-e76ace21-c380-421b-a53f-dacb4aed5747.jpeg"></p>
<p><font style="color:rgb(77, 77, 77);">状态矩阵中的元素按照下面的方式映射为一个新的字节：把该字节的</font><u><font style="color:rgb(77, 77, 77);">高4位作为行值，低4位作为列值</font></u><font style="color:rgb(77, 77, 77);">，取出S盒或者逆S盒中对应的行的元素作为输出。例如，加密时，输出的字节S1为0x12,则查S盒的第0x01行和0x02列，得到值0xc9,然后替换S1原有的0x12为0xc9。状态矩阵经字节代换后的图如下：</font></p>
<p><img src="https://cdn.nlark.com/yuque/0/2025/png/48372651/1742354031480-536044da-5ee5-4cdb-943c-99fc2b850450.png"></p>
<p>S盒是按照这个公式计算出来的：<code>GF(2^8) = GF(2) [x]/(x^8 + x^4 + x^3 + x + 1)</code></p>
<p> <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://www.cnblogs.com/Junbo20141201/p/9369860.html" >AES128加密-S盒和逆S盒构造推导及代码实现</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> 、<span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Rijndael_S-box" >Rijndael S-box</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> 、 <span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="http://blog.leanote.com/post/heming/%E5%88%9D%E8%AF%86%E7%99%BD%E7%9B%92%E5%AF%86%E7%A0%81" >初识白盒密码</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> 、<span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Finite_field_arithmetic#Rijndael.27s_finite_field" >有限域算术 </a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>

        <h5 id="代码-1"   >
          <a href="#代码-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#代码-1" class="headerlink" title="代码"></a>代码</h5>
      <figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">substitute</span>(<span class="params">m_hex, inverse=<span class="literal">False</span></span>):</span><br><span class="line">    m_s = []</span><br><span class="line">    box = s_box <span class="keyword">if</span> <span class="keyword">not</span> inverse <span class="keyword">else</span> i_s_box</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> m_hex:</span><br><span class="line">        x, y = <span class="built_in">int</span>(i, <span class="number">16</span>) // <span class="number">16</span>, <span class="built_in">int</span>(i, <span class="number">16</span>) % <span class="number">16</span></span><br><span class="line">        temp = <span class="built_in">hex</span>(box[x*<span class="number">16</span>+y])</span><br><span class="line">        m_s.append(temp)</span><br><span class="line">    <span class="keyword">return</span> m_s</span><br></pre></td></tr></table></div></figure>




        <h4 id="行移位（ShiftRows）"   >
          <a href="#行移位（ShiftRows）" class="heading-link"><i class="fas fa-link"></i></a><a href="#行移位（ShiftRows）" class="headerlink" title="行移位（ShiftRows）"></a>行移位（ShiftRows）</h4>
      
        <h5 id="解释-2"   >
          <a href="#解释-2" class="heading-link"><i class="fas fa-link"></i></a><a href="#解释-2" class="headerlink" title="解释"></a>解释</h5>
      <p><strong><font style="color:rgb(77, 77, 77);">行移位是一个4x4的矩阵内部字节之间的置换，用于提供算法的扩散性。</font></strong></p>
<p><strong><font style="color:rgb(77, 77, 77);">行移位变换完成基于行的循环移位操作</font></strong><font style="color:rgb(77, 77, 77);">，变换方法为：第0行不变，第1行循环左移1个字节，第2行循环左移两个字节，第3行循环左移3个字节。如下图所示：（</font><strong><font style="color:#DF2A3F;">从上往下</font></strong><font style="color:rgb(77, 77, 77);">读）</font></p>
<p><img src="https://cdn.nlark.com/yuque/0/2025/png/48372651/1742355074669-982c6496-3cf7-4e1d-b9a0-e20910b9b69e.png"></p>
<p><font style="color:rgb(77, 77, 77);">逆向行移位即是相反的操作，即：第一行保持不变，第二行循环右移1个字节，第三行循环右移两个字节，第四行循环左移3个字节。</font></p>

        <h5 id="代码-2"   >
          <a href="#代码-2" class="heading-link"><i class="fas fa-link"></i></a><a href="#代码-2" class="headerlink" title="代码"></a>代码</h5>
      <figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">shiftrows</span>(<span class="params">a, inverse=<span class="literal">False</span></span>): <span class="comment">#inverse为True时表示为逆操作，默认为False</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> inverse:</span><br><span class="line">        <span class="keyword">return</span> [ a[<span class="number">0</span>], a[<span class="number">5</span>], a[<span class="number">10</span>], a[<span class="number">15</span>], </span><br><span class="line">                 a[<span class="number">4</span>], a[<span class="number">9</span>], a[<span class="number">14</span>], a[<span class="number">3</span>], </span><br><span class="line">                 a[<span class="number">8</span>], a[<span class="number">13</span>], a[<span class="number">2</span>], a[<span class="number">7</span>], </span><br><span class="line">                 a[<span class="number">12</span>], a[<span class="number">1</span>], a[<span class="number">6</span>], a[<span class="number">11</span>] ] </span><br><span class="line">    <span class="keyword">else</span> :</span><br><span class="line">         <span class="keyword">return</span>[ a[<span class="number">0</span>], a[<span class="number">13</span>], a[<span class="number">10</span>], a[<span class="number">7</span>], </span><br><span class="line">                 a[<span class="number">4</span>], a[<span class="number">1</span>], a[<span class="number">14</span>], a[<span class="number">11</span>], </span><br><span class="line">                 a[<span class="number">8</span>], a[<span class="number">5</span>], a[<span class="number">2</span>], a[<span class="number">15</span>], </span><br><span class="line">                 a[<span class="number">12</span>], a[<span class="number">9</span>], a[<span class="number">6</span>], a[<span class="number">3</span>] ]</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>




        <h4 id="列混淆（MixColumns）"   >
          <a href="#列混淆（MixColumns）" class="heading-link"><i class="fas fa-link"></i></a><a href="#列混淆（MixColumns）" class="headerlink" title="列混淆（MixColumns）"></a>列混淆（MixColumns）</h4>
      
        <h5 id="解释-3"   >
          <a href="#解释-3" class="heading-link"><i class="fas fa-link"></i></a><a href="#解释-3" class="headerlink" title="解释"></a>解释</h5>
      <p><font style="color:rgb(77, 77, 77);">列混淆是将状态数组的每一列乘以一个矩阵，其中乘法是在有限域GF(2^8)上进行的，分为正向列混淆和列混淆逆变换两种操作。正向列混淆用于加密操作，列混淆逆变换用于解密操作。</font><br><font style="color:rgb(77, 77, 77);">	正向列混淆变换过程：</font></p>
<p><img src="https://cdn.nlark.com/yuque/0/2025/png/48372651/1742355147566-af918b62-d9e9-428a-a7fe-685098ba9c60.png"></p>
<p><font style="color:rgb(77, 77, 77);">逆向列混淆变换可以再乘以矩阵的逆得到。</font></p>

        <h5 id="代码-3"   >
          <a href="#代码-3" class="heading-link"><i class="fas fa-link"></i></a><a href="#代码-3" class="headerlink" title="代码"></a>代码</h5>
      <figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">mixcolumn</span>(<span class="params">m_row, inverse=<span class="literal">False</span></span>):</span><br><span class="line">    matrix = mix_column_matrix <span class="keyword">if</span> <span class="keyword">not</span> inverse <span class="keyword">else</span> i_mix_column_matrix</span><br><span class="line">    m_col = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">16</span>):</span><br><span class="line">        x, y = i % <span class="number">4</span>, i // <span class="number">4</span> </span><br><span class="line">        result = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">4</span>):</span><br><span class="line">            result ^= (mul(matrix[x * <span class="number">4</span> + j], <span class="built_in">int</span>(m_row[y * <span class="number">4</span> + j], <span class="number">16</span>)))</span><br><span class="line">        result = mod(result)</span><br><span class="line">        m_col.append(<span class="built_in">hex</span>(result))</span><br><span class="line">    <span class="keyword">return</span> m_col</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>




        <h4 id="轮密钥加（AddRoundKey）"   >
          <a href="#轮密钥加（AddRoundKey）" class="heading-link"><i class="fas fa-link"></i></a><a href="#轮密钥加（AddRoundKey）" class="headerlink" title="轮密钥加（AddRoundKey）"></a>轮密钥加（AddRoundKey）</h4>
      
        <h5 id="解释-4"   >
          <a href="#解释-4" class="heading-link"><i class="fas fa-link"></i></a><a href="#解释-4" class="headerlink" title="解释"></a>解释</h5>
      <p>轮密钥加是将轮密钥简单地与状态进行逐比特异或。这个操作相对简单，其依据的原理是“任何数和自身的异或结果为0”。加密过程中，每轮的输入与轮子密钥异或一次；因此，解密时再异或上该轮的轮子密钥即可恢复。</p>
<p>轮密钥加过程可以看成是字逐位异或的结果，也可以看成字节级别或者位级别的操作。也就是说，可以看成S0 S1 S2 S3 组成的32位字与W[4i]的异或运算。</p>
<p><img src="https://cdn.nlark.com/yuque/0/2025/png/48372651/1742355206935-d1249ae4-f521-46bb-9bc9-52f04746e03a.png"></p>

        <h2 id="五、完整代码"   >
          <a href="#五、完整代码" class="heading-link"><i class="fas fa-link"></i></a><a href="#五、完整代码" class="headerlink" title="五、完整代码"></a>五、完整代码</h2>
      <figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#分组长度为16个字节，加密10轮</span></span><br><span class="line"><span class="comment">#AES-128</span></span><br><span class="line"><span class="keyword">import</span> copy</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="comment"># 密钥扩展</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">gen_key</span>(<span class="params">key</span>):</span><br><span class="line">    key_bytes = key.encode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(key_bytes) != <span class="number">16</span>:</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">&quot;Key must be 16 bytes after UTF-8 encoding.&quot;</span>)</span><br><span class="line">    key_hex = [<span class="built_in">hex</span>(b) <span class="keyword">for</span> b <span class="keyword">in</span> key_bytes]</span><br><span class="line">    key_rotate = [] </span><br><span class="line">    w = [[] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">44</span>)]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">16</span>):</span><br><span class="line">        w[i // <span class="number">4</span>].append(key_hex[i])</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>, <span class="number">44</span>):</span><br><span class="line">        gw = copy.deepcopy(w[i - <span class="number">1</span>])</span><br><span class="line">        <span class="keyword">if</span> i % <span class="number">4</span> == <span class="number">0</span>:</span><br><span class="line">            gw[<span class="number">0</span>], gw[<span class="number">1</span>], gw[<span class="number">2</span>], gw[<span class="number">3</span>] = gw[<span class="number">1</span>], gw[<span class="number">2</span>], gw[<span class="number">3</span>], gw[<span class="number">0</span>]</span><br><span class="line">            gw = substitute(gw) <span class="comment">#g(w(i-1))</span></span><br><span class="line">            gw[<span class="number">0</span>] = <span class="built_in">hex</span>(<span class="built_in">int</span>(gw[<span class="number">0</span>], <span class="number">16</span>) ^ rcon[i // <span class="number">4</span> - <span class="number">1</span>]) </span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">4</span>):</span><br><span class="line">            w[i].append(<span class="built_in">hex</span>(<span class="built_in">int</span>(gw[j], <span class="number">16</span>) ^ <span class="built_in">int</span>(w[i-<span class="number">4</span>][j], <span class="number">16</span>)))</span><br><span class="line">    key_rotate = [w[i * <span class="number">4</span>] + w[i * <span class="number">4</span> + <span class="number">1</span>] + w[i * <span class="number">4</span> + <span class="number">2</span>] + w[ i* <span class="number">4</span> + <span class="number">3</span>] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">11</span>)] <span class="comment"># 轮密钥列表,每个元素都是有16个字节的列表</span></span><br><span class="line">    <span class="keyword">return</span> key_rotate</span><br><span class="line"></span><br><span class="line"><span class="comment"># 两个多项式相乘</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">mul</span>(<span class="params">poly1, poly2</span>):</span><br><span class="line">	result = <span class="number">0</span>  </span><br><span class="line">	<span class="keyword">for</span> index <span class="keyword">in</span> <span class="built_in">range</span>(poly2.bit_length()):</span><br><span class="line">		<span class="keyword">if</span> poly2 &amp; (<span class="number">1</span> &lt;&lt; index):</span><br><span class="line">			result ^= (poly1 &lt;&lt; index)</span><br><span class="line">	<span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"><span class="comment"># 多项式poly模多项式100011011</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">mod</span>(<span class="params">poly, mod = <span class="number">0b100011011</span></span>):    </span><br><span class="line">	<span class="keyword">while</span> poly.bit_length() &gt; <span class="number">8</span>:  </span><br><span class="line">		poly ^= (mod &lt;&lt; (poly.bit_length() - <span class="number">9</span>))</span><br><span class="line">	<span class="keyword">return</span> poly</span><br><span class="line"></span><br><span class="line"><span class="comment">#对输入的十六进制列表 m_hex 进行字节代换操作。</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">substitute</span>(<span class="params">m_hex, inverse=<span class="literal">False</span></span>):</span><br><span class="line">    m_s = []</span><br><span class="line">    box = s_box <span class="keyword">if</span> <span class="keyword">not</span> inverse <span class="keyword">else</span> i_s_box</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> m_hex:</span><br><span class="line">        x, y = <span class="built_in">int</span>(i, <span class="number">16</span>) // <span class="number">16</span>, <span class="built_in">int</span>(i, <span class="number">16</span>) % <span class="number">16</span></span><br><span class="line">        temp = <span class="built_in">hex</span>(box[x*<span class="number">16</span>+y])</span><br><span class="line">        m_s.append(temp)</span><br><span class="line">    <span class="keyword">return</span> m_s</span><br><span class="line"></span><br><span class="line">s_box = [<span class="number">0x63</span>, <span class="number">0x7C</span>, <span class="number">0x77</span>, <span class="number">0x7B</span>, <span class="number">0xF2</span>, <span class="number">0x6B</span>, <span class="number">0x6F</span>, <span class="number">0xC5</span>, <span class="number">0x30</span>, <span class="number">0x01</span>, <span class="number">0x67</span>, <span class="number">0x2B</span>, <span class="number">0xFE</span>, <span class="number">0xD7</span>, <span class="number">0xAB</span>, <span class="number">0x76</span>,</span><br><span class="line">        <span class="number">0xCA</span>, <span class="number">0x82</span>, <span class="number">0xC9</span>, <span class="number">0x7D</span>, <span class="number">0xFA</span>, <span class="number">0x59</span>, <span class="number">0x47</span>, <span class="number">0xF0</span>, <span class="number">0xAD</span>, <span class="number">0xD4</span>, <span class="number">0xA2</span>, <span class="number">0xAF</span>, <span class="number">0x9C</span>, <span class="number">0xA4</span>, <span class="number">0x72</span>, <span class="number">0xC0</span>,</span><br><span class="line">        <span class="number">0xB7</span>, <span class="number">0xFD</span>, <span class="number">0x93</span>, <span class="number">0x26</span>, <span class="number">0x36</span>, <span class="number">0x3F</span>, <span class="number">0xF7</span>, <span class="number">0xCC</span>, <span class="number">0x34</span>, <span class="number">0xA5</span>, <span class="number">0xE5</span>, <span class="number">0xF1</span>, <span class="number">0x71</span>, <span class="number">0xD8</span>, <span class="number">0x31</span>, <span class="number">0x15</span>, </span><br><span class="line">        <span class="number">0x04</span>, <span class="number">0xC7</span>, <span class="number">0x23</span>, <span class="number">0xC3</span>, <span class="number">0x18</span>, <span class="number">0x96</span>, <span class="number">0x05</span>, <span class="number">0x9A</span>, <span class="number">0x07</span>, <span class="number">0x12</span>, <span class="number">0x80</span>, <span class="number">0xE2</span>, <span class="number">0xEB</span>, <span class="number">0x27</span>, <span class="number">0xB2</span>, <span class="number">0x75</span>, </span><br><span class="line">        <span class="number">0x09</span>, <span class="number">0x83</span>, <span class="number">0x2C</span>, <span class="number">0x1A</span>, <span class="number">0x1B</span>, <span class="number">0x6E</span>, <span class="number">0x5A</span>, <span class="number">0xA0</span>, <span class="number">0x52</span>, <span class="number">0x3B</span>, <span class="number">0xD6</span>, <span class="number">0xB3</span>, <span class="number">0x29</span>, <span class="number">0xE3</span>, <span class="number">0x2F</span>, <span class="number">0x84</span>,</span><br><span class="line">        <span class="number">0x53</span>, <span class="number">0xD1</span>, <span class="number">0x00</span>, <span class="number">0xED</span>, <span class="number">0x20</span>, <span class="number">0xFC</span>, <span class="number">0xB1</span>, <span class="number">0x5B</span>, <span class="number">0x6A</span>, <span class="number">0xCB</span>, <span class="number">0xBE</span>, <span class="number">0x39</span>, <span class="number">0x4A</span>, <span class="number">0x4C</span>, <span class="number">0x58</span>, <span class="number">0xCF</span>, </span><br><span class="line">        <span class="number">0xD0</span>, <span class="number">0xEF</span>, <span class="number">0xAA</span>, <span class="number">0xFB</span>, <span class="number">0x43</span>, <span class="number">0x4D</span>, <span class="number">0x33</span>, <span class="number">0x85</span>, <span class="number">0x45</span>, <span class="number">0xF9</span>, <span class="number">0x02</span>, <span class="number">0x7F</span>, <span class="number">0x50</span>, <span class="number">0x3C</span>, <span class="number">0x9F</span>, <span class="number">0xA8</span>, </span><br><span class="line">        <span class="number">0x51</span>, <span class="number">0xA3</span>, <span class="number">0x40</span>, <span class="number">0x8F</span>, <span class="number">0x92</span>, <span class="number">0x9D</span>, <span class="number">0x38</span>, <span class="number">0xF5</span>, <span class="number">0xBC</span>, <span class="number">0xB6</span>, <span class="number">0xDA</span>, <span class="number">0x21</span>, <span class="number">0x10</span>, <span class="number">0xFF</span>, <span class="number">0xF3</span>, <span class="number">0xD2</span>, </span><br><span class="line">        <span class="number">0xCD</span>, <span class="number">0x0C</span>, <span class="number">0x13</span>, <span class="number">0xEC</span>, <span class="number">0x5F</span>, <span class="number">0x97</span>, <span class="number">0x44</span>, <span class="number">0x17</span>, <span class="number">0xC4</span>, <span class="number">0xA7</span>, <span class="number">0x7E</span>, <span class="number">0x3D</span>, <span class="number">0x64</span>, <span class="number">0x5D</span>, <span class="number">0x19</span>, <span class="number">0x73</span>, </span><br><span class="line">        <span class="number">0x60</span>, <span class="number">0x81</span>, <span class="number">0x4F</span>, <span class="number">0xDC</span>, <span class="number">0x22</span>, <span class="number">0x2A</span>, <span class="number">0x90</span>, <span class="number">0x88</span>, <span class="number">0x46</span>, <span class="number">0xEE</span>, <span class="number">0xB8</span>, <span class="number">0x14</span>, <span class="number">0xDE</span>, <span class="number">0x5E</span>, <span class="number">0x0B</span>, <span class="number">0xDB</span>, </span><br><span class="line">        <span class="number">0xE0</span>, <span class="number">0x32</span>, <span class="number">0x3A</span>, <span class="number">0x0A</span>, <span class="number">0x49</span>, <span class="number">0x06</span>, <span class="number">0x24</span>, <span class="number">0x5C</span>, <span class="number">0xC2</span>, <span class="number">0xD3</span>, <span class="number">0xAC</span>, <span class="number">0x62</span>, <span class="number">0x91</span>, <span class="number">0x95</span>, <span class="number">0xE4</span>, <span class="number">0x79</span>, </span><br><span class="line">        <span class="number">0xE7</span>, <span class="number">0xC8</span>, <span class="number">0x37</span>, <span class="number">0x6D</span>, <span class="number">0x8D</span>, <span class="number">0xD5</span>, <span class="number">0x4E</span>, <span class="number">0xA9</span>, <span class="number">0x6C</span>, <span class="number">0x56</span>, <span class="number">0xF4</span>, <span class="number">0xEA</span>, <span class="number">0x65</span>, <span class="number">0x7A</span>, <span class="number">0xAE</span>, <span class="number">0x08</span>, </span><br><span class="line">        <span class="number">0xBA</span>, <span class="number">0x78</span>, <span class="number">0x25</span>, <span class="number">0x2E</span>, <span class="number">0x1C</span>, <span class="number">0xA6</span>, <span class="number">0xB4</span>, <span class="number">0xC6</span>, <span class="number">0xE8</span>, <span class="number">0xDD</span>, <span class="number">0x74</span>, <span class="number">0x1F</span>, <span class="number">0x4B</span>, <span class="number">0xBD</span>, <span class="number">0x8B</span>, <span class="number">0x8A</span>, </span><br><span class="line">        <span class="number">0x70</span>, <span class="number">0x3E</span>, <span class="number">0xB5</span>, <span class="number">0x66</span>, <span class="number">0x48</span>, <span class="number">0x03</span>, <span class="number">0xF6</span>, <span class="number">0x0E</span>, <span class="number">0x61</span>, <span class="number">0x35</span>, <span class="number">0x57</span>, <span class="number">0xB9</span>, <span class="number">0x86</span>, <span class="number">0xC1</span>, <span class="number">0x1D</span>, <span class="number">0x9E</span>, </span><br><span class="line">        <span class="number">0xE1</span>, <span class="number">0xF8</span>, <span class="number">0x98</span>, <span class="number">0x11</span>, <span class="number">0x69</span>, <span class="number">0xD9</span>, <span class="number">0x8E</span>, <span class="number">0x94</span>, <span class="number">0x9B</span>, <span class="number">0x1E</span>, <span class="number">0x87</span>, <span class="number">0xE9</span>, <span class="number">0xCE</span>, <span class="number">0x55</span>, <span class="number">0x28</span>, <span class="number">0xDF</span>, </span><br><span class="line">        <span class="number">0x8C</span>, <span class="number">0xA1</span>, <span class="number">0x89</span>, <span class="number">0x0D</span>, <span class="number">0xBF</span>, <span class="number">0xE6</span>, <span class="number">0x42</span>, <span class="number">0x68</span>, <span class="number">0x41</span>, <span class="number">0x99</span>, <span class="number">0x2D</span>, <span class="number">0x0F</span>, <span class="number">0xB0</span>, <span class="number">0x54</span>, <span class="number">0xBB</span>, <span class="number">0x16</span>]</span><br><span class="line">i_s_box = [<span class="number">0x52</span>, <span class="number">0x09</span>, <span class="number">0x6A</span>, <span class="number">0xD5</span>, <span class="number">0x30</span>, <span class="number">0x36</span>, <span class="number">0xA5</span>, <span class="number">0x38</span>, <span class="number">0xBF</span>, <span class="number">0x40</span>, <span class="number">0xA3</span>, <span class="number">0x9E</span>, <span class="number">0x81</span>, <span class="number">0xF3</span>, <span class="number">0xD7</span>, <span class="number">0xFB</span>, </span><br><span class="line">           <span class="number">0x7C</span>, <span class="number">0xE3</span>, <span class="number">0x39</span>, <span class="number">0x82</span>, <span class="number">0x9B</span>, <span class="number">0x2F</span>, <span class="number">0xFF</span>, <span class="number">0x87</span>, <span class="number">0x34</span>, <span class="number">0x8E</span>, <span class="number">0x43</span>, <span class="number">0x44</span>, <span class="number">0xC4</span>, <span class="number">0xDE</span>, <span class="number">0xE9</span>, <span class="number">0xCB</span>, </span><br><span class="line">           <span class="number">0x54</span>, <span class="number">0x7B</span>, <span class="number">0x94</span>, <span class="number">0x32</span>, <span class="number">0xA6</span>, <span class="number">0xC2</span>, <span class="number">0x23</span>, <span class="number">0x3D</span>, <span class="number">0xEE</span>, <span class="number">0x4C</span>, <span class="number">0x95</span>, <span class="number">0x0B</span>, <span class="number">0x42</span>, <span class="number">0xFA</span>, <span class="number">0xC3</span>, <span class="number">0x4E</span>, </span><br><span class="line">           <span class="number">0x08</span>, <span class="number">0x2E</span>, <span class="number">0xA1</span>, <span class="number">0x66</span>, <span class="number">0x28</span>, <span class="number">0xD9</span>, <span class="number">0x24</span>, <span class="number">0xB2</span>, <span class="number">0x76</span>, <span class="number">0x5B</span>, <span class="number">0xA2</span>, <span class="number">0x49</span>, <span class="number">0x6D</span>, <span class="number">0x8B</span>, <span class="number">0xD1</span>, <span class="number">0x25</span>, </span><br><span class="line">           <span class="number">0x72</span>, <span class="number">0xF8</span>, <span class="number">0xF6</span>, <span class="number">0x64</span>, <span class="number">0x86</span>, <span class="number">0x68</span>, <span class="number">0x98</span>, <span class="number">0x16</span>, <span class="number">0xD4</span>, <span class="number">0xA4</span>, <span class="number">0x5C</span>, <span class="number">0xCC</span>, <span class="number">0x5D</span>, <span class="number">0x65</span>, <span class="number">0xB6</span>, <span class="number">0x92</span>, </span><br><span class="line">           <span class="number">0x6C</span>, <span class="number">0x70</span>, <span class="number">0x48</span>, <span class="number">0x50</span>, <span class="number">0xFD</span>, <span class="number">0xED</span>, <span class="number">0xB9</span>, <span class="number">0xDA</span>, <span class="number">0x5E</span>, <span class="number">0x15</span>, <span class="number">0x46</span>, <span class="number">0x57</span>, <span class="number">0xA7</span>, <span class="number">0x8D</span>, <span class="number">0x9D</span>, <span class="number">0x84</span>, </span><br><span class="line">           <span class="number">0x90</span>, <span class="number">0xD8</span>, <span class="number">0xAB</span>, <span class="number">0x00</span>, <span class="number">0x8C</span>, <span class="number">0xBC</span>, <span class="number">0xD3</span>, <span class="number">0x0A</span>, <span class="number">0xF7</span>, <span class="number">0xE4</span>, <span class="number">0x58</span>, <span class="number">0x05</span>, <span class="number">0xB8</span>, <span class="number">0xB3</span>, <span class="number">0x45</span>, <span class="number">0x06</span>, </span><br><span class="line">           <span class="number">0xD0</span>, <span class="number">0x2C</span>, <span class="number">0x1E</span>, <span class="number">0x8F</span>, <span class="number">0xCA</span>, <span class="number">0x3F</span>, <span class="number">0x0F</span>, <span class="number">0x02</span>, <span class="number">0xC1</span>, <span class="number">0xAF</span>, <span class="number">0xBD</span>, <span class="number">0x03</span>, <span class="number">0x01</span>, <span class="number">0x13</span>, <span class="number">0x8A</span>, <span class="number">0x6B</span>, </span><br><span class="line">           <span class="number">0x3A</span>, <span class="number">0x91</span>, <span class="number">0x11</span>, <span class="number">0x41</span>, <span class="number">0x4F</span>, <span class="number">0x67</span>, <span class="number">0xDC</span>, <span class="number">0xEA</span>, <span class="number">0x97</span>, <span class="number">0xF2</span>, <span class="number">0xCF</span>, <span class="number">0xCE</span>, <span class="number">0xF0</span>, <span class="number">0xB4</span>, <span class="number">0xE6</span>, <span class="number">0x73</span>, </span><br><span class="line">           <span class="number">0x96</span>, <span class="number">0xAC</span>, <span class="number">0x74</span>, <span class="number">0x22</span>, <span class="number">0xE7</span>, <span class="number">0xAD</span>, <span class="number">0x35</span>, <span class="number">0x85</span>, <span class="number">0xE2</span>, <span class="number">0xF9</span>, <span class="number">0x37</span>, <span class="number">0xE8</span>, <span class="number">0x1C</span>, <span class="number">0x75</span>, <span class="number">0xDF</span>, <span class="number">0x6E</span>, </span><br><span class="line">           <span class="number">0x47</span>, <span class="number">0xF1</span>, <span class="number">0x1A</span>, <span class="number">0x71</span>, <span class="number">0x1D</span>, <span class="number">0x29</span>, <span class="number">0xC5</span>, <span class="number">0x89</span>, <span class="number">0x6F</span>, <span class="number">0xB7</span>, <span class="number">0x62</span>, <span class="number">0x0E</span>, <span class="number">0xAA</span>, <span class="number">0x18</span>, <span class="number">0xBE</span>, <span class="number">0x1B</span>, </span><br><span class="line">           <span class="number">0xFC</span>, <span class="number">0x56</span>, <span class="number">0x3E</span>, <span class="number">0x4B</span>, <span class="number">0xC6</span>, <span class="number">0xD2</span>, <span class="number">0x79</span>, <span class="number">0x20</span>, <span class="number">0x9A</span>, <span class="number">0xDB</span>, <span class="number">0xC0</span>, <span class="number">0xFE</span>, <span class="number">0x78</span>, <span class="number">0xCD</span>, <span class="number">0x5A</span>, <span class="number">0xF4</span>, </span><br><span class="line">           <span class="number">0x1F</span>, <span class="number">0xDD</span>, <span class="number">0xA8</span>, <span class="number">0x33</span>, <span class="number">0x88</span>, <span class="number">0x07</span>, <span class="number">0xC7</span>, <span class="number">0x31</span>, <span class="number">0xB1</span>, <span class="number">0x12</span>, <span class="number">0x10</span>, <span class="number">0x59</span>, <span class="number">0x27</span>, <span class="number">0x80</span>, <span class="number">0xEC</span>, <span class="number">0x5F</span>, </span><br><span class="line">           <span class="number">0x60</span>, <span class="number">0x51</span>, <span class="number">0x7F</span>, <span class="number">0xA9</span>, <span class="number">0x19</span>, <span class="number">0xB5</span>, <span class="number">0x4A</span>, <span class="number">0x0D</span>, <span class="number">0x2D</span>, <span class="number">0xE5</span>, <span class="number">0x7A</span>, <span class="number">0x9F</span>, <span class="number">0x93</span>, <span class="number">0xC9</span>, <span class="number">0x9C</span>, <span class="number">0xEF</span>, </span><br><span class="line">           <span class="number">0xA0</span>, <span class="number">0xE0</span>, <span class="number">0x3B</span>, <span class="number">0x4D</span>, <span class="number">0xAE</span>, <span class="number">0x2A</span>, <span class="number">0xF5</span>, <span class="number">0xB0</span>, <span class="number">0xC8</span>, <span class="number">0xEB</span>, <span class="number">0xBB</span>, <span class="number">0x3C</span>, <span class="number">0x83</span>, <span class="number">0x53</span>, <span class="number">0x99</span>, <span class="number">0x61</span>, </span><br><span class="line">           <span class="number">0x17</span>, <span class="number">0x2B</span>, <span class="number">0x04</span>, <span class="number">0x7E</span>, <span class="number">0xBA</span>, <span class="number">0x77</span>, <span class="number">0xD6</span>, <span class="number">0x26</span>, <span class="number">0xE1</span>, <span class="number">0x69</span>, <span class="number">0x14</span>, <span class="number">0x63</span>, <span class="number">0x55</span>, <span class="number">0x21</span>, <span class="number">0x0C</span>, <span class="number">0x7D</span>]</span><br><span class="line"></span><br><span class="line">rcon = [<span class="number">0x1</span>, <span class="number">0x2</span>, <span class="number">0x4</span>, <span class="number">0x8</span>, <span class="number">0x10</span>, <span class="number">0x20</span>, <span class="number">0x40</span>, <span class="number">0x80</span>, <span class="number">0x1B</span>, <span class="number">0x36</span>]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">xor</span>(<span class="params">a, key</span>):</span><br><span class="line">    <span class="keyword">return</span> [<span class="built_in">hex</span>(<span class="built_in">int</span>(ai, <span class="number">16</span>) ^ <span class="built_in">int</span>(ki, <span class="number">16</span>)) <span class="keyword">for</span> ai, ki <span class="keyword">in</span> <span class="built_in">zip</span>(a, key)]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 行移位</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">shiftrows</span>(<span class="params">a, inverse=<span class="literal">False</span></span>): <span class="comment">#inverse为True时表示为逆操作，默认为False</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> inverse:</span><br><span class="line">        <span class="keyword">return</span> [ a[<span class="number">0</span>], a[<span class="number">5</span>], a[<span class="number">10</span>], a[<span class="number">15</span>], </span><br><span class="line">                 a[<span class="number">4</span>], a[<span class="number">9</span>], a[<span class="number">14</span>], a[<span class="number">3</span>], </span><br><span class="line">                 a[<span class="number">8</span>], a[<span class="number">13</span>], a[<span class="number">2</span>], a[<span class="number">7</span>], </span><br><span class="line">                 a[<span class="number">12</span>], a[<span class="number">1</span>], a[<span class="number">6</span>], a[<span class="number">11</span>] ] </span><br><span class="line">    <span class="keyword">else</span> :</span><br><span class="line">         <span class="keyword">return</span>[ a[<span class="number">0</span>], a[<span class="number">13</span>], a[<span class="number">10</span>], a[<span class="number">7</span>], </span><br><span class="line">                 a[<span class="number">4</span>], a[<span class="number">1</span>], a[<span class="number">14</span>], a[<span class="number">11</span>], </span><br><span class="line">                 a[<span class="number">8</span>], a[<span class="number">5</span>], a[<span class="number">2</span>], a[<span class="number">15</span>], </span><br><span class="line">                 a[<span class="number">12</span>], a[<span class="number">9</span>], a[<span class="number">6</span>], a[<span class="number">3</span>] ]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 列混淆</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">mixcolumn</span>(<span class="params">m_row, inverse=<span class="literal">False</span></span>):</span><br><span class="line">    matrix = mix_column_matrix <span class="keyword">if</span> <span class="keyword">not</span> inverse <span class="keyword">else</span> i_mix_column_matrix</span><br><span class="line">    m_col = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">16</span>):</span><br><span class="line">        x, y = i % <span class="number">4</span>, i // <span class="number">4</span> </span><br><span class="line">        result = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">4</span>):</span><br><span class="line">            result ^= (mul(matrix[x * <span class="number">4</span> + j], <span class="built_in">int</span>(m_row[y * <span class="number">4</span> + j], <span class="number">16</span>)))</span><br><span class="line">        result = mod(result)</span><br><span class="line">        m_col.append(<span class="built_in">hex</span>(result))</span><br><span class="line">    <span class="keyword">return</span> m_col</span><br><span class="line"></span><br><span class="line"><span class="comment"># 列混合乘的矩阵</span></span><br><span class="line">mix_column_matrix   = [<span class="number">0x2</span>, <span class="number">0x3</span>, <span class="number">0x1</span>, <span class="number">0x1</span>, </span><br><span class="line">                       <span class="number">0x1</span>, <span class="number">0x2</span>, <span class="number">0x3</span>, <span class="number">0x1</span>, </span><br><span class="line">                       <span class="number">0x1</span>, <span class="number">0x1</span>, <span class="number">0x2</span>, <span class="number">0x3</span>, </span><br><span class="line">                       <span class="number">0x3</span>, <span class="number">0x1</span>, <span class="number">0x1</span>, <span class="number">0x2</span>] </span><br><span class="line"><span class="comment"># 列混合乘的逆矩阵</span></span><br><span class="line">i_mix_column_matrix = [<span class="number">0xe</span>, <span class="number">0xb</span>, <span class="number">0xd</span>, <span class="number">0x9</span>, </span><br><span class="line">                       <span class="number">0x9</span>, <span class="number">0xe</span>, <span class="number">0xb</span>, <span class="number">0xd</span>, </span><br><span class="line">                       <span class="number">0xd</span>, <span class="number">0x9</span>, <span class="number">0xe</span>, <span class="number">0xb</span>, </span><br><span class="line">                       <span class="number">0xb</span>, <span class="number">0xd</span>, <span class="number">0x9</span>, <span class="number">0xe</span>] </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">aes_encrypt_block</span>(<span class="params">block, key_rotate</span>):</span><br><span class="line">    state = block</span><br><span class="line">    state = xor(state, key_rotate[<span class="number">0</span>])</span><br><span class="line">    <span class="keyword">for</span> rnd <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">10</span>):</span><br><span class="line">        state = substitute(state)</span><br><span class="line">        state = shiftrows(state)</span><br><span class="line">        state = mixcolumn(state)</span><br><span class="line">        state = xor(state, key_rotate[rnd])</span><br><span class="line">    state = substitute(state)</span><br><span class="line">    state = shiftrows(state)</span><br><span class="line">    state = xor(state, key_rotate[<span class="number">10</span>])</span><br><span class="line">    <span class="keyword">return</span> [<span class="built_in">int</span>(b, <span class="number">16</span>) <span class="keyword">for</span> b <span class="keyword">in</span> state]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">aes_decrypt_block</span>(<span class="params">block, key_rotate</span>):</span><br><span class="line">    state = block</span><br><span class="line">    state = xor(state, key_rotate[<span class="number">10</span>])</span><br><span class="line">    state = shiftrows(state, inverse=<span class="literal">True</span>)</span><br><span class="line">    state = substitute(state, inverse=<span class="literal">True</span>)</span><br><span class="line">    <span class="keyword">for</span> rnd <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">9</span>, <span class="number">0</span>, -<span class="number">1</span>):</span><br><span class="line">        state = xor(state, key_rotate[rnd])</span><br><span class="line">        state = mixcolumn(state, inverse=<span class="literal">True</span>)</span><br><span class="line">        state = shiftrows(state, inverse=<span class="literal">True</span>)</span><br><span class="line">        state = substitute(state, inverse=<span class="literal">True</span>)</span><br><span class="line">    state = xor(state, key_rotate[<span class="number">0</span>])</span><br><span class="line">    <span class="keyword">return</span> [<span class="built_in">int</span>(b, <span class="number">16</span>) <span class="keyword">for</span> b <span class="keyword">in</span> state]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">pad</span>(<span class="params">data</span>):</span><br><span class="line">    pad_len = <span class="number">16</span> - (<span class="built_in">len</span>(data) % <span class="number">16</span>)</span><br><span class="line">    <span class="keyword">return</span> data + <span class="built_in">bytes</span>([pad_len] * pad_len)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">unpad</span>(<span class="params">data</span>):</span><br><span class="line">    pad_len = data[-<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">return</span> data[:-pad_len]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">aes_cbc_encrypt</span>(<span class="params">plaintext, key</span>):</span><br><span class="line">    key_rotate = gen_key(key)</span><br><span class="line">    iv = os.urandom(<span class="number">16</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;\n[生成随机IV] (16字节): <span class="subst">&#123;iv.<span class="built_in">hex</span>()&#125;</span>&quot;</span>)</span><br><span class="line">    plaintext = pad(plaintext.encode())</span><br><span class="line">    blocks = [plaintext[i:i+<span class="number">16</span>] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(plaintext), <span class="number">16</span>)]</span><br><span class="line">    ciphertext = iv</span><br><span class="line">    prev = iv</span><br><span class="line">    <span class="keyword">for</span> block <span class="keyword">in</span> blocks:</span><br><span class="line">        block = <span class="built_in">bytes</span>([b ^ p <span class="keyword">for</span> b, p <span class="keyword">in</span> <span class="built_in">zip</span>(block, prev)])</span><br><span class="line">        encrypted = aes_encrypt_block([<span class="built_in">hex</span>(b)[<span class="number">2</span>:].zfill(<span class="number">2</span>) <span class="keyword">for</span> b <span class="keyword">in</span> block], key_rotate)</span><br><span class="line">        encrypted_bytes = <span class="built_in">bytes</span>(encrypted)</span><br><span class="line">        ciphertext += encrypted_bytes</span><br><span class="line">        prev = encrypted_bytes</span><br><span class="line">    <span class="keyword">return</span> ciphertext.<span class="built_in">hex</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">aes_cbc_decrypt</span>(<span class="params">ciphertext, key</span>):</span><br><span class="line">    key_rotate = gen_key(key)</span><br><span class="line">    ciphertext = <span class="built_in">bytes</span>.fromhex(ciphertext)</span><br><span class="line">    iv = ciphertext[:<span class="number">16</span>]</span><br><span class="line">    blocks = [ciphertext[i:i+<span class="number">16</span>] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>, <span class="built_in">len</span>(ciphertext), <span class="number">16</span>)]</span><br><span class="line">    plaintext = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">    prev = iv</span><br><span class="line">    <span class="keyword">for</span> block <span class="keyword">in</span> blocks:</span><br><span class="line">        decrypted = aes_decrypt_block([<span class="built_in">hex</span>(b)[<span class="number">2</span>:].zfill(<span class="number">2</span>) <span class="keyword">for</span> b <span class="keyword">in</span> block], key_rotate)</span><br><span class="line">        decrypted = <span class="built_in">bytes</span>([d ^ p <span class="keyword">for</span> d, p <span class="keyword">in</span> <span class="built_in">zip</span>(decrypted, prev)])</span><br><span class="line">        plaintext += decrypted</span><br><span class="line">        prev = block</span><br><span class="line">    <span class="keyword">return</span> unpad(plaintext).decode()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    mode = <span class="built_in">input</span>(<span class="string">&quot;请输入模式 (encrypt/decrypt): &quot;</span>).strip().lower()</span><br><span class="line">    key = <span class="built_in">input</span>(<span class="string">&quot;请输入16字节密钥: &quot;</span>).strip()</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(key.encode(<span class="string">&#x27;utf-8&#x27;</span>)) != <span class="number">16</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;错误：密钥长度必须为16字节！&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">if</span> mode == <span class="string">&quot;encrypt&quot;</span>:</span><br><span class="line">            plaintext = <span class="built_in">input</span>(<span class="string">&quot;请输入明文: &quot;</span>).strip()</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;加密后密文:&quot;</span>, aes_cbc_encrypt(plaintext, key))</span><br><span class="line">        <span class="keyword">elif</span> mode == <span class="string">&quot;decrypt&quot;</span>:</span><br><span class="line">            ciphertext = <span class="built_in">input</span>(<span class="string">&quot;请输入密文 (16进制字符串): &quot;</span>).strip()</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;解密后明文:&quot;</span>, aes_cbc_decrypt(ciphertext, key))</span><br><span class="line">            <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">f&quot;解密失败: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;无效模式，请输入 encrypt 或 decrypt&quot;</span>)</span><br></pre></td></tr></table></div></figure>



<p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://www.yuque.com/attachments/yuque/0/2025/py/48372651/1742957296670-9dfd704d-923d-4cb7-8205-e620037ee8bf.py" >aes.py</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>  </p>
<p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://www.yuque.com/attachments/yuque/0/2025/py/48372651/1742957296552-29ba89ca-abb4-44ba-bf5e-aa3a8bd7f167.py" >aes1.py</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>  –有每轮结果的版本</p>
</div></div></article><article class="postlist-item post"><header class="post-header"><h1 class="post-title"><a class="post-title__link" href="/2025/03/25/crypto/%E6%A6%82%E5%BF%B5%E6%96%87%E6%A1%A3/%E5%88%86%E7%BB%84%E5%AF%86%E7%A0%81/DES%EF%BC%88Data%20Encryption_Standard%EF%BC%89/">DES（Data Encryption_Standard）</a></h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">发表于</span><span class="post-meta-item__value">2025-03-25</span></span></div></header><div class="post-body"><div class="post-excerpt"><p><font style="color:rgb(49, 59, 63);">DES是一种对称密钥的块加密算法。谓之 “对称密钥”，是因为加密、解密用的密钥是一样的（这不同于 RSA 等非对称密钥体系）。谓之 “块加密”，是因为这种算法把明文划分为很多个等长的块(block)，对每个块进行加密，最后以某种手段拼在一起。“块加密”亦称“分组加密”。</font></p>

        <h2 id="DES概述"   >
          <a href="#DES概述" class="heading-link"><i class="fas fa-link"></i></a><a href="#DES概述" class="headerlink" title="DES概述"></a>DES概述</h2>
      <p><font style="color:rgb(49, 59, 63);">DES 的功能是：给定一个 64 位的明文和一个 64 位的密钥，输出一个 64 位的密文。这个密文可以用相同的密钥解密。所谓“64位的密钥”，其实里面</font><u><font style="color:rgb(49, 59, 63);">只有56位在起作用</font></u><font style="color:rgb(49, 59, 63);">。剩余的位可以直接丢弃，或者当作奇偶校验位。</font></p>
<p><font style="color:rgb(49, 59, 63);">虽然 DES 一次只能加密 8 个字节，但我们只需要把明文划分成每 8 个字节一组的块，就可以实现任意长度明文的加密。如果明文长度不是 8 个字节的倍数，还得进行填充。现在流行的填充方式是 </font><u><font style="color:rgb(49, 59, 63);">PKCS7 &#x2F; PKCS5</font></u><font style="color:rgb(49, 59, 63);">。</font></p>
<p><font style="color:rgb(0, 0, 0);">算法特点：分组比较短、密钥太短、密码生命周期短、运算速度较慢。</font></p>
<blockquote>
<p><font style="color:rgb(0, 0, 0);">  Key（密钥）：为7个字节共56位，是DES算法的工作密钥（若说密钥为64位，其指的也是56位的秘钥加上8位奇偶校验位，奇偶校验位为第8,16,24,32,40,48,56,64位）<br></font><font style="color:rgb(0, 0, 0);">  Data（数据）：为8个字节64位，是要被加密或被解密的数据<br></font><font style="color:rgb(0, 0, 0);">  Mode（模式）： 为DES的工作方式,有两种:加密或解密。</font></p>
</blockquote>

        <h2 id="DES算法框架"   >
          <a href="#DES算法框架" class="heading-link"><i class="fas fa-link"></i></a><a href="#DES算法框架" class="headerlink" title="DES算法框架"></a><font style="color:rgb(49, 59, 63);">DES算法框架</font></h2>
      <p><font style="color:rgb(49, 59, 63);">DES 算法是在</font><strong><font style="color:rgb(49, 59, 63);"> Feistel network </font></strong><font style="color:rgb(49, 59, 63);">（费斯妥网络）的基础上执行的。以下是 DES 算法的流程图：</font></p>
<p><img src="https://cdn.nlark.com/yuque/0/2025/gif/48372651/1741845659640-59f13816-bfc9-4c5e-a98a-b445009a1545.gif"></p>
<p><font style="color:rgb(49, 59, 63);">可以看到整个算法分为两大部分——迭代加密（左边的 16 轮迭代操作），以及密钥调度（右边生成子密钥的算法）。</font></p>
<p><font style="color:rgb(49, 59, 63);">所谓密钥调度，就是从一把 64-bit 的主钥匙，得到 16 把 48-bit 的子钥匙。</font></p>
<p><font style="color:rgb(49, 59, 63);">每一轮迭代，都是接收一组 </font><code>&lt;font style=&quot;color:rgb(49, 59, 63);background-color:rgb(229, 239, 245);&quot;&gt;L, R&lt;/font&gt;</code><font style="color:rgb(49, 59, 63);">，返回 </font><code>&lt;font style=&quot;color:rgb(49, 59, 63);background-color:rgb(229, 239, 245);&quot;&gt;L&#39;, R&#39;&lt;/font&gt;</code><font style="color:rgb(49, 59, 63);"> ，作为下一轮迭代的 </font><code>&lt;font style=&quot;color:rgb(49, 59, 63);background-color:rgb(229, 239, 245);&quot;&gt;L, R&lt;/font&gt;</code><font style="color:rgb(49, 59, 63);"> . 迭代过程如下:</font></p>
<blockquote>
<p>L’&#x3D;R</p>
<p>R’&#x3D;L^F(R,subkey)</p>
</blockquote>
<p><font style="color:rgb(49, 59, 63);">其中F函数（称为轮函数）是整个算法的核心，功能是：以一个子密钥，加密 32-bit 的信息。</font></p>

        <h2 id="密钥调度算法"   >
          <a href="#密钥调度算法" class="heading-link"><i class="fas fa-link"></i></a><a href="#密钥调度算法" class="headerlink" title="密钥调度算法"></a><font style="color:rgb(49, 59, 63);">密钥调度算法</font></h2>
      <p><img src="https://cdn.nlark.com/yuque/0/2025/png/48372651/1741845854363-97842ab2-d3f2-4e7a-8957-3489d3eaff55.png"><br><font style="color:rgb(49, 59, 63);">	首先，采用“</font><strong><font style="color:rgb(9, 10, 11);">选择置换1 (PC-1)</font></strong><font style="color:rgb(49, 59, 63);">”，从 64 位 key 里面选出 56 位。这一步属于encode，对信息安全没有帮助。PC-1 方法如下：</font></p>
<figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 选择置换1，输入 key 为长度为 64 的 0/1 数组</span></span><br><span class="line"><span class="comment"># 从64位输入密钥中选择56位，分为左右两个28位半密钥</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">PC1</span>(<span class="params">key</span>):</span><br><span class="line">    pc1_l = [<span class="number">57</span>, <span class="number">49</span>, <span class="number">41</span>, <span class="number">33</span>, <span class="number">25</span>, <span class="number">17</span>, <span class="number">9</span>, </span><br><span class="line">             <span class="number">1</span>, <span class="number">58</span>, <span class="number">50</span>, <span class="number">42</span>, <span class="number">34</span>, <span class="number">26</span>, <span class="number">18</span>, </span><br><span class="line">             <span class="number">10</span>, <span class="number">2</span>, <span class="number">59</span>, <span class="number">51</span>, <span class="number">43</span>, <span class="number">35</span>, <span class="number">27</span>, </span><br><span class="line">             <span class="number">19</span>, <span class="number">11</span>, <span class="number">3</span>, <span class="number">60</span>, <span class="number">52</span>, <span class="number">44</span>, <span class="number">36</span>]</span><br><span class="line">    pc1_r = [<span class="number">63</span>, <span class="number">55</span>, <span class="number">47</span>, <span class="number">39</span>, <span class="number">31</span>, <span class="number">23</span>, <span class="number">15</span>, </span><br><span class="line">             <span class="number">7</span>, <span class="number">62</span>, <span class="number">54</span>, <span class="number">46</span>, <span class="number">38</span>, <span class="number">30</span>, <span class="number">22</span>, </span><br><span class="line">             <span class="number">14</span>, <span class="number">6</span>, <span class="number">61</span>, <span class="number">53</span>, <span class="number">45</span>, <span class="number">37</span>, <span class="number">29</span>, </span><br><span class="line">             <span class="number">21</span>, <span class="number">13</span>, <span class="number">5</span>, <span class="number">28</span>, <span class="number">20</span>, <span class="number">12</span>, <span class="number">4</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> [key[x-<span class="number">1</span>] <span class="keyword">for</span> x <span class="keyword">in</span> pc1_l], [key[x-<span class="number">1</span>] <span class="keyword">for</span> x <span class="keyword">in</span> pc1_r]</span><br></pre></td></tr></table></div></figure>

<p><font style="color:rgb(49, 59, 63);">经过 PC-1 之后，我们有了左、右两个半密钥，长度都是 28 位。接下来，我们每一轮把左、右半密钥左旋几位，再调用 PC-2 方法来造子密钥。框架如下：</font></p>
<figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 子密钥生成算法，由一个64位主密钥导出16个48位子密钥</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">keyGen</span>(<span class="params">key</span>):</span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">len</span>(key) == <span class="number">64</span></span><br><span class="line"></span><br><span class="line">    l, r = PC1(key)</span><br><span class="line">    off = [<span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">1</span>]</span><br><span class="line">    res = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>):</span><br><span class="line">        l = leftRotate(l, off[x])</span><br><span class="line">        r = leftRotate(r, off[x])</span><br><span class="line"></span><br><span class="line">        res.append(PC2(l + r))</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> res</span><br></pre></td></tr></table></div></figure>

<p><font style="color:rgb(49, 59, 63);">其中， </font><code>&lt;font style=&quot;color:rgb(49, 59, 63);background-color:rgb(229, 239, 245);&quot;&gt;leftRotate&lt;/font&gt;</code><font style="color:rgb(49, 59, 63);"> 是循环左移，实现如下：</font></p>
<figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 循环左移off位</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">leftRotate</span>(<span class="params">a, off</span>):</span><br><span class="line">    <span class="keyword">return</span> a[off:] + a[:off]</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> leftRotate([<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>], <span class="number">2</span>) == [<span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>]</span><br></pre></td></tr></table></div></figure>

<p><font style="color:rgb(49, 59, 63);">PC-2 又是一个简单置换，用于从左右半密钥拼起来的 56 位密钥中，选取 48 位作为一个子密钥。实现如下：</font></p>
<figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 选择置换2</span></span><br><span class="line"><span class="comment"># 从56位的密钥中选取48位子密钥</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">PC2</span>(<span class="params">key</span>):</span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">len</span>(key) == <span class="number">56</span></span><br><span class="line"></span><br><span class="line">    pc2 = [<span class="number">14</span>, <span class="number">17</span>, <span class="number">11</span>, <span class="number">24</span>, <span class="number">1</span>, <span class="number">5</span>, </span><br><span class="line">            <span class="number">3</span>, <span class="number">28</span>, <span class="number">15</span>, <span class="number">6</span>, <span class="number">21</span>, <span class="number">10</span>,</span><br><span class="line">            <span class="number">23</span>, <span class="number">19</span>, <span class="number">12</span>, <span class="number">4</span>, <span class="number">26</span>, <span class="number">8</span>,</span><br><span class="line">            <span class="number">16</span>, <span class="number">7</span>, <span class="number">27</span>, <span class="number">20</span>, <span class="number">13</span>, <span class="number">2</span>,</span><br><span class="line">            <span class="number">41</span>, <span class="number">52</span>, <span class="number">31</span>, <span class="number">37</span>, <span class="number">47</span>, <span class="number">55</span>,</span><br><span class="line">            <span class="number">30</span>, <span class="number">40</span>, <span class="number">51</span>, <span class="number">45</span>, <span class="number">33</span>, <span class="number">48</span>,</span><br><span class="line">            <span class="number">44</span>, <span class="number">49</span>, <span class="number">39</span>, <span class="number">56</span>, <span class="number">34</span>, <span class="number">53</span>,</span><br><span class="line">            <span class="number">46</span>, <span class="number">42</span>, <span class="number">50</span>, <span class="number">36</span>, <span class="number">29</span>, <span class="number">32</span>]</span><br><span class="line">    <span class="keyword">return</span> [key[x-<span class="number">1</span>] <span class="keyword">for</span> x <span class="keyword">in</span> pc2]</span><br></pre></td></tr></table></div></figure>

<p><font style="color:rgb(49, 59, 63);">这样，我们就实现了密钥调度算法。执行 </font><code>&lt;font style=&quot;color:rgb(49, 59, 63);background-color:rgb(229, 239, 245);&quot;&gt;keyGen&lt;/font&gt;</code><font style="color:rgb(49, 59, 63);"> ，即可获得 16 把子密钥，长度均为 48-bit. 不难看出，整个密钥调度的过程都是对主密钥的 encode. 生成这么多子密钥的目的，是使得加密迭代变得更加复杂、难以分析。</font></p>
<p><font style="color:rgb(49, 59, 63);"></font></p>

        <h2 id="加密迭代"   >
          <a href="#加密迭代" class="heading-link"><i class="fas fa-link"></i></a><a href="#加密迭代" class="headerlink" title="加密迭代"></a>加密迭代</h2>
      <p><font style="color:rgb(49, 59, 63);">加密迭代的过程是先把信息进行一次初始置换(IP置换)；再进行 16 轮迭代；最后再给 (R+L) 这个数组来一次最终置换(FP置换)，即可输出作为密文。框架如下：</font></p>
<figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">DES</span>(<span class="params">plain, key, method</span>):</span><br><span class="line">    subkeys = keyGen(int2bin(key, <span class="number">64</span>))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> method == <span class="string">&#x27;decrypt&#x27;</span>:</span><br><span class="line">        subkeys = subkeys[::-<span class="number">1</span>]</span><br><span class="line">    </span><br><span class="line">    m = IP(int2bin(plain, <span class="number">64</span>))</span><br><span class="line"></span><br><span class="line">    l, r = np.array(m, dtype=<span class="built_in">int</span>).reshape(<span class="number">2</span>, -<span class="number">1</span>).tolist()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>):</span><br><span class="line">        l, r = goRound(l, r, subkeys[i])</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> bin2int(FP(r + l))</span><br></pre></td></tr></table></div></figure>

<p><font style="color:rgb(49, 59, 63);">在这里， </font><code>&lt;font style=&quot;color:rgb(49, 59, 63);background-color:rgb(229, 239, 245);&quot;&gt;goRound&lt;/font&gt;</code><font style="color:rgb(49, 59, 63);"> 是提供 </font><code>&lt;font style=&quot;color:rgb(49, 59, 63);background-color:rgb(229, 239, 245);&quot;&gt;L, R&lt;/font&gt;</code><font style="color:rgb(49, 59, 63);"> 和本轮加密使用的子密钥，返回 </font><code>&lt;font style=&quot;color:rgb(49, 59, 63);background-color:rgb(229, 239, 245);&quot;&gt;L&#39;, R&#39;&lt;/font&gt;</code><font style="color:rgb(49, 59, 63);"> 以供下一轮迭代。 </font><code>&lt;font style=&quot;color:rgb(49, 59, 63);background-color:rgb(229, 239, 245);&quot;&gt;IP&lt;/font&gt;</code><font style="color:rgb(49, 59, 63);"> 和 </font><code>&lt;font style=&quot;color:rgb(49, 59, 63);background-color:rgb(229, 239, 245);&quot;&gt;FP&lt;/font&gt;</code><font style="color:rgb(49, 59, 63);"> 都是简单置换，对于密码安全没有任何意义，只是一个历史遗留原因。规定如下：</font></p>
<figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 初始置换</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">IP</span>(<span class="params">a</span>):</span><br><span class="line">    ip = [<span class="number">58</span>, <span class="number">50</span>, <span class="number">42</span>, <span class="number">34</span>, <span class="number">26</span>, <span class="number">18</span>, <span class="number">10</span>, <span class="number">2</span>,</span><br><span class="line">            <span class="number">60</span>, <span class="number">52</span>, <span class="number">44</span>, <span class="number">36</span>, <span class="number">28</span>, <span class="number">20</span>, <span class="number">12</span>, <span class="number">4</span>,</span><br><span class="line">            <span class="number">62</span>, <span class="number">54</span>, <span class="number">46</span>, <span class="number">38</span>, <span class="number">30</span>, <span class="number">22</span>, <span class="number">14</span>, <span class="number">6</span>,</span><br><span class="line">            <span class="number">64</span>, <span class="number">56</span>, <span class="number">48</span>, <span class="number">40</span>, <span class="number">32</span>, <span class="number">24</span>, <span class="number">16</span>, <span class="number">8</span>,</span><br><span class="line">            <span class="number">57</span>, <span class="number">49</span>, <span class="number">41</span>, <span class="number">33</span>, <span class="number">25</span>, <span class="number">17</span>, <span class="number">9</span>, <span class="number">1</span>,</span><br><span class="line">            <span class="number">59</span>, <span class="number">51</span>, <span class="number">43</span>, <span class="number">35</span>, <span class="number">27</span>, <span class="number">19</span>, <span class="number">11</span>, <span class="number">3</span>,</span><br><span class="line">            <span class="number">61</span>, <span class="number">53</span>, <span class="number">45</span>, <span class="number">37</span>, <span class="number">29</span>, <span class="number">21</span>, <span class="number">13</span>, <span class="number">5</span>,</span><br><span class="line">            <span class="number">63</span>, <span class="number">55</span>, <span class="number">47</span>, <span class="number">39</span>, <span class="number">31</span>, <span class="number">23</span>, <span class="number">15</span>, <span class="number">7</span>]</span><br><span class="line">    <span class="keyword">return</span> [a[x-<span class="number">1</span>] <span class="keyword">for</span> x <span class="keyword">in</span> ip]</span><br><span class="line">testM = [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>]</span><br><span class="line"><span class="keyword">assert</span> IP(testM) == [<span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 最终置换</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">FP</span>(<span class="params">a</span>):</span><br><span class="line">    fp = [<span class="number">40</span>, <span class="number">8</span>, <span class="number">48</span>, <span class="number">16</span>, <span class="number">56</span>, <span class="number">24</span>, <span class="number">64</span>, <span class="number">32</span>,</span><br><span class="line">            <span class="number">39</span>, <span class="number">7</span>, <span class="number">47</span>, <span class="number">15</span>, <span class="number">55</span>, <span class="number">23</span>, <span class="number">63</span>, <span class="number">31</span>,</span><br><span class="line">            <span class="number">38</span>, <span class="number">6</span>, <span class="number">46</span>, <span class="number">14</span>, <span class="number">54</span>, <span class="number">22</span>, <span class="number">62</span>, <span class="number">30</span>,</span><br><span class="line">            <span class="number">37</span>, <span class="number">5</span>, <span class="number">45</span>, <span class="number">13</span>, <span class="number">53</span>, <span class="number">21</span>, <span class="number">61</span>, <span class="number">29</span>,</span><br><span class="line">            <span class="number">36</span>, <span class="number">4</span>, <span class="number">44</span>, <span class="number">12</span>, <span class="number">52</span>, <span class="number">20</span>, <span class="number">60</span>, <span class="number">28</span>,</span><br><span class="line">            <span class="number">35</span>, <span class="number">3</span>, <span class="number">43</span>, <span class="number">11</span>, <span class="number">51</span>, <span class="number">19</span>, <span class="number">59</span>, <span class="number">27</span>,</span><br><span class="line">            <span class="number">34</span>, <span class="number">2</span>, <span class="number">42</span>, <span class="number">10</span>, <span class="number">50</span>, <span class="number">18</span>, <span class="number">58</span>, <span class="number">26</span>,</span><br><span class="line">            <span class="number">33</span>, <span class="number">1</span>, <span class="number">41</span>, <span class="number">9</span>, <span class="number">49</span>, <span class="number">17</span>, <span class="number">57</span>, <span class="number">25</span>]</span><br><span class="line">    <span class="keyword">return</span> [a[x-<span class="number">1</span>] <span class="keyword">for</span> x <span class="keyword">in</span> fp]</span><br></pre></td></tr></table></div></figure>

<p><font style="color:rgb(49, 59, 63);">注意到 FP 就是 IP 的逆函数。这是为了保证“加密、解密算法几乎完全相同”。而至于 </font><code>&lt;font style=&quot;color:rgb(49, 59, 63);background-color:rgb(229, 239, 245);&quot;&gt;goRound&lt;/font&gt;</code><font style="color:rgb(49, 59, 63);"> ，我们知道它干的事情是</font></p>
<blockquote>
<p><font style="color:rgb(49, 59, 63);">L’&#x3D;R</font></p>
<p><font style="color:rgb(49, 59, 63);">R’&#x3D;L^F(R,subkey)</font></p>
</blockquote>
<p><font style="color:rgb(49, 59, 63);">代码实现如下：</font></p>
<figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">goRound</span>(<span class="params">l, r, subKey</span>):</span><br><span class="line">    <span class="keyword">return</span> r, binXor(l, Feistel(r, subKey))</span><br></pre></td></tr></table></div></figure>

<p><font style="color:rgb(49, 59, 63);">因此，DES 的安全性在很大程度上取决于 F 函数，也就是轮函数。那么 Feistel 函数是干了什么事呢？来看下面一张流程图：</font></p>
<p><img src="https://cdn.nlark.com/yuque/0/2025/png/48372651/1741846528750-ba76239d-25d5-42ec-933a-8683ac3881c9.png"></p>
<p><font style="color:rgb(49, 59, 63);">一个 32-bit 的块，经过一个扩张(Expand函数)，变成 48 位，然后</font><strong><font style="color:rgb(9, 10, 11);">与子密钥异或</font></strong><font style="color:rgb(49, 59, 63);">。得到的 48-bit 的结果分为 8 组，每一组是 6-bit 的数据，丢进对应的 </font><strong><font style="color:rgb(9, 10, 11);">S 盒</font></strong><font style="color:rgb(49, 59, 63);">，输出 4-bit 的信息。把这些输出收集起来，一共是 4*8 &#x3D; 32 位，做一次置换 (P 置换)，得到 32-bit 的结果。这与输进来的 32-bit 信息是等长度的。</font></p>
<figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># F函数，用于处理一个半块</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">Feistel</span>(<span class="params">a, subKey</span>):</span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">len</span>(a) == <span class="number">32</span></span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">len</span>(subKey) == <span class="number">48</span></span><br><span class="line"></span><br><span class="line">    t = binXor(Expand(a), subKey)</span><br><span class="line">    t = S(t)</span><br><span class="line">    t = P(t)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> t</span><br></pre></td></tr></table></div></figure>

<p><font style="color:rgb(49, 59, 63);">Expand 算法是指定的，P 置换是一个简单置换，因此都是 encode 过程。而这个 32-bit 的半块与 subkey 的混合过程，以及 S 盒提供的强有力的混淆能力，提供了 DES 体系的核心安全性。</font></p>
<p><font style="color:rgb(49, 59, 63);">Expand 算法如下：</font></p>
<figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 扩张置换，将32位的数据扩展到48位</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">Expand</span>(<span class="params">a</span>):</span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">len</span>(a) == <span class="number">32</span></span><br><span class="line">    e = [<span class="number">32</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>,</span><br><span class="line">        <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>,</span><br><span class="line">        <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">13</span>,</span><br><span class="line">        <span class="number">12</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">16</span>, <span class="number">17</span>,</span><br><span class="line">        <span class="number">16</span>, <span class="number">17</span>, <span class="number">18</span>, <span class="number">19</span>, <span class="number">20</span>, <span class="number">21</span>,</span><br><span class="line">        <span class="number">20</span>, <span class="number">21</span>, <span class="number">22</span>, <span class="number">23</span>, <span class="number">24</span>, <span class="number">25</span>,</span><br><span class="line">        <span class="number">24</span>, <span class="number">25</span>, <span class="number">26</span>, <span class="number">27</span>, <span class="number">28</span>, <span class="number">29</span>,</span><br><span class="line">        <span class="number">28</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">31</span>, <span class="number">32</span>, <span class="number">1</span>]</span><br><span class="line">    <span class="keyword">return</span> [a[x-<span class="number">1</span>] <span class="keyword">for</span> x <span class="keyword">in</span> e]</span><br></pre></td></tr></table></div></figure>

<p><font style="color:rgb(49, 59, 63);">P 置换如下：</font></p>
<figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># P置换</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">P</span>(<span class="params">a</span>):</span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">len</span>(a) == <span class="number">32</span></span><br><span class="line"></span><br><span class="line">    p = [<span class="number">16</span>, <span class="number">7</span>, <span class="number">20</span>, <span class="number">21</span>,</span><br><span class="line">        <span class="number">29</span>, <span class="number">12</span>, <span class="number">28</span>, <span class="number">17</span>,</span><br><span class="line">        <span class="number">1</span>, <span class="number">15</span>, <span class="number">23</span>, <span class="number">26</span>,</span><br><span class="line">        <span class="number">5</span>, <span class="number">18</span>, <span class="number">31</span>, <span class="number">10</span>,</span><br><span class="line">        <span class="number">2</span>, <span class="number">8</span>, <span class="number">24</span>, <span class="number">14</span>,</span><br><span class="line">        <span class="number">32</span>, <span class="number">27</span>, <span class="number">3</span>, <span class="number">9</span>,</span><br><span class="line">        <span class="number">19</span>, <span class="number">13</span>, <span class="number">30</span>, <span class="number">6</span>,</span><br><span class="line">        <span class="number">22</span>, <span class="number">11</span>, <span class="number">4</span>, <span class="number">25</span>]</span><br><span class="line">    <span class="keyword">return</span> [a[x-<span class="number">1</span>] <span class="keyword">for</span> x <span class="keyword">in</span> p]</span><br></pre></td></tr></table></div></figure>

<p><font style="color:rgb(49, 59, 63);">需要注意一点：这个 P 置换是精心设计的，使得这一轮同一个 S 盒 输出的四个 bit，在下一回合的扩张之后，交由四个不同的 S 盒去处理。</font></p>
<p><font style="color:rgb(49, 59, 63);">接下来唯一要处理的就是 S 盒了。它一共有 8 张表，表长成下面这个样子：</font></p>
<p><img src="https://cdn.nlark.com/yuque/0/2025/png/48372651/1741846720794-4784e570-f3aa-4d85-9956-4f0dd5191d32.png"><img src="https://cdn.nlark.com/yuque/0/2025/png/48372651/1741846730130-f0ca0ab6-5075-4f92-bca5-b1449d59ad7e.png"><img src="https://cdn.nlark.com/yuque/0/2025/png/48372651/1741846739380-d007256a-7b24-4bae-bca3-1d7023fb6870.png"></p>
<p><img src="https://cdn.nlark.com/yuque/0/2025/png/48372651/1741846752263-2462b5b1-8a8e-445d-b826-2c95df04728b.png"></p>
<p><font style="color:rgb(49, 59, 63);">扩张之后的半块与子密钥异或之后，得到了 48 位结果；这些结果分成 8 个组，然后第一组使用 S1 这张表进行变换，第二组使用 S2 进行变换……依次类推。现在我们假设第二组是 </font><code>&lt;font style=&quot;color:rgb(49, 59, 63);background-color:rgb(229, 239, 245);&quot;&gt;101100&lt;/font&gt;</code><font style="color:rgb(49, 59, 63);"> ，来看它在 S盒变换之后会得到什么结果：</font></p>
<details class="lake-collapse"><summary id="u8ac641e0"></summary><p id="ub6c18c91" class="ne-p"><span class="ne-text" style="color: rgb(49, 59, 63); font-size: 16px">由于这是第二组，故查询 S2 表。</span><span class="ne-text"><br /></span><span class="ne-text" style="color: rgb(49, 59, 63); font-size: 16px">它的首位、末尾是 </span><code class="ne-code"><span class="ne-text" style="color: rgb(49, 59, 63); background-color: rgb(229, 239, 245)">10</span></code><span class="ne-text" style="color: rgb(49, 59, 63); font-size: 16px"> ，故查询第三行。</span><span class="ne-text"><br /></span><span class="ne-text" style="color: rgb(49, 59, 63); font-size: 16px">它的中间 4 位是 </span><code class="ne-code"><span class="ne-text" style="color: rgb(49, 59, 63); background-color: rgb(229, 239, 245)">0110</span></code><span class="ne-text" style="color: rgb(49, 59, 63); font-size: 16px"> ，查表知结果是 13.</span><span class="ne-text"><br /></span><span class="ne-text" style="color: rgb(49, 59, 63); font-size: 16px">把 13 转为二进制，得到 </span><code class="ne-code"><span class="ne-text" style="color: rgb(49, 59, 63); background-color: rgb(229, 239, 245)">1101</span></code><span class="ne-text" style="color: rgb(49, 59, 63); font-size: 16px"> ，于是这就是输出。</span></p></details>
<font style="color:rgb(49, 59, 63);">代码实现：</font>

<figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># S盒变换，输入48位，输出32位</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">S</span>(<span class="params">a</span>):</span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">len</span>(a) == <span class="number">48</span></span><br><span class="line"></span><br><span class="line">    S_box = [[<span class="number">14</span>,<span class="number">4</span>,<span class="number">13</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">15</span>,<span class="number">11</span>,<span class="number">8</span>,<span class="number">3</span>,<span class="number">10</span>,<span class="number">6</span>,<span class="number">12</span>,<span class="number">5</span>,<span class="number">9</span>,<span class="number">0</span>,<span class="number">7</span>,</span><br><span class="line">                <span class="number">0</span>,<span class="number">15</span>,<span class="number">7</span>,<span class="number">4</span>,<span class="number">14</span>,<span class="number">2</span>,<span class="number">13</span>,<span class="number">1</span>,<span class="number">10</span>,<span class="number">6</span>,<span class="number">12</span>,<span class="number">11</span>,<span class="number">9</span>,<span class="number">5</span>,<span class="number">3</span>,<span class="number">8</span>,</span><br><span class="line">                <span class="number">4</span>,<span class="number">1</span>,<span class="number">14</span>,<span class="number">8</span>,<span class="number">13</span>,<span class="number">6</span>,<span class="number">2</span>,<span class="number">11</span>,<span class="number">15</span>,<span class="number">12</span>,<span class="number">9</span>,<span class="number">7</span>,<span class="number">3</span>,<span class="number">10</span>,<span class="number">5</span>,<span class="number">0</span>,</span><br><span class="line">                <span class="number">15</span>,<span class="number">12</span>,<span class="number">8</span>,<span class="number">2</span>,<span class="number">4</span>,<span class="number">9</span>,<span class="number">1</span>,<span class="number">7</span>,<span class="number">5</span>,<span class="number">11</span>,<span class="number">3</span>,<span class="number">14</span>,<span class="number">10</span>,<span class="number">0</span>,<span class="number">6</span>,<span class="number">13</span>], </span><br><span class="line">                [<span class="number">15</span>,<span class="number">1</span>,<span class="number">8</span>,<span class="number">14</span>,<span class="number">6</span>,<span class="number">11</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">9</span>,<span class="number">7</span>,<span class="number">2</span>,<span class="number">13</span>,<span class="number">12</span>,<span class="number">0</span>,<span class="number">5</span>,<span class="number">10</span>,</span><br><span class="line">                <span class="number">3</span>,<span class="number">13</span>,<span class="number">4</span>,<span class="number">7</span>,<span class="number">15</span>,<span class="number">2</span>,<span class="number">8</span>,<span class="number">14</span>,<span class="number">12</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">10</span>,<span class="number">6</span>,<span class="number">9</span>,<span class="number">11</span>,<span class="number">5</span>,</span><br><span class="line">                <span class="number">0</span>,<span class="number">14</span>,<span class="number">7</span>,<span class="number">11</span>,<span class="number">10</span>,<span class="number">4</span>,<span class="number">13</span>,<span class="number">1</span>,<span class="number">5</span>,<span class="number">8</span>,<span class="number">12</span>,<span class="number">6</span>,<span class="number">9</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">15</span>,</span><br><span class="line">                <span class="number">13</span>,<span class="number">8</span>,<span class="number">10</span>,<span class="number">1</span>,<span class="number">3</span>,<span class="number">15</span>,<span class="number">4</span>,<span class="number">2</span>,<span class="number">11</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">12</span>,<span class="number">0</span>,<span class="number">5</span>,<span class="number">14</span>,<span class="number">9</span>], </span><br><span class="line">                [<span class="number">10</span>,<span class="number">0</span>,<span class="number">9</span>,<span class="number">14</span>,<span class="number">6</span>,<span class="number">3</span>,<span class="number">15</span>,<span class="number">5</span>,<span class="number">1</span>,<span class="number">13</span>,<span class="number">12</span>,<span class="number">7</span>,<span class="number">11</span>,<span class="number">4</span>,<span class="number">2</span>,<span class="number">8</span>,</span><br><span class="line">                <span class="number">13</span>,<span class="number">7</span>,<span class="number">0</span>,<span class="number">9</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">6</span>,<span class="number">10</span>,<span class="number">2</span>,<span class="number">8</span>,<span class="number">5</span>,<span class="number">14</span>,<span class="number">12</span>,<span class="number">11</span>,<span class="number">15</span>,<span class="number">1</span>,</span><br><span class="line">                <span class="number">13</span>,<span class="number">6</span>,<span class="number">4</span>,<span class="number">9</span>,<span class="number">8</span>,<span class="number">15</span>,<span class="number">3</span>,<span class="number">0</span>,<span class="number">11</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">12</span>,<span class="number">5</span>,<span class="number">10</span>,<span class="number">14</span>,<span class="number">7</span>,</span><br><span class="line">                <span class="number">1</span>,<span class="number">10</span>,<span class="number">13</span>,<span class="number">0</span>,<span class="number">6</span>,<span class="number">9</span>,<span class="number">8</span>,<span class="number">7</span>,<span class="number">4</span>,<span class="number">15</span>,<span class="number">14</span>,<span class="number">3</span>,<span class="number">11</span>,<span class="number">5</span>,<span class="number">2</span>,<span class="number">12</span>],</span><br><span class="line">                [<span class="number">7</span>,<span class="number">13</span>,<span class="number">14</span>,<span class="number">3</span>,<span class="number">0</span>,<span class="number">6</span>,<span class="number">9</span>,<span class="number">10</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">8</span>,<span class="number">5</span>,<span class="number">11</span>,<span class="number">12</span>,<span class="number">4</span>,<span class="number">15</span>,</span><br><span class="line">                <span class="number">13</span>,<span class="number">8</span>,<span class="number">11</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">15</span>,<span class="number">0</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">7</span>,<span class="number">2</span>,<span class="number">12</span>,<span class="number">1</span>,<span class="number">10</span>,<span class="number">14</span>,<span class="number">9</span>,</span><br><span class="line">                <span class="number">10</span>,<span class="number">6</span>,<span class="number">9</span>,<span class="number">0</span>,<span class="number">12</span>,<span class="number">11</span>,<span class="number">7</span>,<span class="number">13</span>,<span class="number">15</span>,<span class="number">1</span>,<span class="number">3</span>,<span class="number">14</span>,<span class="number">5</span>,<span class="number">2</span>,<span class="number">8</span>,<span class="number">4</span>,</span><br><span class="line">                <span class="number">3</span>,<span class="number">15</span>,<span class="number">0</span>,<span class="number">6</span>,<span class="number">10</span>,<span class="number">1</span>,<span class="number">13</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">11</span>,<span class="number">12</span>,<span class="number">7</span>,<span class="number">2</span>,<span class="number">14</span>],</span><br><span class="line">                [<span class="number">2</span>,<span class="number">12</span>,<span class="number">4</span>,<span class="number">1</span>,<span class="number">7</span>,<span class="number">10</span>,<span class="number">11</span>,<span class="number">6</span>,<span class="number">8</span>,<span class="number">5</span>,<span class="number">3</span>,<span class="number">15</span>,<span class="number">13</span>,<span class="number">0</span>,<span class="number">14</span>,<span class="number">9</span>,</span><br><span class="line">                <span class="number">14</span>,<span class="number">11</span>,<span class="number">2</span>,<span class="number">12</span>,<span class="number">4</span>,<span class="number">7</span>,<span class="number">13</span>,<span class="number">1</span>,<span class="number">5</span>,<span class="number">0</span>,<span class="number">15</span>,<span class="number">10</span>,<span class="number">3</span>,<span class="number">9</span>,<span class="number">8</span>,<span class="number">6</span>,</span><br><span class="line">                <span class="number">4</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">11</span>,<span class="number">10</span>,<span class="number">13</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">15</span>,<span class="number">9</span>,<span class="number">12</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">3</span>,<span class="number">0</span>,<span class="number">14</span>,</span><br><span class="line">                <span class="number">11</span>,<span class="number">8</span>,<span class="number">12</span>,<span class="number">7</span>,<span class="number">1</span>,<span class="number">14</span>,<span class="number">2</span>,<span class="number">13</span>,<span class="number">6</span>,<span class="number">15</span>,<span class="number">0</span>,<span class="number">9</span>,<span class="number">10</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">3</span>],</span><br><span class="line">                [<span class="number">12</span>,<span class="number">1</span>,<span class="number">10</span>,<span class="number">15</span>,<span class="number">9</span>,<span class="number">2</span>,<span class="number">6</span>,<span class="number">8</span>,<span class="number">0</span>,<span class="number">13</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">14</span>,<span class="number">7</span>,<span class="number">5</span>,<span class="number">11</span>,</span><br><span class="line">                <span class="number">10</span>,<span class="number">15</span>,<span class="number">4</span>,<span class="number">2</span>,<span class="number">7</span>,<span class="number">12</span>,<span class="number">9</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">1</span>,<span class="number">13</span>,<span class="number">14</span>,<span class="number">0</span>,<span class="number">11</span>,<span class="number">3</span>,<span class="number">8</span>,</span><br><span class="line">                <span class="number">9</span>,<span class="number">14</span>,<span class="number">15</span>,<span class="number">5</span>,<span class="number">2</span>,<span class="number">8</span>,<span class="number">12</span>,<span class="number">3</span>,<span class="number">7</span>,<span class="number">0</span>,<span class="number">4</span>,<span class="number">10</span>,<span class="number">1</span>,<span class="number">13</span>,<span class="number">11</span>,<span class="number">6</span>,</span><br><span class="line">                <span class="number">4</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">12</span>,<span class="number">9</span>,<span class="number">5</span>,<span class="number">15</span>,<span class="number">10</span>,<span class="number">11</span>,<span class="number">14</span>,<span class="number">1</span>,<span class="number">7</span>,<span class="number">6</span>,<span class="number">0</span>,<span class="number">8</span>,<span class="number">13</span>],</span><br><span class="line">                [<span class="number">4</span>,<span class="number">11</span>,<span class="number">2</span>,<span class="number">14</span>,<span class="number">15</span>,<span class="number">0</span>,<span class="number">8</span>,<span class="number">13</span>,<span class="number">3</span>,<span class="number">12</span>,<span class="number">9</span>,<span class="number">7</span>,<span class="number">5</span>,<span class="number">10</span>,<span class="number">6</span>,<span class="number">1</span>,</span><br><span class="line">                <span class="number">13</span>,<span class="number">0</span>,<span class="number">11</span>,<span class="number">7</span>,<span class="number">4</span>,<span class="number">9</span>,<span class="number">1</span>,<span class="number">10</span>,<span class="number">14</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">12</span>,<span class="number">2</span>,<span class="number">15</span>,<span class="number">8</span>,<span class="number">6</span>,</span><br><span class="line">                <span class="number">1</span>,<span class="number">4</span>,<span class="number">11</span>,<span class="number">13</span>,<span class="number">12</span>,<span class="number">3</span>,<span class="number">7</span>,<span class="number">14</span>,<span class="number">10</span>,<span class="number">15</span>,<span class="number">6</span>,<span class="number">8</span>,<span class="number">0</span>,<span class="number">5</span>,<span class="number">9</span>,<span class="number">2</span>,</span><br><span class="line">                <span class="number">6</span>,<span class="number">11</span>,<span class="number">13</span>,<span class="number">8</span>,<span class="number">1</span>,<span class="number">4</span>,<span class="number">10</span>,<span class="number">7</span>,<span class="number">9</span>,<span class="number">5</span>,<span class="number">0</span>,<span class="number">15</span>,<span class="number">14</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">12</span>],</span><br><span class="line">                [<span class="number">13</span>,<span class="number">2</span>,<span class="number">8</span>,<span class="number">4</span>,<span class="number">6</span>,<span class="number">15</span>,<span class="number">11</span>,<span class="number">1</span>,<span class="number">10</span>,<span class="number">9</span>,<span class="number">3</span>,<span class="number">14</span>,<span class="number">5</span>,<span class="number">0</span>,<span class="number">12</span>,<span class="number">7</span>,</span><br><span class="line">                <span class="number">1</span>,<span class="number">15</span>,<span class="number">13</span>,<span class="number">8</span>,<span class="number">10</span>,<span class="number">3</span>,<span class="number">7</span>,<span class="number">4</span>,<span class="number">12</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">11</span>,<span class="number">0</span>,<span class="number">14</span>,<span class="number">9</span>,<span class="number">2</span>,</span><br><span class="line">                <span class="number">7</span>,<span class="number">11</span>,<span class="number">4</span>,<span class="number">1</span>,<span class="number">9</span>,<span class="number">12</span>,<span class="number">14</span>,<span class="number">2</span>,<span class="number">0</span>,<span class="number">6</span>,<span class="number">10</span>,<span class="number">13</span>,<span class="number">15</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">8</span>,</span><br><span class="line">                <span class="number">2</span>,<span class="number">1</span>,<span class="number">14</span>,<span class="number">7</span>,<span class="number">4</span>,<span class="number">10</span>,<span class="number">8</span>,<span class="number">13</span>,<span class="number">15</span>,<span class="number">12</span>,<span class="number">9</span>,<span class="number">0</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">11</span>]]</span><br><span class="line"></span><br><span class="line">    a = np.array(a, dtype=<span class="built_in">int</span>).reshape(<span class="number">8</span>, <span class="number">6</span>)</span><br><span class="line">    res = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">        <span class="comment"># 用 S_box[i] 处理6位a[i]，得到4位输出</span></span><br><span class="line">        p = a[i]</span><br><span class="line">        r = S_box[i][bin2int([p[<span class="number">0</span>], p[<span class="number">5</span>], p[<span class="number">1</span>], p[<span class="number">2</span>], p[<span class="number">3</span>], p[<span class="number">4</span>]])]</span><br><span class="line">        res.append(int2bin(r, <span class="number">4</span>))</span><br><span class="line">        </span><br><span class="line">    res = np.array(res).flatten().tolist()</span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">len</span>(res) == <span class="number">32</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> res</span><br></pre></td></tr></table></div></figure>


        <h2 id="完整代码"   >
          <a href="#完整代码" class="heading-link"><i class="fas fa-link"></i></a><a href="#完整代码" class="headerlink" title="完整代码"></a>完整代码</h2>
      <figure class="highlight python"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> reduce</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">pad_data</span>(<span class="params">data</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot; 对输入数据进行 64-bit 块填充（PKCS7 填充） &quot;&quot;&quot;</span></span><br><span class="line">    byte_data = data.encode(<span class="string">&#x27;utf-8&#x27;</span>)  <span class="comment"># 转换为字节</span></span><br><span class="line">    pad_len = <span class="number">8</span> - (<span class="built_in">len</span>(byte_data) % <span class="number">8</span>)  <span class="comment"># 计算填充长度</span></span><br><span class="line">    byte_data += <span class="built_in">bytes</span>([pad_len] * pad_len)  <span class="comment"># 添加填充字节</span></span><br><span class="line">    <span class="keyword">return</span> [<span class="built_in">int</span>.from_bytes(byte_data[i:i+<span class="number">8</span>], <span class="string">&#x27;big&#x27;</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(byte_data), <span class="number">8</span>)]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">unpad_data</span>(<span class="params">data_blocks</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot; 去除填充并转换回字符串 &quot;&quot;&quot;</span></span><br><span class="line">    byte_data = <span class="string">b&#x27;&#x27;</span>.join(block.to_bytes(<span class="number">8</span>, <span class="string">&#x27;big&#x27;</span>) <span class="keyword">for</span> block <span class="keyword">in</span> data_blocks)</span><br><span class="line">    pad_len = byte_data[-<span class="number">1</span>]  <span class="comment"># 获取填充的字节数</span></span><br><span class="line">    <span class="keyword">return</span> byte_data[:-pad_len].decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 整数转二进制数组，指定位长 n，大端序</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">int2bin</span>(<span class="params">a, n</span>):</span><br><span class="line">    <span class="keyword">assert</span> <span class="number">0</span>&lt;=n <span class="keyword">and</span> a &lt; <span class="number">2</span>**n <span class="comment"># 断言，确保 n 为非负数，且 a 在 n 位二进制能表示的范围内</span></span><br><span class="line">    res = np.zeros(n, dtype = <span class="built_in">int</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">        res[n-x-<span class="number">1</span>] = a % <span class="number">2</span></span><br><span class="line">        a = a // <span class="number">2</span></span><br><span class="line">    <span class="keyword">return</span> res.tolist()</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> int2bin(<span class="number">0x1a</span>, <span class="number">10</span>) == [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>] <span class="comment">#验证</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 二进制数组转整数，大端序  左移方式 (x * 2 + y) 处理二进制位。</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bin2int</span>(<span class="params">a</span>):</span><br><span class="line">    <span class="keyword">return</span> reduce(<span class="keyword">lambda</span> x,y: x*<span class="number">2</span>+y, a)</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> bin2int([<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>]) == <span class="number">0x1a</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 循环左移off位</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">leftRotate</span>(<span class="params">a, off</span>):</span><br><span class="line">    <span class="keyword">return</span> a[off:] + a[:off]</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> leftRotate([<span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>], <span class="number">2</span>) == [<span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 异或</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">binXor</span>(<span class="params">a, b</span>):</span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">len</span>(a) == <span class="built_in">len</span>(b)</span><br><span class="line">    <span class="keyword">return</span> [x^y <span class="keyword">for</span> x, y <span class="keyword">in</span> <span class="built_in">zip</span>(a, b)]</span><br><span class="line">    </span><br><span class="line"><span class="keyword">assert</span> binXor([<span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>], [<span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>]) == [<span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 初始置换</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">IP</span>(<span class="params">a</span>):</span><br><span class="line">    ip = [<span class="number">58</span>, <span class="number">50</span>, <span class="number">42</span>, <span class="number">34</span>, <span class="number">26</span>, <span class="number">18</span>, <span class="number">10</span>, <span class="number">2</span>,</span><br><span class="line">            <span class="number">60</span>, <span class="number">52</span>, <span class="number">44</span>, <span class="number">36</span>, <span class="number">28</span>, <span class="number">20</span>, <span class="number">12</span>, <span class="number">4</span>,</span><br><span class="line">            <span class="number">62</span>, <span class="number">54</span>, <span class="number">46</span>, <span class="number">38</span>, <span class="number">30</span>, <span class="number">22</span>, <span class="number">14</span>, <span class="number">6</span>,</span><br><span class="line">            <span class="number">64</span>, <span class="number">56</span>, <span class="number">48</span>, <span class="number">40</span>, <span class="number">32</span>, <span class="number">24</span>, <span class="number">16</span>, <span class="number">8</span>,</span><br><span class="line">            <span class="number">57</span>, <span class="number">49</span>, <span class="number">41</span>, <span class="number">33</span>, <span class="number">25</span>, <span class="number">17</span>, <span class="number">9</span>, <span class="number">1</span>,</span><br><span class="line">            <span class="number">59</span>, <span class="number">51</span>, <span class="number">43</span>, <span class="number">35</span>, <span class="number">27</span>, <span class="number">19</span>, <span class="number">11</span>, <span class="number">3</span>,</span><br><span class="line">            <span class="number">61</span>, <span class="number">53</span>, <span class="number">45</span>, <span class="number">37</span>, <span class="number">29</span>, <span class="number">21</span>, <span class="number">13</span>, <span class="number">5</span>,</span><br><span class="line">            <span class="number">63</span>, <span class="number">55</span>, <span class="number">47</span>, <span class="number">39</span>, <span class="number">31</span>, <span class="number">23</span>, <span class="number">15</span>, <span class="number">7</span>]</span><br><span class="line">    <span class="keyword">return</span> [a[x-<span class="number">1</span>] <span class="keyword">for</span> x <span class="keyword">in</span> ip]</span><br><span class="line">    </span><br><span class="line">testM = [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>]</span><br><span class="line"><span class="keyword">assert</span> IP(testM) == [<span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 最终置换</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">FP</span>(<span class="params">a</span>):</span><br><span class="line">    fp = [<span class="number">40</span>, <span class="number">8</span>, <span class="number">48</span>, <span class="number">16</span>, <span class="number">56</span>, <span class="number">24</span>, <span class="number">64</span>, <span class="number">32</span>,</span><br><span class="line">            <span class="number">39</span>, <span class="number">7</span>, <span class="number">47</span>, <span class="number">15</span>, <span class="number">55</span>, <span class="number">23</span>, <span class="number">63</span>, <span class="number">31</span>,</span><br><span class="line">            <span class="number">38</span>, <span class="number">6</span>, <span class="number">46</span>, <span class="number">14</span>, <span class="number">54</span>, <span class="number">22</span>, <span class="number">62</span>, <span class="number">30</span>,</span><br><span class="line">            <span class="number">37</span>, <span class="number">5</span>, <span class="number">45</span>, <span class="number">13</span>, <span class="number">53</span>, <span class="number">21</span>, <span class="number">61</span>, <span class="number">29</span>,</span><br><span class="line">            <span class="number">36</span>, <span class="number">4</span>, <span class="number">44</span>, <span class="number">12</span>, <span class="number">52</span>, <span class="number">20</span>, <span class="number">60</span>, <span class="number">28</span>,</span><br><span class="line">            <span class="number">35</span>, <span class="number">3</span>, <span class="number">43</span>, <span class="number">11</span>, <span class="number">51</span>, <span class="number">19</span>, <span class="number">59</span>, <span class="number">27</span>,</span><br><span class="line">            <span class="number">34</span>, <span class="number">2</span>, <span class="number">42</span>, <span class="number">10</span>, <span class="number">50</span>, <span class="number">18</span>, <span class="number">58</span>, <span class="number">26</span>,</span><br><span class="line">            <span class="number">33</span>, <span class="number">1</span>, <span class="number">41</span>, <span class="number">9</span>, <span class="number">49</span>, <span class="number">17</span>, <span class="number">57</span>, <span class="number">25</span>]</span><br><span class="line">    <span class="keyword">return</span> [a[x-<span class="number">1</span>] <span class="keyword">for</span> x <span class="keyword">in</span> fp]</span><br><span class="line">    </span><br><span class="line"><span class="comment"># 选择置换1</span></span><br><span class="line"><span class="comment"># 从64位输入密钥中选择56位，分为左右两个28位半密钥</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">PC1</span>(<span class="params">key</span>):</span><br><span class="line">    pc1_l = [<span class="number">57</span>, <span class="number">49</span>, <span class="number">41</span>, <span class="number">33</span>, <span class="number">25</span>, <span class="number">17</span>, <span class="number">9</span>, </span><br><span class="line">            <span class="number">1</span>, <span class="number">58</span>, <span class="number">50</span>, <span class="number">42</span>, <span class="number">34</span>, <span class="number">26</span>, <span class="number">18</span>, </span><br><span class="line">            <span class="number">10</span>, <span class="number">2</span>, <span class="number">59</span>, <span class="number">51</span>, <span class="number">43</span>, <span class="number">35</span>, <span class="number">27</span>, </span><br><span class="line">            <span class="number">19</span>, <span class="number">11</span>, <span class="number">3</span>, <span class="number">60</span>, <span class="number">52</span>, <span class="number">44</span>, <span class="number">36</span>]</span><br><span class="line">    pc1_r = [<span class="number">63</span>, <span class="number">55</span>, <span class="number">47</span>, <span class="number">39</span>, <span class="number">31</span>, <span class="number">23</span>, <span class="number">15</span>, </span><br><span class="line">            <span class="number">7</span>, <span class="number">62</span>, <span class="number">54</span>, <span class="number">46</span>, <span class="number">38</span>, <span class="number">30</span>, <span class="number">22</span>, </span><br><span class="line">            <span class="number">14</span>, <span class="number">6</span>, <span class="number">61</span>, <span class="number">53</span>, <span class="number">45</span>, <span class="number">37</span>, <span class="number">29</span>, </span><br><span class="line">            <span class="number">21</span>, <span class="number">13</span>, <span class="number">5</span>, <span class="number">28</span>, <span class="number">20</span>, <span class="number">12</span>, <span class="number">4</span>]</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> [key[x-<span class="number">1</span>] <span class="keyword">for</span> x <span class="keyword">in</span> pc1_l], [key[x-<span class="number">1</span>] <span class="keyword">for</span> x <span class="keyword">in</span> pc1_r]</span><br><span class="line"></span><br><span class="line">testKey = [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>]</span><br><span class="line">testL, testR = PC1(testKey)</span><br><span class="line"><span class="keyword">assert</span> testL + testR == [<span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 选择置换2</span></span><br><span class="line"><span class="comment"># 从56位的密钥中选取48位子密钥</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">PC2</span>(<span class="params">key</span>):</span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">len</span>(key) == <span class="number">56</span></span><br><span class="line"></span><br><span class="line">    pc2 = [<span class="number">14</span>, <span class="number">17</span>, <span class="number">11</span>, <span class="number">24</span>, <span class="number">1</span>, <span class="number">5</span>, </span><br><span class="line">            <span class="number">3</span>, <span class="number">28</span>, <span class="number">15</span>, <span class="number">6</span>, <span class="number">21</span>, <span class="number">10</span>,</span><br><span class="line">            <span class="number">23</span>, <span class="number">19</span>, <span class="number">12</span>, <span class="number">4</span>, <span class="number">26</span>, <span class="number">8</span>,</span><br><span class="line">            <span class="number">16</span>, <span class="number">7</span>, <span class="number">27</span>, <span class="number">20</span>, <span class="number">13</span>, <span class="number">2</span>,</span><br><span class="line">            <span class="number">41</span>, <span class="number">52</span>, <span class="number">31</span>, <span class="number">37</span>, <span class="number">47</span>, <span class="number">55</span>,</span><br><span class="line">            <span class="number">30</span>, <span class="number">40</span>, <span class="number">51</span>, <span class="number">45</span>, <span class="number">33</span>, <span class="number">48</span>,</span><br><span class="line">            <span class="number">44</span>, <span class="number">49</span>, <span class="number">39</span>, <span class="number">56</span>, <span class="number">34</span>, <span class="number">53</span>,</span><br><span class="line">            <span class="number">46</span>, <span class="number">42</span>, <span class="number">50</span>, <span class="number">36</span>, <span class="number">29</span>, <span class="number">32</span>]</span><br><span class="line">    <span class="keyword">return</span> [key[x-<span class="number">1</span>] <span class="keyword">for</span> x <span class="keyword">in</span> pc2]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 子密钥生成算法，由一个64位主密钥导出16个48位子密钥</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">keyGen</span>(<span class="params">key</span>):</span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">len</span>(key) == <span class="number">64</span></span><br><span class="line"></span><br><span class="line">    l, r = PC1(key)</span><br><span class="line">    off = [<span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">1</span>]</span><br><span class="line">    res = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>):</span><br><span class="line">        l = leftRotate(l, off[x])</span><br><span class="line">        r = leftRotate(r, off[x])</span><br><span class="line"></span><br><span class="line">        res.append(PC2(l + r))</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> keyGen(testKey)[-<span class="number">1</span>] == [<span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># S盒变换，输入48位，输出32位</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">S</span>(<span class="params">a</span>):</span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">len</span>(a) == <span class="number">48</span></span><br><span class="line"></span><br><span class="line">    S_box = [[<span class="number">14</span>,<span class="number">4</span>,<span class="number">13</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">15</span>,<span class="number">11</span>,<span class="number">8</span>,<span class="number">3</span>,<span class="number">10</span>,<span class="number">6</span>,<span class="number">12</span>,<span class="number">5</span>,<span class="number">9</span>,<span class="number">0</span>,<span class="number">7</span>,</span><br><span class="line">                <span class="number">0</span>,<span class="number">15</span>,<span class="number">7</span>,<span class="number">4</span>,<span class="number">14</span>,<span class="number">2</span>,<span class="number">13</span>,<span class="number">1</span>,<span class="number">10</span>,<span class="number">6</span>,<span class="number">12</span>,<span class="number">11</span>,<span class="number">9</span>,<span class="number">5</span>,<span class="number">3</span>,<span class="number">8</span>,</span><br><span class="line">                <span class="number">4</span>,<span class="number">1</span>,<span class="number">14</span>,<span class="number">8</span>,<span class="number">13</span>,<span class="number">6</span>,<span class="number">2</span>,<span class="number">11</span>,<span class="number">15</span>,<span class="number">12</span>,<span class="number">9</span>,<span class="number">7</span>,<span class="number">3</span>,<span class="number">10</span>,<span class="number">5</span>,<span class="number">0</span>,</span><br><span class="line">                <span class="number">15</span>,<span class="number">12</span>,<span class="number">8</span>,<span class="number">2</span>,<span class="number">4</span>,<span class="number">9</span>,<span class="number">1</span>,<span class="number">7</span>,<span class="number">5</span>,<span class="number">11</span>,<span class="number">3</span>,<span class="number">14</span>,<span class="number">10</span>,<span class="number">0</span>,<span class="number">6</span>,<span class="number">13</span>], </span><br><span class="line">                [<span class="number">15</span>,<span class="number">1</span>,<span class="number">8</span>,<span class="number">14</span>,<span class="number">6</span>,<span class="number">11</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">9</span>,<span class="number">7</span>,<span class="number">2</span>,<span class="number">13</span>,<span class="number">12</span>,<span class="number">0</span>,<span class="number">5</span>,<span class="number">10</span>,</span><br><span class="line">                <span class="number">3</span>,<span class="number">13</span>,<span class="number">4</span>,<span class="number">7</span>,<span class="number">15</span>,<span class="number">2</span>,<span class="number">8</span>,<span class="number">14</span>,<span class="number">12</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">10</span>,<span class="number">6</span>,<span class="number">9</span>,<span class="number">11</span>,<span class="number">5</span>,</span><br><span class="line">                <span class="number">0</span>,<span class="number">14</span>,<span class="number">7</span>,<span class="number">11</span>,<span class="number">10</span>,<span class="number">4</span>,<span class="number">13</span>,<span class="number">1</span>,<span class="number">5</span>,<span class="number">8</span>,<span class="number">12</span>,<span class="number">6</span>,<span class="number">9</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">15</span>,</span><br><span class="line">                <span class="number">13</span>,<span class="number">8</span>,<span class="number">10</span>,<span class="number">1</span>,<span class="number">3</span>,<span class="number">15</span>,<span class="number">4</span>,<span class="number">2</span>,<span class="number">11</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">12</span>,<span class="number">0</span>,<span class="number">5</span>,<span class="number">14</span>,<span class="number">9</span>], </span><br><span class="line">                [<span class="number">10</span>,<span class="number">0</span>,<span class="number">9</span>,<span class="number">14</span>,<span class="number">6</span>,<span class="number">3</span>,<span class="number">15</span>,<span class="number">5</span>,<span class="number">1</span>,<span class="number">13</span>,<span class="number">12</span>,<span class="number">7</span>,<span class="number">11</span>,<span class="number">4</span>,<span class="number">2</span>,<span class="number">8</span>,</span><br><span class="line">                <span class="number">13</span>,<span class="number">7</span>,<span class="number">0</span>,<span class="number">9</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">6</span>,<span class="number">10</span>,<span class="number">2</span>,<span class="number">8</span>,<span class="number">5</span>,<span class="number">14</span>,<span class="number">12</span>,<span class="number">11</span>,<span class="number">15</span>,<span class="number">1</span>,</span><br><span class="line">                <span class="number">13</span>,<span class="number">6</span>,<span class="number">4</span>,<span class="number">9</span>,<span class="number">8</span>,<span class="number">15</span>,<span class="number">3</span>,<span class="number">0</span>,<span class="number">11</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">12</span>,<span class="number">5</span>,<span class="number">10</span>,<span class="number">14</span>,<span class="number">7</span>,</span><br><span class="line">                <span class="number">1</span>,<span class="number">10</span>,<span class="number">13</span>,<span class="number">0</span>,<span class="number">6</span>,<span class="number">9</span>,<span class="number">8</span>,<span class="number">7</span>,<span class="number">4</span>,<span class="number">15</span>,<span class="number">14</span>,<span class="number">3</span>,<span class="number">11</span>,<span class="number">5</span>,<span class="number">2</span>,<span class="number">12</span>],</span><br><span class="line">                [<span class="number">7</span>,<span class="number">13</span>,<span class="number">14</span>,<span class="number">3</span>,<span class="number">0</span>,<span class="number">6</span>,<span class="number">9</span>,<span class="number">10</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">8</span>,<span class="number">5</span>,<span class="number">11</span>,<span class="number">12</span>,<span class="number">4</span>,<span class="number">15</span>,</span><br><span class="line">                <span class="number">13</span>,<span class="number">8</span>,<span class="number">11</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">15</span>,<span class="number">0</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">7</span>,<span class="number">2</span>,<span class="number">12</span>,<span class="number">1</span>,<span class="number">10</span>,<span class="number">14</span>,<span class="number">9</span>,</span><br><span class="line">                <span class="number">10</span>,<span class="number">6</span>,<span class="number">9</span>,<span class="number">0</span>,<span class="number">12</span>,<span class="number">11</span>,<span class="number">7</span>,<span class="number">13</span>,<span class="number">15</span>,<span class="number">1</span>,<span class="number">3</span>,<span class="number">14</span>,<span class="number">5</span>,<span class="number">2</span>,<span class="number">8</span>,<span class="number">4</span>,</span><br><span class="line">                <span class="number">3</span>,<span class="number">15</span>,<span class="number">0</span>,<span class="number">6</span>,<span class="number">10</span>,<span class="number">1</span>,<span class="number">13</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">11</span>,<span class="number">12</span>,<span class="number">7</span>,<span class="number">2</span>,<span class="number">14</span>],</span><br><span class="line">                [<span class="number">2</span>,<span class="number">12</span>,<span class="number">4</span>,<span class="number">1</span>,<span class="number">7</span>,<span class="number">10</span>,<span class="number">11</span>,<span class="number">6</span>,<span class="number">8</span>,<span class="number">5</span>,<span class="number">3</span>,<span class="number">15</span>,<span class="number">13</span>,<span class="number">0</span>,<span class="number">14</span>,<span class="number">9</span>,</span><br><span class="line">                <span class="number">14</span>,<span class="number">11</span>,<span class="number">2</span>,<span class="number">12</span>,<span class="number">4</span>,<span class="number">7</span>,<span class="number">13</span>,<span class="number">1</span>,<span class="number">5</span>,<span class="number">0</span>,<span class="number">15</span>,<span class="number">10</span>,<span class="number">3</span>,<span class="number">9</span>,<span class="number">8</span>,<span class="number">6</span>,</span><br><span class="line">                <span class="number">4</span>,<span class="number">2</span>,<span class="number">1</span>,<span class="number">11</span>,<span class="number">10</span>,<span class="number">13</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">15</span>,<span class="number">9</span>,<span class="number">12</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">3</span>,<span class="number">0</span>,<span class="number">14</span>,</span><br><span class="line">                <span class="number">11</span>,<span class="number">8</span>,<span class="number">12</span>,<span class="number">7</span>,<span class="number">1</span>,<span class="number">14</span>,<span class="number">2</span>,<span class="number">13</span>,<span class="number">6</span>,<span class="number">15</span>,<span class="number">0</span>,<span class="number">9</span>,<span class="number">10</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">3</span>],</span><br><span class="line">                [<span class="number">12</span>,<span class="number">1</span>,<span class="number">10</span>,<span class="number">15</span>,<span class="number">9</span>,<span class="number">2</span>,<span class="number">6</span>,<span class="number">8</span>,<span class="number">0</span>,<span class="number">13</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">14</span>,<span class="number">7</span>,<span class="number">5</span>,<span class="number">11</span>,</span><br><span class="line">                <span class="number">10</span>,<span class="number">15</span>,<span class="number">4</span>,<span class="number">2</span>,<span class="number">7</span>,<span class="number">12</span>,<span class="number">9</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">1</span>,<span class="number">13</span>,<span class="number">14</span>,<span class="number">0</span>,<span class="number">11</span>,<span class="number">3</span>,<span class="number">8</span>,</span><br><span class="line">                <span class="number">9</span>,<span class="number">14</span>,<span class="number">15</span>,<span class="number">5</span>,<span class="number">2</span>,<span class="number">8</span>,<span class="number">12</span>,<span class="number">3</span>,<span class="number">7</span>,<span class="number">0</span>,<span class="number">4</span>,<span class="number">10</span>,<span class="number">1</span>,<span class="number">13</span>,<span class="number">11</span>,<span class="number">6</span>,</span><br><span class="line">                <span class="number">4</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">12</span>,<span class="number">9</span>,<span class="number">5</span>,<span class="number">15</span>,<span class="number">10</span>,<span class="number">11</span>,<span class="number">14</span>,<span class="number">1</span>,<span class="number">7</span>,<span class="number">6</span>,<span class="number">0</span>,<span class="number">8</span>,<span class="number">13</span>],</span><br><span class="line">                [<span class="number">4</span>,<span class="number">11</span>,<span class="number">2</span>,<span class="number">14</span>,<span class="number">15</span>,<span class="number">0</span>,<span class="number">8</span>,<span class="number">13</span>,<span class="number">3</span>,<span class="number">12</span>,<span class="number">9</span>,<span class="number">7</span>,<span class="number">5</span>,<span class="number">10</span>,<span class="number">6</span>,<span class="number">1</span>,</span><br><span class="line">                <span class="number">13</span>,<span class="number">0</span>,<span class="number">11</span>,<span class="number">7</span>,<span class="number">4</span>,<span class="number">9</span>,<span class="number">1</span>,<span class="number">10</span>,<span class="number">14</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">12</span>,<span class="number">2</span>,<span class="number">15</span>,<span class="number">8</span>,<span class="number">6</span>,</span><br><span class="line">                <span class="number">1</span>,<span class="number">4</span>,<span class="number">11</span>,<span class="number">13</span>,<span class="number">12</span>,<span class="number">3</span>,<span class="number">7</span>,<span class="number">14</span>,<span class="number">10</span>,<span class="number">15</span>,<span class="number">6</span>,<span class="number">8</span>,<span class="number">0</span>,<span class="number">5</span>,<span class="number">9</span>,<span class="number">2</span>,</span><br><span class="line">                <span class="number">6</span>,<span class="number">11</span>,<span class="number">13</span>,<span class="number">8</span>,<span class="number">1</span>,<span class="number">4</span>,<span class="number">10</span>,<span class="number">7</span>,<span class="number">9</span>,<span class="number">5</span>,<span class="number">0</span>,<span class="number">15</span>,<span class="number">14</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">12</span>],</span><br><span class="line">                [<span class="number">13</span>,<span class="number">2</span>,<span class="number">8</span>,<span class="number">4</span>,<span class="number">6</span>,<span class="number">15</span>,<span class="number">11</span>,<span class="number">1</span>,<span class="number">10</span>,<span class="number">9</span>,<span class="number">3</span>,<span class="number">14</span>,<span class="number">5</span>,<span class="number">0</span>,<span class="number">12</span>,<span class="number">7</span>,</span><br><span class="line">                <span class="number">1</span>,<span class="number">15</span>,<span class="number">13</span>,<span class="number">8</span>,<span class="number">10</span>,<span class="number">3</span>,<span class="number">7</span>,<span class="number">4</span>,<span class="number">12</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">11</span>,<span class="number">0</span>,<span class="number">14</span>,<span class="number">9</span>,<span class="number">2</span>,</span><br><span class="line">                <span class="number">7</span>,<span class="number">11</span>,<span class="number">4</span>,<span class="number">1</span>,<span class="number">9</span>,<span class="number">12</span>,<span class="number">14</span>,<span class="number">2</span>,<span class="number">0</span>,<span class="number">6</span>,<span class="number">10</span>,<span class="number">13</span>,<span class="number">15</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">8</span>,</span><br><span class="line">                <span class="number">2</span>,<span class="number">1</span>,<span class="number">14</span>,<span class="number">7</span>,<span class="number">4</span>,<span class="number">10</span>,<span class="number">8</span>,<span class="number">13</span>,<span class="number">15</span>,<span class="number">12</span>,<span class="number">9</span>,<span class="number">0</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">11</span>]]</span><br><span class="line"></span><br><span class="line">    a = np.array(a, dtype=<span class="built_in">int</span>).reshape(<span class="number">8</span>, <span class="number">6</span>)</span><br><span class="line">    res = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">        <span class="comment"># 用 S_box[i] 处理6位a[i]，得到4位输出</span></span><br><span class="line">        p = a[i]</span><br><span class="line">        r = S_box[i][bin2int([p[<span class="number">0</span>], p[<span class="number">5</span>], p[<span class="number">1</span>], p[<span class="number">2</span>], p[<span class="number">3</span>], p[<span class="number">4</span>]])]</span><br><span class="line">        res.append(int2bin(r, <span class="number">4</span>))</span><br><span class="line">        </span><br><span class="line">    res = np.array(res).flatten().tolist()</span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">len</span>(res) == <span class="number">32</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"><span class="comment"># 扩张置换，将32位的半块扩展到48位</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">Expand</span>(<span class="params">a</span>):</span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">len</span>(a) == <span class="number">32</span></span><br><span class="line">    e = [<span class="number">32</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>,</span><br><span class="line">        <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>,</span><br><span class="line">        <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">13</span>,</span><br><span class="line">        <span class="number">12</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">16</span>, <span class="number">17</span>,</span><br><span class="line">        <span class="number">16</span>, <span class="number">17</span>, <span class="number">18</span>, <span class="number">19</span>, <span class="number">20</span>, <span class="number">21</span>,</span><br><span class="line">        <span class="number">20</span>, <span class="number">21</span>, <span class="number">22</span>, <span class="number">23</span>, <span class="number">24</span>, <span class="number">25</span>,</span><br><span class="line">        <span class="number">24</span>, <span class="number">25</span>, <span class="number">26</span>, <span class="number">27</span>, <span class="number">28</span>, <span class="number">29</span>,</span><br><span class="line">        <span class="number">28</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">31</span>, <span class="number">32</span>, <span class="number">1</span>]</span><br><span class="line">    <span class="keyword">return</span> [a[x-<span class="number">1</span>] <span class="keyword">for</span> x <span class="keyword">in</span> e]</span><br><span class="line"></span><br><span class="line"><span class="comment"># P置换</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">P</span>(<span class="params">a</span>):</span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">len</span>(a) == <span class="number">32</span></span><br><span class="line"></span><br><span class="line">    p = [<span class="number">16</span>, <span class="number">7</span>, <span class="number">20</span>, <span class="number">21</span>,</span><br><span class="line">        <span class="number">29</span>, <span class="number">12</span>, <span class="number">28</span>, <span class="number">17</span>,</span><br><span class="line">        <span class="number">1</span>, <span class="number">15</span>, <span class="number">23</span>, <span class="number">26</span>,</span><br><span class="line">        <span class="number">5</span>, <span class="number">18</span>, <span class="number">31</span>, <span class="number">10</span>,</span><br><span class="line">        <span class="number">2</span>, <span class="number">8</span>, <span class="number">24</span>, <span class="number">14</span>,</span><br><span class="line">        <span class="number">32</span>, <span class="number">27</span>, <span class="number">3</span>, <span class="number">9</span>,</span><br><span class="line">        <span class="number">19</span>, <span class="number">13</span>, <span class="number">30</span>, <span class="number">6</span>,</span><br><span class="line">        <span class="number">22</span>, <span class="number">11</span>, <span class="number">4</span>, <span class="number">25</span>]</span><br><span class="line">    <span class="keyword">return</span> [a[x-<span class="number">1</span>] <span class="keyword">for</span> x <span class="keyword">in</span> p]</span><br><span class="line"></span><br><span class="line"><span class="comment"># F函数，用于处理一个半块</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">Feistel</span>(<span class="params">a, subKey</span>):</span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">len</span>(a) == <span class="number">32</span></span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">len</span>(subKey) == <span class="number">48</span></span><br><span class="line"></span><br><span class="line">    t = binXor(Expand(a), subKey)</span><br><span class="line">    t = S(t)</span><br><span class="line">    t = P(t)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> t</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">goRound</span>(<span class="params">l, r, subKey</span>):</span><br><span class="line">    <span class="keyword">return</span> r, binXor(l, Feistel(r, subKey))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">DES</span>(<span class="params">plain, key, method</span>):</span><br><span class="line">    subkeys = keyGen(int2bin(key, <span class="number">64</span>))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> method == <span class="string">&#x27;decrypt&#x27;</span>:</span><br><span class="line">        subkeys = subkeys[::-<span class="number">1</span>]</span><br><span class="line">    </span><br><span class="line">    m = IP(int2bin(plain, <span class="number">64</span>))</span><br><span class="line"></span><br><span class="line">    l, r = np.array(m, dtype=<span class="built_in">int</span>).reshape(<span class="number">2</span>, -<span class="number">1</span>).tolist()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>):</span><br><span class="line">        l, r = goRound(l, r, subkeys[i])</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> bin2int(FP(r + l))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># print(hex(DES(0x11aabbccddeeff01, 0xcafababedeadbeaf, &#x27;encrypt&#x27;)))</span></span><br><span class="line"><span class="comment"># # 0x2973a7e54ec730a3</span></span><br><span class="line"><span class="comment"># print(hex(DES(0x2973a7e54ec730a3, 0xcafababedeadbeaf, &#x27;decrypt&#x27;)))</span></span><br><span class="line"><span class="comment"># # 0x11aabbccddeeff01</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ECB模式加密</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">des_ecb_encrypt</span>(<span class="params">plain_blocks, key</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    使用 DES 电子密码本（ECB）模式对明文块列表进行加密。</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">    :param plain_blocks: list[int]，64-bit 明文块列表</span></span><br><span class="line"><span class="string">    :param key: int，64-bit 密钥</span></span><br><span class="line"><span class="string">    :return: list[int]，加密后的 64-bit 密文块列表</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> [DES(block, key, <span class="string">&#x27;encrypt&#x27;</span>) <span class="keyword">for</span> block <span class="keyword">in</span> plain_blocks]</span><br><span class="line"></span><br><span class="line"><span class="comment"># ECB模式解密</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">des_ecb_decrypt</span>(<span class="params">cipher_blocks, key</span>):</span><br><span class="line">    <span class="keyword">return</span> [DES(block, key, <span class="string">&#x27;decrypt&#x27;</span>) <span class="keyword">for</span> block <span class="keyword">in</span> cipher_blocks]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_input_blocks</span>():</span><br><span class="line">    <span class="string">&quot;&quot;&quot; 让用户输入数据，并转换为 64-bit 块 &quot;&quot;&quot;</span></span><br><span class="line">    data = <span class="built_in">input</span>(<span class="string">&quot;请输入数据（可以是字符串、整数或十六进制）：&quot;</span>).strip()</span><br><span class="line">    <span class="keyword">if</span> data.startswith(<span class="string">&quot;0x&quot;</span>):  <span class="comment"># 处理十六进制输入</span></span><br><span class="line">        blocks = [<span class="built_in">int</span>(data, <span class="number">16</span>)]</span><br><span class="line">    <span class="keyword">elif</span> data.isdigit():  <span class="comment"># 处理整数输入</span></span><br><span class="line">        blocks = [<span class="built_in">int</span>(data)]</span><br><span class="line">    <span class="keyword">else</span>:  <span class="comment"># 处理字符串输入</span></span><br><span class="line">        blocks = pad_data(data)</span><br><span class="line">    <span class="keyword">return</span> blocks</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    key = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&quot;请输入 64-bit 密钥（16进制）：&quot;</span>), <span class="number">16</span>)  <span class="comment"># 获取密钥</span></span><br><span class="line">    mode = <span class="built_in">input</span>(<span class="string">&quot;请选择模式（encrypt/decrypt）：&quot;</span>).strip().lower()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> mode == <span class="string">&#x27;encrypt&#x27;</span>:</span><br><span class="line">        plaintext_blocks = get_input_blocks()</span><br><span class="line">        cipher_blocks = des_ecb_encrypt(plaintext_blocks, key)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;加密后:&quot;</span>, [<span class="built_in">hex</span>(c) <span class="keyword">for</span> c <span class="keyword">in</span> cipher_blocks])</span><br><span class="line">    <span class="keyword">elif</span> mode == <span class="string">&#x27;decrypt&#x27;</span>:</span><br><span class="line">        cipher_blocks = get_input_blocks()</span><br><span class="line">        decrypted_blocks = des_ecb_decrypt(cipher_blocks, key)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;解密后:&quot;</span>, unpad_data(decrypted_blocks))  <span class="comment"># 试图转换回字符串</span></span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;解密后:&quot;</span>, [<span class="built_in">hex</span>(c) <span class="keyword">for</span> c <span class="keyword">in</span> decrypted_blocks])  <span class="comment"># 不是字符串时输出十六进制</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;无效模式，请输入 &#x27;encrypt&#x27; 或 &#x27;decrypt&#x27;&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br><span class="line"></span><br></pre></td></tr></table></div></figure>

<hr>
<p>工作模式：</p>
<ul>
<li><strong><font style="color:rgb(64, 64, 64);">ECB模式</font></strong><font style="color:rgb(64, 64, 64);">：每个明文块独立加密，无依赖关系。</font></li>
<li><strong><font style="color:rgb(64, 64, 64);">CBC模式</font></strong><font style="color:rgb(64, 64, 64);">：每个块加密前与前一个密文异或，需初始向量IV。</font></li>
</ul>
<p><font style="color:rgb(64, 64, 64);"></font></p>
<p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://www.yuque.com/attachments/yuque/0/2025/py/48372651/1742957183331-340deadb-cf8f-4b66-8fa9-3ac4af305f30.py" >des1.py</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>  –有每轮结果的版本</p>
<p><span class="exturl"><a class="exturl__link"   target="_blank" rel="noopener" href="https://www.yuque.com/attachments/yuque/0/2025/py/48372651/1742957214075-73626dc9-420d-4ea2-997f-e1df17701110.py" >des.py</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
</div></div></article></section><nav class="paginator"><div class="paginator-inner"><span class="page-number current">1</span></div></nav></div></div><div class="sidebar-wrap" id="sidebar-wrap"><aside class="sidebar" id="sidebar"><section class="sidebar-toc hide"></section><!-- ov = overview--><section class="sidebar-ov"><div class="sidebar-ov-author"><div class="sidebar-ov-author__avatar"><img class="sidebar-ov-author__avatar_img" src="/images/t1.jpg" alt="avatar"></div><p class="sidebar-ov-author__text">去见山，去看海，去会众生，去寻自己。</p></div><div class="sidebar-ov-social"><a class="sidebar-ov-social-item" href="2836274141@qq.com" target="_blank" rel="noopener"><span class="sidebar-ov-social-item__icon"><i class="fas fa-envelope"></i></span><span class="sidebar-ov-social-item__text">email</span></a></div><div class="sidebar-ov-state"><a class="sidebar-ov-state-item sidebar-ov-state-item--posts" href="/archives/"><div class="sidebar-ov-state-item__count">7</div><div class="sidebar-ov-state-item__name">归档</div></a><a class="sidebar-ov-state-item sidebar-ov-state-item--categories" href="/categories/"><div class="sidebar-ov-state-item__count">0</div><div class="sidebar-ov-state-item__name">分类</div></a><a class="sidebar-ov-state-item sidebar-ov-state-item--tags" href="/tags/"><div class="sidebar-ov-state-item__count">4</div><div class="sidebar-ov-state-item__name">标签</div></a></div><div class="sidebar-ov-cc"><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank" rel="noopener" data-popover="知识共享许可协议" data-popover-pos="up"><img src="/images/cc-by-nc-sa.svg"></a></div></section></aside></div><div class="clearfix"></div></div></main><footer class="footer" id="footer"><div class="footer-inner"><div>平芜尽处是春山</div></div></footer><div class="loading-bar" id="loading-bar"><div class="loading-bar__progress"></div></div><div class="back2top" id="back2top"><span class="back2top__icon"><i class="fas fa-rocket"></i></span></div></div><script src="https://cdn.jsdelivr.net/npm/jquery@v3.4.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.2/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.2/velocity.ui.min.js"></script><script src="https://cdn.jsdelivr.net/npm/quicklink@1.0.1/dist/quicklink.umd.js"></script><script>function initQuicklink() {
  quicklink({
    timeout: '10000',
    priority: true,
    ignores: [uri => uri.includes('#'), uri => uri === 'https://alkaid312.github.io/', /\/api\/?/,uri => uri.includes('.xml'),uri => uri.includes('.zip'),(uri, el) => el.hasAttribute('nofollow'),(uri, el) => el.hasAttribute('noprefetch')]
  });
}

if (false || false) {
  initQuicklink();
} else {
  window.addEventListener('DOMContentLoaded', initQuicklink, false);
}</script><script src="/js/utils.js?v=2.8.0"></script><script src="/js/stun-boot.js?v=2.8.0"></script><script src="/js/scroll.js?v=2.8.0"></script><script src="/js/header.js?v=2.8.0"></script><script src="/js/sidebar.js?v=2.8.0"></script></body></html>